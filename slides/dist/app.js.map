{"version":3,"sources":["app/controller.js","app/draw.js","app/errors.js","app/examples.js","app/index.js","app/layout.js","app/render.js","lib/error.js","lib/fsm.js","lib/parser/grammar.peg","lib/parser/index.js","lib/parser/init.js","lib/pipeline.js","lib/sketchFsm.js","lib/style.js","lib/tree.js","lib/utils/check.js","lib/utils/exception.js","lib/utils/iterator.js","lib/utils/precedence.js"],"names":[],"mappings":"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MAArB,CAA4B,CAA5B;AACD;AACD,MAAG,EAAE,QAAL,EAAe;AACb,SAAK,MAAL,CAAY,SAAZ,CAAsB,MAAtB,CAA6B,CAA7B;AACD;AACD,OAAK,MAAL,CAAY,MAAZ,CAAmB,CAAnB;AACD,CApBD;;AAsBA,IAAM,mBAAmB,SAAnB,gBAAmB,CAAC,CAAD,EAAI,IAAJ,EAAa;AACpC,MAAM,IAAI,KAAK,WAAL,CAAiB,GAAjB,CAAqB,CAArB,CAAV;AACA,MAAG,KAAK,IAAR,EAAc;AACZ,SAAK,MAAL,CAAY,GAAZ,CAAgB,EAAE,IAAlB,EAAwB,IAAxB,CAA6B,GAA7B,CAAiC,EAAE,EAAnC,EAAuC,MAAvC,CAA8C,EAAE,EAAhD;AACA,SAAK,MAAL,CAAY,GAAZ,CAAgB,EAAE,EAAlB,EAAsB,IAAtB,CAA2B,GAA3B,CAA+B,EAAE,EAAjC,EAAqC,MAArC,CAA4C,CAA5C;AACA,SAAK,OAAL,CAAa,GAAb,CAAiB,EAAE,EAAnB,EAAuB,WAAvB,CAAmC,MAAnC,CAA0C,CAA1C;AACA,SAAK,WAAL,CAAiB,MAAjB,CAAwB,CAAxB;AACD;AACF,CARD;;;ACxjBA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvxBA;AAAA;;;;;;;;ACAA;;;;AACA;;;;AAEA,iBAAU,MAAV,GAAmB,iBAAU,QAAV,CACf,iBADe,EAEf,UAAU,QAAV,EAAoB,KAApB,EAA2B,QAA3B,EAAqC;AACnC,OAAK,QAAL,GAAgB,QAAhB;AACA,OAAK,KAAL,GAAa,KAAb;AACA,OAAK,QAAL,G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","file":"build/app/app.js","sourcesContent":["/** \n * @module app/controller\n */\n\n// import sketchFsm from \"../lib/sketchFsm\";\nimport pipeline from \"../lib/pipeline\";\nimport exception from \"../lib/utils/exception\";\nimport draw from \"./draw\";\nimport stringifyError from \"../lib/error\";\n\n/**\n * Controller\n * @return {Object} Not really, just testing\n */\nexport default function controller() {\n\n  document.getElementById(\"bGeneration\")\n  .addEventListener(\"click\", () => {\n    let container = document.getElementById(\"autoimg\");\n    cleanup(container);\n    let error_container = document.getElementById(\"autospec\")\n    .getElementsByTagName(\"textarea\")[1];\n    error_container.value = \"\";\n    var aml = document\n    .getElementById(\"autospec\")\n    .getElementsByTagName(\"textarea\")[0]\n    .value;\n    let fsm = pipeline(aml);\n    if(exception(fsm)) { error_container.value = stringifyError(fsm); }\n    else {\n      log.warn(\"dagre graph\");\n      fsm.layout();\n      draw(fsm, \"#autoimg\");\n    }\n  });\n}\n\nfunction cleanup(container) {\n  let child;\n  while((child = container.firstChild)) {\n    container.removeChild(child); \n  }\n}\n\n","import d3 from \"d3\";\nexport default draw;\n\nconst stateDimensions = (statesG, minRadius=0) => {\n  const text = statesG\n  .append(\"text\")\n  .html((d) => d.label);\n\n  const data = text.data();\n  const nodes = text[0];\n\n  for(let i = 0, bbox; i < data.length; i++) {\n    bbox = nodes[i].getBBox();\n    data[i]\n    .width(Math.max(minRadius*2, bbox.width))\n    .height(Math.max(minRadius*2, bbox.height));\n    nodes[i].remove();\n  } \n};\n\nconst gatherLines = (lines, x, dy=0) => {\n  if(lines.length === 1) {\n    return lines[0].join(\", \");\n  }\n  return lines.map((l, i) => {\n    const end = i < lines.length - 1 ? \",\" : \"\";\n    if(i == 0) {\n      return `<tspan x=${x} dy=${dy}>${l.join(\", \")}${end}</tspan>`;\n    }\n    return `<tspan x=${x} dy=\"8pt\">${l.join(\", \")}${end}</tspan>`;\n  }).join(\"\");\n};\n\nconst edgeDimensions = (edgesG, maxWidth, minRadius=0, padRadius=0) => {\n  const text = edgesG\n  .append(\"text\");\n\n  const data = text.data();\n  const nodes = text[0];\n\n  for(let i = 0, node, labels, lines; i < data.length; i++) {\n    node = nodes[i];\n    labels = data[i].symbols.map((a) => a.label);\n    lines = [];\n    for(let j = 0; j < labels.length; j++) {\n      node.innerHTML = labels[j];\n      let k = 1;\n      while(node.getBBox().width < maxWidth && j + k < labels.length) {\n        node.innerHTML = node.innerHTML + \", \" + labels[j + k];\n        k++;\n      }\n      lines.push(labels.slice(j, j + k));\n      j = j + k - 1;\n    }\n    data[i].lines = lines;\n    node.innerHTML = gatherLines(data[i].lines, 0);\n    const {width, height} = node.getBBox();\n    data[i]\n    .width(Math.max(minRadius*2, width + padRadius*2))\n    .height(Math.max(minRadius*2, height + padRadius*2));\n    node.remove();\n  }\n};\n\nconst edgePathGenerator = d3.svg.line()\n.x((d) => d.x)\n.y((d) => d.y)\n.interpolate(\"bundle\")\n.tension(0.8);\n\nconst sq = (x) => x*x;\n\nconst sign = (bool) => (bool|0)*2 - 1;\n\nconst intersection = (x, y, tx, ty, a, b) => {\n  return {\n    x: x + sign(tx > 0)*Math.sqrt(1 / ( sq(1/a) + sq(ty/(b*tx)) )),\n    y: y + sign(ty > 0)*Math.sqrt(1 / ( sq(1/b) + sq(tx/(a*ty)) )),\n  };\n};\n\nconst translate = (x, y, tx, ty, d) => {\n  const r = d === undefined ? 1 : d/Math.sqrt(sq(tx) + sq(ty));\n  return {\n    x: x + tx*r,\n    y: y + ty*r\n  };\n};\n\nconst drawInitArrow = (statesG, initArrowLength, arrowWidth, terminalSpacing) => {\n  statesG.filter((d) => d.initial)\n  .append(\"line\")\n  .each((d) => {\n    const {a, b} = ellipseRadiusFromState(d, terminalSpacing);\n    d.arrowPos = {};\n    const intersect = intersection(d.x(), d.y(), -1, 0, a, b);\n    d.arrowPos.base = {\n      x: intersect.x - arrowWidth - d.x(),\n      y: intersect.y - d.y()\n    };\n    d.arrowPos.start = {\n      x: d.arrowPos.base.x - initArrowLength,\n      y: d.arrowPos.base.y\n    };\n  })\n  .attr(\"stroke\", \"black\")\n  .attr(\"marker-end\", \"url(#arrow)\")\n  .attr({\n    x1: (d) => d.x() + d.arrowPos.start.x,\n    y1: (d) => d.y() + d.arrowPos.start.y,\n    x2: (d) => d.x() + d.arrowPos.base.x,\n    y2: (d) => d.y() + d.arrowPos.base.y\n  });\n};\n\nconst fixIntersection = (center, controlPoint, semimajor, semiminor) => {\n  return intersection(\n    center.x, center.y,\n    controlPoint.x - center.x, controlPoint.y - center.y,\n    semimajor, semiminor\n  );\n};\n\nconst ellipseRadiusFromState = (s, terminalSpacing) => {\n  const pad = s.terminal ? terminalSpacing : 0;\n  return {\n    a: s.width()/Math.sqrt(2) + pad,\n    b: s.height()/Math.sqrt(2) + pad\n  };\n};\n\nconst norm = (x, y) => Math.sqrt(sq(x) + sq(y));\n\nconst drawEdgePaths = (edgesG) => {\n  edgesG\n  .append(\"path\")\n  .each(function(d) {\n    d.path = this;\n  })\n  .attr(\"marker-end\", \"url(#arrow)\");\n};\n\nconst updateEdgePaths = (paths, arrowWidth, terminalSpacing) => {\n  paths.attr(\"d\", (d) => {\n    const points = d.points;\n    let a, b;\n    ({a, b} = ellipseRadiusFromState(d.from, terminalSpacing));\n    points[0] = fixIntersection(points[0], points[1], a, b);\n    ({a, b} = ellipseRadiusFromState(d.to, terminalSpacing));\n    let controlPoint = points[points.length - 2];\n    let tip = fixIntersection(points[points.length - 1], controlPoint, a, b);\n    if(norm(controlPoint.x - tip.x, controlPoint.y - tip.y) < arrowWidth) {\n      // FIXME: That's an ugly hack for when the base of arrowhead is farther\n      // that the control point\n      // A solution is to keep the full path and use stroke dash-array to only\n      // draw the part we need\n      controlPoint = translate(\n        controlPoint.x, controlPoint.y,\n        (points[points.length - 3].x - controlPoint.x)/1.7,\n        (points[points.length - 3].y - controlPoint.y)/1.7\n      );\n      tip = fixIntersection(points[points.length - 1], controlPoint, a, b);\n      points[points.length - 2] = controlPoint;\n    }\n    const base = translate(\n      tip.x, tip.y,\n      controlPoint.x - tip.x, controlPoint.y - tip.y,\n      arrowWidth\n    );\n    points[points.length - 1] = base;\n    return edgePathGenerator(points);\n  });\n};\n\nconst defineArrowHead = (defs, width, height) => {\n  defs.append(\"marker\")\n  .attr({\n    \"id\":\"arrow\",\n    \"refX\":0,\n    \"refY\":height/2,\n    \"markerWidth\": width,\n    \"markerHeight\":height,\n    \"markerUnits\": \"userSpaceOnUse\",\n    \"orient\":\"auto\"\n  }).append(\"path\")\n  .attr(\"d\", `M0,0 L0,${height} L${width},${height/2} z`)\n  .attr(\"class\",\"arrowHead\");\n};\n\nfunction draw(fsm, container) {\n\n  // Init\n  cleanup(container);\n  const svg = d3\n  .select(container)\n  .append(\"svg\");\n\n  // Defs\n  const defs = svg.append(\"defs\");\n  const arrowWidth = 7;\n  const terminalSpacing = 3;\n  const initArrowLength = arrowWidth;\n  defineArrowHead(defs, arrowWidth, 5);\n\n  // Container\n  const g = svg.append(\"g\");\n  svg.call(d3.behavior.zoom().on(\"zoom\", zoom(g)));\n\n  // Groups\n  const statesG = g.selectAll(\".state\")\n  .data(Array.from(fsm.states.all())).enter()\n  .append(\"g\")\n  .attr(\"class\", \"state\")\n  .attr(\"id\", (d) => `state_${d.id}`)\n  .each((d) => {\n    d.edges = new Set();\n  });\n\n  const edgesG = g.selectAll(\".edge\")\n  .data(Array.from(fsm.edges.all())).enter()\n  .append(\"g\")\n  .attr(\"class\", \"edge\")\n  .attr(\"id\", (d) => `edge_${d.from.id}_${d.to.id}`)\n  .each(function(d) {\n    d.from.edges.add(this);\n    d.to.edges.add(this);\n  });\n\n  // Measure\n  stateDimensions(statesG, 12);\n  edgeDimensions(edgesG, 20, 4, 2);\n\n  // Compute layout\n  fsm.layout();\n\n  // Account for ellipses and arrowheads\n  // fixIntersections(edgesG, arrowWidth);\n\n  // If needed\n  // drawDebug(statesG, edgesG, g);\n\n  // Render\n  drawEllipses(statesG, terminalSpacing);\n  drawInitArrow(statesG, initArrowLength, arrowWidth, terminalSpacing);\n  drawStateLabels(statesG);\n  drawEdgePaths(edgesG);\n  updateEdgePaths(edgesG.selectAll(\"path\"), arrowWidth, terminalSpacing);\n  drawEdgeLabels(edgesG, arrowWidth);\n  \n  // Drag'n'Drop\n  const drag = d3.behavior.drag()\n  .on(\"dragstart\", function() { d3.event.sourceEvent.stopPropagation(); })\n  .on(\"drag\", function(d) {\n    d.x(d3.event.x).y(d3.event.y);\n    updateState(d3.select(this), arrowWidth, terminalSpacing);\n  });\n\n  statesG.call(drag);\n}\n\nconst updateState = (sG, arrowWidth, terminalSpacing) => {\n  sG.selectAll(\"ellipse\")\n  .attr(\"cx\", (d) => d.x())\n  .attr(\"cy\", (d) => d.y());\n\n  sG.selectAll(\"text\")\n  .attr(\"x\", (d) => d.x())\n  .attr(\"y\", (d) => d.y());\n\n  sG.selectAll(\"line\")\n  .attr({\n    x1: (d) => d.x() + d.arrowPos.start.x,\n    y1: (d) => d.y() + d.arrowPos.start.y,\n    x2: (d) => d.x() + d.arrowPos.base.x,\n    y2: (d) => d.y() + d.arrowPos.base.y\n  });\n\n  updateEdgePaths(\n    d3.selectAll(Array.from(sG.datum().edges)).selectAll(\"path\"),\n    arrowWidth, terminalSpacing\n  );\n};\n\nconst drawEllipses = (statesG, terminalSpacing) => {\n  statesG.append(\"ellipse\")\n  .attr(\"class\", \"contour\")\n  .attr(\"rx\", (d) => d.width()/Math.sqrt(2))\n  .attr(\"ry\", (d) => d.height()/Math.sqrt(2))\n  .attr(\"cx\", (d) => d.x())\n  .attr(\"cy\", (d) => d.y());\n\n  statesG.filter((d) => d.terminal)\n  .append(\"ellipse\")\n  .attr(\"class\", \"doubling\")\n  .attr(\"rx\", (d) => d.width()/Math.sqrt(2) + terminalSpacing)\n  .attr(\"ry\", (d) => d.height()/Math.sqrt(2) + terminalSpacing)\n  .attr(\"cx\", (d) => d.x())\n  .attr(\"cy\", (d) => d.y());\n};\n\nconst drawStateLabels = (statesG) => {\n  statesG.append(\"text\")\n  .attr(\"x\", (d) => d.x())\n  .attr(\"y\", (d) => d.y())\n  .attr(\"text-anchor\", \"middle\")\n  .attr(\"dominant-baseline\", \"central\")\n  .html((d) => d.label);\n};\n\nconst drawEdgeLabels = (edgesG, arrowWidth) => {\n  edgesG.append(\"text\")\n  .each((d) => {\n    const l = d.path.getTotalLength() + arrowWidth;\n    let middle = d.path.getPointAtLength(l/2);\n    const points = d.points;\n    const midIndex = (points.length - 1)/2;\n    const epsilon = 3;\n    let outwardx = 0;\n    let outwardy = 0;\n    let i = 1;\n    while(Math.abs(outwardx) < epsilon && Math.abs(outwardy) < epsilon && i <= midIndex) {\n      outwardx = 2*points[midIndex].x - points[midIndex - i].x - points[midIndex + i].x; \n      outwardy = 2*points[midIndex].y - points[midIndex - i].y - points[midIndex + i].y; \n      i++;\n    }\n    if(Math.abs(outwardx) < epsilon && Math.abs(outwardy) < epsilon) {\n      outwardx = points[midIndex - 1].y - points[midIndex + 1].y;\n      outwardy = points[midIndex + 1].x - points[midIndex - 1].x;\n    }\n    const n = norm(outwardx, outwardy);\n    outwardx = outwardx/n;\n    outwardy = outwardy/n;\n    d.x(middle.x + outwardx*d.width()/2.2).y(middle.y + outwardy*d.height()/2.2);\n  })\n  .attr(\"x\", (d) => d.x())\n  .attr(\"y\", (d) => d.y())\n  .attr(\"text-anchor\", \"middle\")\n  .attr(\n    \"dominant-baseline\",\n    (d) => d.lines.length > 1 ? \"text-before-edge\" : \"central\"\n  ).html((d) => gatherLines(d.lines, d.x(), -d.height()/2));\n};\n\nconst zoom = (g) => () => {\n  g.attr(\"transform\", \"translate(\" + d3.event.translate + \")scale(\" + d3.event.scale + \")\");\n};\n\nconst drawDebug = (statesG, edgesG, svg) => {\n  statesG\n  .append(\"rect\")\n  .attr(\"class\", \"debug-rect\")\n  .attr(\"x\", (d) => d.x() - d.width()/2)\n  .attr(\"y\", (d) => d.y() - d.height()/2)\n  .attr(\"width\", (d) => d.width())\n  .attr(\"height\", (d) => d.height())\n  .style(\"fill\", \"#55CCFF\");\n\n  edgesG\n  .append(\"rect\")\n  .attr(\"class\", \"debug-rect\")\n  .attr(\"x\", (d) => d.x() - d.width()/2)\n  .attr(\"y\", (d) => d.y() - d.height()/2)\n  .attr(\"width\", (d) => d.width())\n  .attr(\"height\", (d) => d.height())\n  .style(\"fill\", \"#AAFFAA\");\n\n  edgesG\n  .selectAll(\".debug-circle\")\n  .data((d) => d.points)\n  .enter()\n  .append(\"circle\")\n  .attr(\"class\", \"debug-circle\")\n  .attr(\"r\", 1.5)\n  .attr(\"cx\", (d) => d.x)\n  .attr(\"cy\", (d) => d.y)\n  .style(\"fill\", \"#FF7777\");\n};\n\nconst cleanup = (container) => {\n  if(container === undefined) { return; }\n  container = d3.select(container);\n  let child;\n  while((child = container.firstChild)) {\n    container.removeChild(child);\n  }\n};\n","import {exception} from \"../lib/utils/check\";\nimport pipeline from \"../lib/pipeline\";\nimport {default as stringifyError, firstError} from \"../lib/error\";\n\nconst errors = [\n  \"ALDToken\",\n  \"existingId\",\n  \"wrongType\",\n  \"unknownProp\",\n  \"syntax\",\n  \"unknownId\",\n  \"fsmType\",\n  \"MBToken\"\n];\n\nexport default function main() {\n  const container = document.getElementsByClassName(\"container\")[0];\n  for(let e of errors) {\n    const row = document.createElement(\"div\");\n    row.id = `error-${e}`;\n    row.classList.add(\"row\", \"bottom\");\n    container.appendChild(row);\n    const autospec = document.createElement(\"div\");\n    autospec.classList.add(\"autospec\", \"one-half\", \"column\");\n    const textarea = document.createElement(\"textarea\");\n    const path = `errors/${e}.aml`;\n    textarea.readonly = true;\n    autospec.appendChild(textarea);\n    row.appendChild(autospec);\n    const errorLog = document.createElement(\"div\");\n    errorLog.classList.add(\"errorlog\", \"one-half\", \"column\");\n    row.appendChild(errorLog);\n    populate(textarea, errorLog, path);\n  }\n}\n\nfunction populate(textarea, errorLog, path) {\n  const xhttp = new XMLHttpRequest();\n  xhttp.onreadystatechange = () => {\n    if (xhttp.readyState == 4 && xhttp.status == 200) {\n      textarea.value = xhttp.responseText;\n      const fsm = pipeline(textarea.value);\n      if(!exception(fsm)) {\n        log.error(\"Waiting for an error from \" + path);\n        log.error(fsm);\n        return;\n      }\n      const errorTA = document.createElement(\"textarea\");\n      errorTA.value = stringifyError(firstError(fsm));\n      errorLog.appendChild(errorTA);\n    }\n  };\n  xhttp.open(\"GET\", path, true);\n  xhttp.send();\n}\n","import {exception} from \"../lib/utils/check\";\nimport pipeline from \"../lib/pipeline\";\nimport draw from \"./draw\";\n\nconst figures = [\n  \"1-1\",\n  \"1-2\",\n  \"2-1-a\",\n  \"2-1-b\",\n  \"2-1-c\",\n  \"2-2-a\",\n  \"2-2-b\",\n  \"2-2-c\",\n  \"2-4\",\n  \"2-6\",\n  \"2-6-alt\",\n  \"2-9\",\n  \"2-14\"\n];\n\n\nexport default function main() {\n  const container = document.getElementsByClassName(\"container\")[0];\n  for(let f of figures) {\n    const row = document.createElement(\"div\");\n    row.id = `figure${f}`;\n    row.classList.add(\"row\", \"bottom\");\n    container.appendChild(row);\n    const autospec = document.createElement(\"div\");\n    autospec.classList.add(\"autospec\", \"one-half\", \"column\");\n    const textarea = document.createElement(\"textarea\");\n    const path = `figures/figure${f}.aml`;\n    textarea.readonly = true;\n    autospec.appendChild(textarea);\n    row.appendChild(autospec);\n    const autoimg = document.createElement(\"div\");\n    autoimg.classList.add(\"autoimg\", \"one-half\", \"column\");\n    row.appendChild(autoimg);\n    populate(textarea, autoimg, path);\n  }\n}\n\nfunction populate(textarea, autoimg, path) {\n  const xhttp = new XMLHttpRequest();\n  xhttp.onreadystatechange = () => {\n    if (xhttp.readyState == 4 && xhttp.status == 200) {\n      textarea.value = xhttp.responseText;\n      const fsm = pipeline(textarea.value);\n      if(exception(fsm)) {\n        log.debug(fsm.message);\n        return;\n      }\n      draw(fsm, autoimg);\n    }\n  };\n  xhttp.open(\"GET\", path, true);\n  xhttp.send();\n}\n","import controller from \"./controller\";\n\nexport default function main() {\n  defaultText(\"example.aml\");\n  controller();\n}\n\nfunction defaultText(file) {\n  const xhttp = new XMLHttpRequest();\n  xhttp.onreadystatechange = () => {\n    if (xhttp.readyState == 4 && xhttp.status == 200) {\n      document\n        .getElementById(\"autospec\")\n        .getElementsByTagName(\"textarea\")[0]\n        .value = xhttp.responseText;\n    }\n  };\n  xhttp.open(\"GET\", file, true);\n  xhttp.send();\n}\n","export default function layout() {\n\n  let automata = {\n    type: \"finite\",\n    alphabet: [ ],\n    states: [ ],\n    transitions: [ ]\n  };\n\n  let accessor = {};\n\n  accessor.automata = function(x) {\n    if(!arguments.length) return automata;\n    automata = x;\n    x.transitions.forEach((t) => {\n      if (typeof t.source == \"number\") t.source = x.states[t.source];\n      if (typeof t.target == \"number\") t.target = x.states[t.target];\n      if (typeof t.symbol == \"number\") t.symbol = x.alphabet[t.symbol];\n    });\n    return accessor;\n  };\n\n  accessor.lay = function() {\n    automata.states.forEach((s, i) => {\n      s.x = 50 + (i % 3)*120;\n      s.y = 50 + ((i / 3) | 0)*120;\n    });\n    return accessor;\n  };\n\n  return accessor;\n}\n","import draw from \"./draw\";\nimport pipeline from \"../lib/pipeline\";\nimport exception from \"../lib/utils/exception\";\nimport stringifyError from \"../lib/error\";\nimport d3 from \"d3\";\n\nexport default function render(cal, container) {\n  let fsm = pipeline(cal);\n  if(exception(fsm)) {\n    d3.select(container)[0][0].innerHTML = \"<pre>\" + stringifyError(fsm) + \"</pre>\";\n  }\n  else {\n    fsm.layout();\n    draw(fsm, container);\n  }\n}\n","import { exception } from \"./utils/check\";\n\nexport default function stringifyError (e) {\n  let error = firstError(e);\n  // for(let prop of Object.keys(exception)) {\n  //   log.debug(prop);\n  //   log.debug(exception[prop]);\n  // }\n  const treat = {\n    [exception.ALDToken]: (e) => {\n      const {name, undefinedArticle} = translate(e.type);\n      return `Le bloc ${undefinedArticle + name} redéfini en ${printLoc(e.loc2)} est déjà défini en ${printLoc(e.loc1)}`;\n    },\n    [exception.existingId]: (e) => {\n      const {name, undefinedArticle} = translate(e.type);\n      return `L'identifiant ${undefinedArticle + name} ${e.value} est redéfini en ${printLoc(e.loc)}`;\n      // FIXME\n      // return `L'identifiant ${undefinedArticle + name} ${e.value} redéfini en ${printLoc(e.loc2)} est déjà défini en ${printLoc(e.loc1)}`;\n    },\n    [exception.wrongType]: (e) => {\n      // log.error(e);\n return \"La valeur déclarée en \" + printLoc(e.loc) + \" doit être de type \" + e.type;\n    },\n    [exception.unknownProp]: (e) => \"L'attribut \" + e.propertyName + \" défini en \" + printLoc(e.loc) + \" n'est pas supporté\",\n    [exception.syntax]: treatSyntaxException,\n    [exception.unknownId]: (e) => `Identifiant ${e.value} utilisé en ${printLoc(e.loc)} inconnu.`,\n    [exception.fsmType]: (e) => `${e.type} (${printLoc(e.loc)}) n'est pas un type d'automate valide.`,\n    [exception.MBToken]: (e) => {\n      const {name, undefinedArticle} = translate(e.type);\n      return `Le bloc ${undefinedArticle + name} est manquant.`;\n    },\n    default: (e) => log.debug(`UNHANDLED ERROR ${e.name}\\n ${e.message}`)\n  };\n  return error.name +  \" : \" + error.dispatch(treat);\n}\n\nexport function firstError(e) {\n  return e.dispatch({\n    [exception.array]: (e1) => firstError(e1.exceptions.filter((e2) => e2 != null)[0]),\n    [exception.object]: (e1) => firstError(e1.exceptions[Object.keys(e1.exceptions)[0]]),\n    default: (e1) => e1\n  });\n}\n\n// TODO\n// Use a real localisation framework\nfunction translate(type) {\n  switch(type) {\n    case \"states\":\n      return {\n      name: \"états\",\n      undefinedArticle: \"des \"\n    };\n    case \"symbols\":\n      return {\n      name: \"symboles\",\n      undefinedArticle: \"des \"\n    };\n    case \"transitions\":\n      return {\n      name: \"transitions\",\n      undefinedArticle: \"des \"\n    };\n    case \"state\":\n      return {\n      name: \"état\",\n      undefinedArticle: \"d'\"\n    };\n    case \"symbol\":\n      return {\n      name: \"symbole\",\n      undefinedArticle: \"de \"\n    };\n    case \"transition\":\n      return {\n      name: \"transition\",\n      undefinedArticle: \"de \"\n    };\n    default:\n      throw new Error(\"Cannot translate \" + type + \".\");\n  };\n}\n\nfunction printLoc(loc) {\n  return loc.start.line + \":\" + loc.start.column;\n}\n\nfunction treatSyntaxException(e) {\n  const expected = e.expected.map((ex) => {\n    if(ex.value === \"[ \\\\t\\\\n\\\\r]\") {\n      return \"espace, tabuluation, saut de ligne, retour chariot\";\n    }\n    return ex.value;\n  }).join(\"\\n\");\n  return `Erreur de syntaxe en ${printLoc(e.location)}. ${e.found} trouvé.\\n\\\n    Tokens autorisés : ${expected}`;\n}\n\n","/**\n * @module lib/fsm\n * @requires lib/utils/iterator\n * @requires lib/utils/descriptor\n */\n\nimport * as utilsIterator from \"./utils/iterator\";\nimport {default as check, exception} from \"./utils/check\";\n\n/**\n * @param {?module:lib/fsm~Cfg} cfg\n */\nexport default function fsm(cfg) {\n  return new Fsm(cfg);\n}\n\nconst checks = {};\n\n/**\n * A function that augments a class.\n *\n * It should not mutate its argument and return a new constructor that\n * implements a compatible interface.\n * @callback Mixin\n * @param {Class} inputClass\n * @return {Class} outputClass\n * @global\n */\n\n// const identity = (x) => x;\n\n// FIXME\n// checks.Mixin = check().defaults(identity).instanceOf(Function);\nchecks.Mixin = check().instanceOf(Function);\n\n/**\n * An object literal that holds data meant to be digested by a constructor.\n * @typedef Descriptor\n * @type mdn:Object\n * @global\n */\n\n/**\n * Mixins to be applied on the inner classes of a finite state machine.\n *\n * Each inner class is replaced by the output of the corresponding mixin.\n * This is used to augment the functionalities before instanciation.\n * Make sure to keep every method defined.\n * @typedef Mixins\n * @property {Mixin} symbols\n * The mixin that will be applied on {@link module:fsm~Fsm~Symbol}.\n * @property {Mixin} states\n * The mixin that will be applied on {@link module:fsm~Fsm~State}.\n * @property {Mixin} transitions\n * The mixin that will be applied on {@link module:fsm~Fsm~Transition}.\n */\nchecks.FsmMixins = check().object({\n  symbols: checks.Mixin,\n  states: checks.Mixin,\n  transitions: checks.Mixin,\n});\n\n/**\n * Descriptors defining the default values for each inner class\n *\n * When passing a descriptor through the `add` method,\n * it checks for every property defined in the respective default\n * descriptor. If the value of such property is missing, it is replaced\n * by the one in the default descriptor.\n * @typedef Defaults\n * @type Descriptor\n * @property {Descriptor} symbols\n * Default descriptor for the symbols.\n * @property {Descriptor} states\n * Default descriptor for the states.\n * @property {Descriptor} transitions\n * Default descriptor for the transitions.\n */\n// checks.FsmDefaults = check().object({\n//   symbols: checks.descriptor,\n//   states: checks.descriptor,\n//   transitions: checks.descriptor\n// });\n\n/**\n * Descriptor for the data of a finite state machine\n *\n * Each property should hold an array of descriptors that will be passed\n * to the respective `add` method at instanciation.\n * The `from`, `to` and `by` fields of the transitions' descriptors should\n * hold the indexes of the corresponding state or symbol in the other arrays.\n * @typedef FsmDescriptor\n * @type Descriptor\n * @property {Array.<Descriptor>} symbols\n * An array of descriptors used to create the symbols.\n * @property {Array.<Descriptor>} states\n * An array of descriptors used to create the states.\n * @property {Array.<Descriptor>} transitions\n * An array of descriptors used to create the transitions. Beware of the\n * `from`, `to` and `by` properties.\n */\n// checks.FsmDescriptor = check().object({\n// });\n// cfg = check().definition({\n//   mixins: check().definition({\n//     symbols: checks.mixin,\n//     states: checks.mixin,\n//     transitions: checks.mixin\n//   }),\n//   descriptor: check().definition({\n//     symbols: check().array((a) => Symbol.add(a)),\n//     states: check().array((s) => State.add(s)),\n//     transitions: check().array(checks.transitionNum),\n//   })\n// });\n\n\n/**\n * A configuration object for a finite state machine\n * @typedef Cfg\n * @type Object\n * @property {Mixins} mixins\n * Used to extend the functionalities of the finite state machine.\n * @property {FsmDescriptor} descriptor - The initial data.\n */\nchecks.Cfg = check().object({\n  mixins: checks.FsmMixins\n});\n\n/**\n * @constructor\n * @param {module:lib/fsm~Cfg} cfg={}\n * @protected\n */\nfunction Fsm(cfg) {\n\n  // Data\n\n  // symbols: Map of:\n  //   - keys: symbols ; let `a` be the key\n  //   - values: objects with:\n  //     - transitions: Set of transitions, where `by = a`\n  // states: Map of:\n  //  - keys: states ; let `k` be the key\n  //  - values: objects with:\n  //    - initial: boolean\n  //    - final: boolean\n  //    - pred : Map of: \n  //      - keys: symbols ; let `a` be the key\n  //      - values: Set of transitions, where `to = k` and `by = a`\n  //    - succ: Map of:\n  //      - keys: states ; let `s` be the key\n  //      - values: Map of:\n  //        - keys: symbols ; let `a` be the key\n  //        - values: transition, where `to = s`, `from = k` and `by = a`\n  // transitions: Map of:\n  //   - keys: transitions\n  //   - values: objects with:\n  //     - from: state\n  //     - to: state\n  //     - by: symbol\n  \n  cfg = checks.Cfg.resolve(cfg);\n\n  const data = {\n    symbols: new Map(),\n    states: new Map(),\n    transitions: new Map()\n  };\n\n  data.states.initials = new Set();\n  data.states.terminals = new Set();\n\n  const struct = this;\n\n  // API\n\n  /**\n   * @class\n   * @memberof module:lib/fsm~Fsm\n   * @inner\n   * @protected\n   */\n  class Symbol {\n    /**\n     * The accessor of the finite state machine owning the symbol.\n     * @type {module:lib/fsm} \n     * @readonly\n     */\n    get struct() { return struct; }\n    /**\n     * Iterates on the symbols owned by the finite state machine.\n     * @return {Iterator.<module:lib/fsm~Fsm~Symbol>} an iterator of every symbol\n     */\n    static all() { return getSymbols(data); }\n    /**\n     * Creates a symbol, adds it to the finite state machine and returns it.\n     *\n     * The symbol has the prototype of the calling class.\n     * @return {module:lib/fsm~Fsm~Symbol} the newly created symbol\n     */\n    static add() {\n      return addSymbol({}, new AugmentedSymbol(arguments), data);\n    }\n    /**\n     * Removes a symbol and its associated transitions. Chainable.\n     *\n     * If there is no such symbol, the function silently fails and still\n     * returns the accessor.\n     * @param {module:lib/fsm~Fsm~Symbol} symbol - symbol to remove\n     * @return {module:lib/fsm} the accessor of the finite state machine\n     */\n    static remove(symbol) {\n      symbol = checks.Symbol.remove.resolve(symbol);\n      if(exception(symbol)) return symbol;\n      removeSymbol(symbol, data);\n      return struct;\n    }\n  };\n  \n  /**\n   * @class\n   * @memberof module:lib/fsm~Fsm\n   * @inner\n   * @protected\n   */\n  class State {\n    /**\n     * The accessor of the finite state machine owning the symbol\n     * @type {module:lib/fsm} \n     * @readonly\n     */\n    get struct() { return struct; }\n    /**\n     * Whether the state is initial\n     * @type {boolean} \n     * @readonly\n     */\n    get initial() { return !!data.states.get(this).initial; }\n    /**\n     * Whether the state is terminal\n     * @type {boolean} \n     * @readonly\n     */\n    get terminal() { return !!data.states.get(this).terminal; }\n    /**\n     * @return {Iterator.<module:lib/fsm~Fsm~State>} every state\n     */\n    static all() { return getStates(data); }\n    /**\n     * @return {Iterator.<module:lib/fsm~Fsm~State>} every initial state\n     */\n    static initials() { return getInitialStates(data); }\n    /**\n     * @return {Iterator.<module:lib/fsm~Fsm~State>} every initial state\n     */\n    static terminals() { return getTerminalStates(data); }\n    /**\n     * Removes a state and the associated transitions\n     * @param {module:lib/fsm~Fsm~State} state - state to remove\n     * @return {module:lib/fsm} the finite state machine\n     */\n    static remove(state) {\n      // state = checks.State.remove.resolve(state); TODO\n      if(exception(state)) return state;\n      removeState(state, data);\n      return struct;\n    }\n    /**\n     * Creates and adds a state\n     * @param {?Object} descriptor state descriptor\n     * @param {?boolean} descriptor.initial false if omitted\n     * @param {?boolean} descriptor.terminal false if omitted\n     * @return {module:lib/fsm~Fsm~Transition} the newly created state\n     */\n    static add(descriptor, ...args) {\n      // descriptor = checks.State.add.resolve(descriptor); TODO\n      descriptor = Object.assign({}, descriptor);\n      if(exception(descriptor)) return descriptor;\n      return addState(descriptor, new AugmentedState(arguments), data);\n    }\n  };\n\n  /**\n   * @class\n   * @memberof module:lib/fsm~Fsm\n   * @inner\n   * @protected\n   */\n  class Transition {\n    /**\n     * The accessor of the finite state machine that owns the transition\n     * @type {module:lib/fsm} \n     * @readonly\n     */\n    get struct() { return struct; }\n    /**\n     * The source of the transition\n     * @type {module:lib/fsm~Fsm~State} \n     * @readonly\n     */\n    get from() { return data.transitions.get(this).from; }\n    /**\n     * The target of the transition\n     * @type {module:lib/fsm~Fsm~State} \n     * @readonly\n     */\n    get to() { return data.transitions.get(this).to; }\n    /**\n     * The symbol of the transition\n     * @type {module:lib/fsm~Fsm~State} \n     * @readonly\n     */\n    get by() { return data.transitions.get(this).by; }\n    /**\n     * @return {Iterator.<module:lib/fsm~Fsm~Transition>} every transition\n     */\n    static all() { return getTransitions(data); }\n    /**\n     * Get a transition\n     * @function\n     * @param {Object} descriptor\n     * @param {!module:lib/fsm~Fsm~State} descriptor.from source\n     * @param {!module:lib/fsm~Fsm~State} descriptor.to target\n     * @param {!module:lib/fsm~Fsm~Symbol} descriptor.by symbol\n     * @return {module:lib/fsm~Fsm~Transition}\n     * @throws {TypeError} Will throw if the descriptor is invalid\n     */\n    static get(descriptor) {\n      // descriptor = checks.Transition.get.resolve(descriptor); TODO\n      descriptor = Object.assign({}, descriptor);\n      if(exception(descriptor)) return descriptor;\n      return getTransition(descriptor.from, descriptor.to, descriptor.by, data);\n    }\n    /**\n     * Creates and adds a transition\n     *\n     * If an equivalent transition already exists, the function returns it\n     * (thus failing silently)\n     * @param {Object} descriptor\n     * @param {!module:lib/fsm~Fsm~State} descriptor.from source\n     * @param {!module:lib/fsm~Fsm~State} descriptor.to target\n     * @param {!module:lib/fsm~Fsm~Symbol} descriptor.by symbol\n     * @return {module:lib/fsm~Fsm~Transition} the newly created transition\n     */\n    static add(descriptor) {\n      // descriptor = checks.Transition.add.resolve(descriptor); TODO\n      descriptor = Object.assign({}, descriptor);\n      if(exception(descriptor)) return descriptor;\n      return addTransition(descriptor, new AugmentedTransition(arguments), data);\n    }\n    /**\n     * Removes a transition\n     * @param {module:lib/fsm~Fsm~Transition} transition - transition to remove\n     * @return {module:lib/fsm} the finite state machine\n     */\n    static remove(transition) {\n      // transition = checks.Transition.remove.resolve(transition); TODO\n      if(exception(transition)) return transition;\n      removeTransition(transition);\n      return struct;\n    }\n    /**\n     * Creates an iterator of transitions that match the selector attributes\n     * @param {Object} selector\n     * @param {?module:lib/fsm~Fsm~State} selector.from source\n     * @param {?module:lib/fsm~Fsm~State} selector.to target\n     * @param {?module:lib/fsm~Fsm~Symbol} selector.by symbol\n     * @return {Iterator.<module:lib/fsm~Fsm~Transition>} the selected transitions\n     */\n    static select(selector) {\n      // selector = checks.Transition.select.resolve(selector); TODO\n      selector = Object.assign({}, selector);\n      if(exception(selector)) return selector;\n      let args = [];\n      let getter = getTransitions;\n      if(selector.from != null) {\n        getter = getter.from;\n        args.push(selector.from);\n      }\n      if(selector.to != null) {\n        getter = getter.to;\n        args.push(selector.to);\n      }\n      if(selector.by != null) {\n        getter = getter.by;\n        args.push(selector.by);\n      }\n      args.push(data);\n      return getter.apply(null, args);\n    }\n\n    /**\n     * Creates nested iterators\n     * The transitions are first split by their source state, then their target\n     * states\n     * @return {Iterator.<Iterator.<Iterator.<module:lib/fsm~Fsm~Transition>>>} the collection\n     */\n    static groups() { return getTransitions.groups(data); }\n  };\n  \n  const AugmentedSymbol = cfg.mixins.symbols(Symbol);\n  const AugmentedState = cfg.mixins.states(State);\n  const AugmentedTransition = cfg.mixins.transitions(Transition);\n\n  /**\n   * @type {Class}\n   */\n  this.symbols = AugmentedSymbol;\n  /**\n   * @type {Class}\n   */\n  this.states = AugmentedState;\n  /**\n   * @type {Class}\n   */\n  this.transitions = AugmentedTransition;\n};\n\n// Logic\n\n// Conventions:\n//   - `a` is a symbol ; `as` is a collection of symbols\n//   - `s` is a state ; `ss` is a collection of states\n//   - `t` is a transition ; `ts` is a collection of transitions\n//   - `sf` is a source state (state from)\n//   - `st` is a target state (state to)\n\nconst addSymbol = (o, symbol, data) => {\n  o.tran = new Set();\n  data.symbols.set(symbol, o);\n  return symbol;\n};\n\nconst addState = (o, state, data) => {\n  o.succ = new Map();\n  o.pred = new Map();\n  data.states.set(state, o);\n  if(o.initial) {\n    data.states.initials.add(state);\n  }\n  if(o.terminal) {\n    data.states.terminals.add(state);\n  }\n  return state;\n};\n\nconst addTransition = (o, transition, data) => {\n  const succ = data.states.get(o.from).succ;\n  let as = succ.get(o.to);\n  if(as == null) {\n    as = new Map();\n    succ.set(o.to, as);\n  }\n  let t = as.get(o.by);\n  // TODO transition already exists\n  if(t == null) {\n    t = transition;\n    as.set(o.by, t);\n    const pred = data.states.get(o.to).pred;\n    let ts = pred.get(o.by);\n    if(ts == null) {\n      ts = new Set();\n      pred.set(o.by, ts);\n    }\n    ts.add(t);\n    data.symbols.get(o.by).tran.add(t);\n    data.transitions.set(t, o);\n  };\n  return t;\n};\n\nconst getTransition = (sf, st, a, data) => {\n  let as = data.states.get(sf).succ.get(st);\n  if(as == null) return null;\n  return as.get(a);\n};\n\nconst getSymbols = (data) => data.symbols.keys();\n\nconst getStates = (data) => data.states.keys();\n\nconst getInitialStates = (data) => data.states.initials.values();\n\nconst getTerminalStates = (data) => data.states.terminals.values();\n\nconst getTransitions = (data) => data.transitions.keys();\n\ngetTransitions.groups = () => utilsIterator.apply(\n  data.states.entries(),\n  ([sf, map1]) => {\n    const iter = utilsIterator.apply(\n      map1.entries(),\n      ([st, map2]) => {\n        const subiter = map2.values();\n        subiter.to = st;\n        return subiter;\n      }\n    );\n    iter.from = sf;\n    return iter;\n  }\n);\n\ngetTransitions.from = (sf) => utilsIterator.flatten(\n  data.states.get(sf).succ.values(),\n  (map) => map.values()\n);\n\ngetTransitions.to = (st) => states.get(st).pred.values();\n\ngetTransitions.by = (a) => symbols.get(a).transitions.values();\n\ngetTransitions.from.to = (sf, st) => states.get(sf).succ.get(st).values();\n\ngetTransitions.to.by = (st, a) => states.get(st).pred.get(a).values();\n\ngetTransitions.from.by = (sf, a) => utilsIterator.flatten(\n  states.get(sf).succ.values(),\n  (map) => {\n    let t = map.get(a);\n    if(t == null) {\n      return utilsIterator.empty();\n    }\n    return utilsIterator.wrap(t);\n  }\n);\n\ngetTransitions.from.to.by = (sf, st, a, data) => {\n  const t = getTransition(sf, st, a, data);\n  if(t == null) {\n    return utilsIterator.empty();\n  }\n  return utilsIterator.wrap(t);\n};\n\nconst removeSymbol = (a, data) => {\n  for(let t of getTransitions.by(a)) {\n    const o = data.transitions.get(t);\n    data.states.get(o.from).succ.get(o.from).delete(a);\n    data.states.get(o.to).pred.delete(a);\n    data.transitions.delete(t);\n  }\n  data.symbols.delete(a);\n};\n\nconst removeState = (s, data) => {\n  for(let t of getTransitions.to(s)) {\n    const o = data.transitions.get(t);\n    data.states.get(o.to).succ.delete(s);\n    data.symbols.get(o.by).transitions.delete(t);\n    data.transitions.delete(t);\n  }\n  for(let t of getTransitions.from(s)) {\n    const o = data.transitions.get(t);\n    data.states.get(o.from).pred.get(o.by).delete(t);\n    data.symbols.get(o.by).transitions.delete(t);\n    data.transitions.delete(t);\n  }\n  if(s.initial) {\n    data.states.initials.delete(s);\n  }\n  if(s.terminal) {\n    data.states.terminals.delete(s);\n  }\n  data.states.delete(s);\n};\n\nconst removeTransition = (t, data) => {\n  const o = data.transitions.get(t);\n  if(o != null) {\n    data.states.get(o.from).succ.get(o.to).delete(o.by);\n    data.states.get(o.to).pred.get(o.by).delete(t);\n    data.symbols.get(o.by).transitions.delete(t);\n    data.transitions.delete(t);\n  }\n};\n","\"use strict\";\n      Object.defineProperty(exports, \"__esModule\", {\n        value: true\n      });\n      exports.default = (function() {\n  \"use strict\";\n\n  /*\n   * Generated by PEG.js 0.9.0.\n   *\n   * http://pegjs.org/\n   */\n\n  function peg$subclass(child, parent) {\n    function ctor() { this.constructor = child; }\n    ctor.prototype = parent.prototype;\n    child.prototype = new ctor();\n  }\n\n  function peg$SyntaxError(message, expected, found, location) {\n    this.message  = message;\n    this.expected = expected;\n    this.found    = found;\n    this.location = location;\n    this.name     = \"SyntaxError\";\n\n    if (typeof Error.captureStackTrace === \"function\") {\n      Error.captureStackTrace(this, peg$SyntaxError);\n    }\n  }\n\n  peg$subclass(peg$SyntaxError, Error);\n\n  function peg$parse(input) {\n    var options = arguments.length > 1 ? arguments[1] : {},\n        parser  = this,\n\n        peg$FAILED = {},\n\n        peg$startRuleIndices = { start: 0 },\n        peg$startRuleIndex   = 0,\n\n        peg$consts = [\n          function(t, attrs, a) { \n              setAttrs(desc, attrs);\n              setLocations(loc, attrs);\n              if(desc.data.transitions == null) {\n                  throw exception.create(exception.MBToken, \"transitions\");\n              }\n              return {desc, loc};\n            },\n          function(t) {\n                  desc.type = t;\n                  loc.type = location();\n              },\n          \"states\",\n          { type: \"literal\", value: \"states\", description: \"\\\"states\\\"\" },\n          function(t, attrs, s) { \n              if(desc.data.states == null) {\n                desc.data.states = s.data ;\n                loc.data.states = s.location;\n                desc.defaults.states = {};\n                loc.defaults.states = {};\n                setAttrs(desc.defaults.states, attrs);\n                setLocations(loc.defaults.states, attrs);\n                loc.defaults.states[locationToken] = location();\n              } else {\n                  throw new exception.create(exception.ALDToken, \"states\", loc.defaults.states[locationToken], location());\n              }\n            },\n          \"symbols\",\n          { type: \"literal\", value: \"symbols\", description: \"\\\"symbols\\\"\" },\n          function(t, attrs, s) {\n              if(desc.data.symbols == null) {\n                desc.data.symbols = s.data;\n                loc.data.symbols = s.location;\n                desc.defaults.symbols = {};\n                loc.defaults.symbols = {};\n                setAttrs(desc.defaults.symbols, attrs);\n                setLocations(loc.defaults.symbols, attrs);\n                loc.defaults.symbols[locationToken] = location();\n              } else {\n                  throw new exception.create(exception.ALDToken, \"symbols\", loc.defaults.symbols[locationToken], location());\n              }\n            },\n          \"transitions\",\n          { type: \"literal\", value: \"transitions\", description: \"\\\"transitions\\\"\" },\n          function(attrs, t) {\n              if(desc.data.transitions == null) {\n                desc.data.transitions = t.data;\n                loc.data.transitions = t.location;\n                desc.defaults.transitions = {};\n                loc.defaults.transitions = {};\n                setAttrs(desc.defaults.transitions, attrs);\n                setLocations(loc.defaults.transitions, attrs);\n                loc.defaults.transitions[locationToken] = location();\n              } else {\n                  throw new exception.create(exception.ALDToken, \"transitions\", loc.defaults.transitions[locationToken], location());\n              }\n            },\n          function(states) {\n                return {\n                  data: states.map((s) => s.data),\n                  location: states.map((s) => s.location)\n                }\n            },\n          function(symbols) {\n              return {\n                  data: symbols.map((s) => s.data),\n                  location: symbols.map((s) => s.location)\n              }\n            },\n          function(transitions) {\n              let data = new Array();\n              let location = new Array();\n              for(var i = 0; i < transitions.length; i++) {\n                  for(var j = 0; j < transitions[i].data.to.length; j++) {\n                      data.push(setAttrs({\n                          from: transitions[i].data.from,\n                          by: transitions[i].data.by,\n                          to: transitions[i].data.to[j].data\n                      }, transitions[i].data.attrs));\n                      location.push(setLocations({\n                          from: transitions[i].location.from,\n                          by: transitions[i].location.by,\n                          to: transitions[i].data.to[j].location\n                      }, transitions[i].data.attrs));\n                  }\n              }\n              return {data, location}\n            },\n          function(id, attrs) {\n              return {\n                  data: setAttrs({id: id.data}, attrs),\n                  location: setLocations({\n                      id: location(),\n                  }, attrs)\n              };\n            },\n          function(id, attrs) {\n              return {\n                  data: setAttrs({id: id.data}, attrs),\n                  location: setLocations({\n                      id: location(),\n                  }, attrs),\n              }\n            },\n          \"->\",\n          { type: \"literal\", value: \"->\", description: \"\\\"->\\\"\" },\n          function(from, by, to, attrs) {\n              return {\n                  data: {from: from.data, by: by.data, to: to.data, attrs},\n                  location: {from: from.location, by:  by.location, to:  to.location, attrs}\n              };\n            },\n          \",\",\n          { type: \"literal\", value: \",\", description: \"\\\",\\\"\" },\n          function(i, l) {\n                  return {\n                      data: new Array(i).concat(l.data),\n                      location : new Array(location()).concat(l.location)\n                  }\n              },\n          function(i) { \n                  return {\n                      data: new Array(i),\n                      location: location()\n                  };\n              },\n          \"[\",\n          { type: \"literal\", value: \"[\", description: \"\\\"[\\\"\" },\n          \"]\",\n          { type: \"literal\", value: \"]\", description: \"\\\"]\\\"\" },\n          function(attrs) { return {\n                data: attrs.map((a) => a.data),\n                location: attrs.map((a) => a.location)\n              }; },\n          \"=\",\n          { type: \"literal\", value: \"=\", description: \"\\\"=\\\"\" },\n          function(name, value) { \n                let obj = {}, loc = {};\n                obj[name.data] = (value === \"true\");\n                loc[name.data] = name.location;\n                return {\n                  data: obj,\n                  location: loc\n                };\n              },\n          function(name, color) { \n                  let obj = {}, loc = {}; \n                  obj[name.data] = color; \n                  loc[name.data] = name.location;\n                  return {\n                      data: obj,\n                      location: loc\n                  };\n              },\n          function(name, value) { \n                  let obj = {}, loc = {}; \n                  obj[name.data] = value;\n                  loc[name.data] = name.location;\n                  return {\n                      data: obj,\n                      location: loc\n                  };\n              },\n          function(name, value) { \n                  let obj = {}, loc = {}; \n                  obj[name.data] = parseFloat(value); \n                  loc[name.data] = name.location;\n                  return {\n                      data: obj,\n                      location: loc\n                  };\n              },\n          function(name) { \n                  let obj = {}, loc = {}; \n                  obj[name.data] = true; \n                  loc[name.data] = name.location;\n                  return {\n                      data: obj,\n                      location: loc\n                  };\n              },\n          /^[a-zA-Z_0-9\\-]/,\n          { type: \"class\", value: \"[a-zA-Z_0-9\\\\-]\", description: \"[a-zA-Z_0-9\\\\-]\" },\n          function(id) {\n                  return {\n                      data: id,\n                      location: location()\n                  }\n              },\n          /^[^\"]/,\n          { type: \"class\", value: \"[^\\\\\\\"]\", description: \"[^\\\\\\\"]\" },\n          \"\\\"\",\n          { type: \"literal\", value: \"\\\"\", description: \"\\\"\\\\\\\"\\\"\" },\n          function(str) { return str; },\n          \"#\",\n          { type: \"literal\", value: \"#\", description: \"\\\"#\\\"\" },\n          function(color) { return color },\n          \".\",\n          { type: \"literal\", value: \".\", description: \"\\\".\\\"\" },\n          /^[0-9]/,\n          { type: \"class\", value: \"[0-9]\", description: \"[0-9]\" },\n          /^[a-fA-F0-9]/,\n          { type: \"class\", value: \"[a-fA-F0-9]\", description: \"[a-fA-F0-9]\" },\n          \"true\",\n          { type: \"literal\", value: \"true\", description: \"\\\"true\\\"\" },\n          \"false\",\n          { type: \"literal\", value: \"false\", description: \"\\\"false\\\"\" },\n          \"{\",\n          { type: \"literal\", value: \"{\", description: \"\\\"{\\\"\" },\n          \"}\",\n          { type: \"literal\", value: \"}\", description: \"\\\"}\\\"\" },\n          /^[ \\t\\n\\r]/,\n          { type: \"class\", value: \"[ \\\\t\\\\n\\\\r]\", description: \"[ \\\\t\\\\n\\\\r]\" }\n        ],\n\n        peg$bytecode = [\n          peg$decode(\"%;!/J#;;/A$;/.\\\" &\\\"/3$;\\\"/*$8$: $##! )($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;1/' 8!:!!! )\"),\n          peg$decode(\"%;9/5#;#/,$;:/#$+#)(#'#(\\\"'#&'#\"),\n          peg$decode(\"$;$0#*;$&\"),\n          peg$decode(\";%.) &;&.# &;'\"),\n          peg$decode(\"%2\\\"\\\"\\\"6\\\"7#/\\\\#;;/S$;/.\\\" &\\\"/E$;9/<$;(/3$;:/*$8&:$&#%#!)(&'#(%'#($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%2%\\\"\\\"6%7&/\\\\#;;/S$;/.\\\" &\\\"/E$;9/<$;)/3$;:/*$8&:'&#%#!)(&'#(%'#($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%2(\\\"\\\"6(7)/[#;;/R$;/.\\\" &\\\"/D$;9/;$;*/2$;:/)$8&:*&\\\"#!)(&'#(%'#($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%$;+0#*;+&/' 8!:+!! )\"),\n          peg$decode(\"%$;,0#*;,&/' 8!:,!! )\"),\n          peg$decode(\"%$;-0#*;-&/' 8!:-!! )\"),\n          peg$decode(\"%;1/@#;;/7$;/.\\\" &\\\"/)$8#:.#\\\"\\\" )(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;1/@#;;/7$;/.\\\" &\\\"/)$8#:/#\\\"\\\" )(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;1/\\x87#;;/~$;1/u$;;/l$20\\\"\\\"6071/]$;;/T$;./K$;;/B$;/.\\\" &\\\"/4$;;/+$8*:2*$)'#!)(*'#()'#(('#(''#(&'#(%'#($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;1/A#23\\\"\\\"6374/2$;./)$8#:5#\\\"\\\" )(#'#(\\\"'#&'#./ &%;1/' 8!:6!! )\"),\n          peg$decode(\"%27\\\"\\\"6778/Y#;;/P$$;00#*;0&/@$29\\\"\\\"697:/1$;;/($8%:;%!\\\")(%'#($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;1/\\\\#;;/S$2<\\\"\\\"6<7=/D$;;/;$;8/2$;;/)$8&:>&\\\"%!)(&'#(%'#($'#(#'#(\\\"'#&'#.\\u0116 &%;1/\\\\#;;/S$2<\\\"\\\"6<7=/D$;;/;$;4/2$;;/)$8&:?&\\\"%!)(&'#(%'#($'#(#'#(\\\"'#&'#.\\xCD &%;1/\\\\#;;/S$2<\\\"\\\"6<7=/D$;;/;$;3/2$;;/)$8&:@&\\\"%!)(&'#(%'#($'#(#'#(\\\"'#&'#.\\x84 &%;1/\\\\#;;/S$2<\\\"\\\"6<7=/D$;;/;$;5/2$;;/)$8&:A&\\\"%!)(&'#(%'#($'#(#'#(\\\"'#&'#.; &%;1/1#;;/($8\\\":B\\\"!!)(\\\"'#&'#\"),\n          peg$decode(\"%%$4C\\\"\\\"5!7D/,#0)*4C\\\"\\\"5!7D&&&#/\\\"!&,)/' 8!:E!! )\"),\n          peg$decode(\"$4F\\\"\\\"5!7G0)*4F\\\"\\\"5!7G&\"),\n          peg$decode(\"%2H\\\"\\\"6H7I/G#%;2/\\\"!&,)/7$2H\\\"\\\"6H7I/($8#:J#!!)(#'#(\\\"'#&'#\"),\n          peg$decode(\"%%%2K\\\"\\\"6K7L/\\x8C#%%;7/P#;7/G$;7/>$;7/5$;7/,$;7/#$+&)(&'#(%'#($'#(#'#(\\\"'#&'#.? &%;7/5#;7/,$;7/#$+#)(#'#(\\\"'#&'#/\\\"!&,)/#$+\\\")(\\\"'#&'#/\\\"!&,)/' 8!:M!! )\"),\n          peg$decode(\"%%$;6/&#0#*;6&&&#/W#%2N\\\"\\\"6N7O/9#$;6/&#0#*;6&&&#/#$+\\\")(\\\"'#&'#.\\\" &\\\"/#$+\\\")(\\\"'#&'#/\\\"!&,)\"),\n          peg$decode(\"4P\\\"\\\"5!7Q\"),\n          peg$decode(\"4R\\\"\\\"5!7S\"),\n          peg$decode(\"2T\\\"\\\"6T7U.) &2V\\\"\\\"6V7W\"),\n          peg$decode(\"%;;/;#2X\\\"\\\"6X7Y/,$;;/#$+#)(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;;/;#2Z\\\"\\\"6Z7[/,$;;/#$+#)(#'#(\\\"'#&'#\"),\n          peg$decode(\"$4\\\\\\\"\\\"5!7]0)*4\\\\\\\"\\\"5!7]&\")\n        ],\n\n        peg$currPos          = 0,\n        peg$savedPos         = 0,\n        peg$posDetailsCache  = [{ line: 1, column: 1, seenCR: false }],\n        peg$maxFailPos       = 0,\n        peg$maxFailExpected  = [],\n        peg$silentFails      = 0,\n\n        peg$result;\n\n    if (\"startRule\" in options) {\n      if (!(options.startRule in peg$startRuleIndices)) {\n        throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n      }\n\n      peg$startRuleIndex = peg$startRuleIndices[options.startRule];\n    }\n\n    function text() {\n      return input.substring(peg$savedPos, peg$currPos);\n    }\n\n    function location() {\n      return peg$computeLocation(peg$savedPos, peg$currPos);\n    }\n\n    function expected(description) {\n      throw peg$buildException(\n        null,\n        [{ type: \"other\", description: description }],\n        input.substring(peg$savedPos, peg$currPos),\n        peg$computeLocation(peg$savedPos, peg$currPos)\n      );\n    }\n\n    function error(message) {\n      throw peg$buildException(\n        message,\n        null,\n        input.substring(peg$savedPos, peg$currPos),\n        peg$computeLocation(peg$savedPos, peg$currPos)\n      );\n    }\n\n    function peg$computePosDetails(pos) {\n      var details = peg$posDetailsCache[pos],\n          p, ch;\n\n      if (details) {\n        return details;\n      } else {\n        p = pos - 1;\n        while (!peg$posDetailsCache[p]) {\n          p--;\n        }\n\n        details = peg$posDetailsCache[p];\n        details = {\n          line:   details.line,\n          column: details.column,\n          seenCR: details.seenCR\n        };\n\n        while (p < pos) {\n          ch = input.charAt(p);\n          if (ch === \"\\n\") {\n            if (!details.seenCR) { details.line++; }\n            details.column = 1;\n            details.seenCR = false;\n          } else if (ch === \"\\r\" || ch === \"\\u2028\" || ch === \"\\u2029\") {\n            details.line++;\n            details.column = 1;\n            details.seenCR = true;\n          } else {\n            details.column++;\n            details.seenCR = false;\n          }\n\n          p++;\n        }\n\n        peg$posDetailsCache[pos] = details;\n        return details;\n      }\n    }\n\n    function peg$computeLocation(startPos, endPos) {\n      var startPosDetails = peg$computePosDetails(startPos),\n          endPosDetails   = peg$computePosDetails(endPos);\n\n      return {\n        start: {\n          offset: startPos,\n          line:   startPosDetails.line,\n          column: startPosDetails.column\n        },\n        end: {\n          offset: endPos,\n          line:   endPosDetails.line,\n          column: endPosDetails.column\n        }\n      };\n    }\n\n    function peg$fail(expected) {\n      if (peg$currPos < peg$maxFailPos) { return; }\n\n      if (peg$currPos > peg$maxFailPos) {\n        peg$maxFailPos = peg$currPos;\n        peg$maxFailExpected = [];\n      }\n\n      peg$maxFailExpected.push(expected);\n    }\n\n    function peg$buildException(message, expected, found, location) {\n      function cleanupExpected(expected) {\n        var i = 1;\n\n        expected.sort(function(a, b) {\n          if (a.description < b.description) {\n            return -1;\n          } else if (a.description > b.description) {\n            return 1;\n          } else {\n            return 0;\n          }\n        });\n\n        while (i < expected.length) {\n          if (expected[i - 1] === expected[i]) {\n            expected.splice(i, 1);\n          } else {\n            i++;\n          }\n        }\n      }\n\n      function buildMessage(expected, found) {\n        function stringEscape(s) {\n          function hex(ch) { return ch.charCodeAt(0).toString(16).toUpperCase(); }\n\n          return s\n            .replace(/\\\\/g,   '\\\\\\\\')\n            .replace(/\"/g,    '\\\\\"')\n            .replace(/\\x08/g, '\\\\b')\n            .replace(/\\t/g,   '\\\\t')\n            .replace(/\\n/g,   '\\\\n')\n            .replace(/\\f/g,   '\\\\f')\n            .replace(/\\r/g,   '\\\\r')\n            .replace(/[\\x00-\\x07\\x0B\\x0E\\x0F]/g, function(ch) { return '\\\\x0' + hex(ch); })\n            .replace(/[\\x10-\\x1F\\x80-\\xFF]/g,    function(ch) { return '\\\\x'  + hex(ch); })\n            .replace(/[\\u0100-\\u0FFF]/g,         function(ch) { return '\\\\u0' + hex(ch); })\n            .replace(/[\\u1000-\\uFFFF]/g,         function(ch) { return '\\\\u'  + hex(ch); });\n        }\n\n        var expectedDescs = new Array(expected.length),\n            expectedDesc, foundDesc, i;\n\n        for (i = 0; i < expected.length; i++) {\n          expectedDescs[i] = expected[i].description;\n        }\n\n        expectedDesc = expected.length > 1\n          ? expectedDescs.slice(0, -1).join(\", \")\n              + \" or \"\n              + expectedDescs[expected.length - 1]\n          : expectedDescs[0];\n\n        foundDesc = found ? \"\\\"\" + stringEscape(found) + \"\\\"\" : \"end of input\";\n\n        return \"Expected \" + expectedDesc + \" but \" + foundDesc + \" found.\";\n      }\n\n      if (expected !== null) {\n        cleanupExpected(expected);\n      }\n\n      return new peg$SyntaxError(\n        message !== null ? message : buildMessage(expected, found),\n        expected,\n        found,\n        location\n      );\n    }\n\n    function peg$decode(s) {\n      var bc = new Array(s.length), i;\n\n      for (i = 0; i < s.length; i++) {\n        bc[i] = s.charCodeAt(i) - 32;\n      }\n\n      return bc;\n    }\n\n    function peg$parseRule(index) {\n      var bc    = peg$bytecode[index],\n          ip    = 0,\n          ips   = [],\n          end   = bc.length,\n          ends  = [],\n          stack = [],\n          params, i;\n\n      while (true) {\n        while (ip < end) {\n          switch (bc[ip]) {\n            case 0:\n              stack.push(peg$consts[bc[ip + 1]]);\n              ip += 2;\n              break;\n\n            case 1:\n              stack.push(void 0);\n              ip++;\n              break;\n\n            case 2:\n              stack.push(null);\n              ip++;\n              break;\n\n            case 3:\n              stack.push(peg$FAILED);\n              ip++;\n              break;\n\n            case 4:\n              stack.push([]);\n              ip++;\n              break;\n\n            case 5:\n              stack.push(peg$currPos);\n              ip++;\n              break;\n\n            case 6:\n              stack.pop();\n              ip++;\n              break;\n\n            case 7:\n              peg$currPos = stack.pop();\n              ip++;\n              break;\n\n            case 8:\n              stack.length -= bc[ip + 1];\n              ip += 2;\n              break;\n\n            case 9:\n              stack.splice(-2, 1);\n              ip++;\n              break;\n\n            case 10:\n              stack[stack.length - 2].push(stack.pop());\n              ip++;\n              break;\n\n            case 11:\n              stack.push(stack.splice(stack.length - bc[ip + 1], bc[ip + 1]));\n              ip += 2;\n              break;\n\n            case 12:\n              stack.push(input.substring(stack.pop(), peg$currPos));\n              ip++;\n              break;\n\n            case 13:\n              ends.push(end);\n              ips.push(ip + 3 + bc[ip + 1] + bc[ip + 2]);\n\n              if (stack[stack.length - 1]) {\n                end = ip + 3 + bc[ip + 1];\n                ip += 3;\n              } else {\n                end = ip + 3 + bc[ip + 1] + bc[ip + 2];\n                ip += 3 + bc[ip + 1];\n              }\n\n              break;\n\n            case 14:\n              ends.push(end);\n              ips.push(ip + 3 + bc[ip + 1] + bc[ip + 2]);\n\n              if (stack[stack.length - 1] === peg$FAILED) {\n                end = ip + 3 + bc[ip + 1];\n                ip += 3;\n              } else {\n                end = ip + 3 + bc[ip + 1] + bc[ip + 2];\n                ip += 3 + bc[ip + 1];\n              }\n\n              break;\n\n            case 15:\n              ends.push(end);\n              ips.push(ip + 3 + bc[ip + 1] + bc[ip + 2]);\n\n              if (stack[stack.length - 1] !== peg$FAILED) {\n                end = ip + 3 + bc[ip + 1];\n                ip += 3;\n              } else {\n                end = ip + 3 + bc[ip + 1] + bc[ip + 2];\n                ip += 3 + bc[ip + 1];\n              }\n\n              break;\n\n            case 16:\n              if (stack[stack.length - 1] !== peg$FAILED) {\n                ends.push(end);\n                ips.push(ip);\n\n                end = ip + 2 + bc[ip + 1];\n                ip += 2;\n              } else {\n                ip += 2 + bc[ip + 1];\n              }\n\n              break;\n\n            case 17:\n              ends.push(end);\n              ips.push(ip + 3 + bc[ip + 1] + bc[ip + 2]);\n\n              if (input.length > peg$currPos) {\n                end = ip + 3 + bc[ip + 1];\n                ip += 3;\n              } else {\n                end = ip + 3 + bc[ip + 1] + bc[ip + 2];\n                ip += 3 + bc[ip + 1];\n              }\n\n              break;\n\n            case 18:\n              ends.push(end);\n              ips.push(ip + 4 + bc[ip + 2] + bc[ip + 3]);\n\n              if (input.substr(peg$currPos, peg$consts[bc[ip + 1]].length) === peg$consts[bc[ip + 1]]) {\n                end = ip + 4 + bc[ip + 2];\n                ip += 4;\n              } else {\n                end = ip + 4 + bc[ip + 2] + bc[ip + 3];\n                ip += 4 + bc[ip + 2];\n              }\n\n              break;\n\n            case 19:\n              ends.push(end);\n              ips.push(ip + 4 + bc[ip + 2] + bc[ip + 3]);\n\n              if (input.substr(peg$currPos, peg$consts[bc[ip + 1]].length).toLowerCase() === peg$consts[bc[ip + 1]]) {\n                end = ip + 4 + bc[ip + 2];\n                ip += 4;\n              } else {\n                end = ip + 4 + bc[ip + 2] + bc[ip + 3];\n                ip += 4 + bc[ip + 2];\n              }\n\n              break;\n\n            case 20:\n              ends.push(end);\n              ips.push(ip + 4 + bc[ip + 2] + bc[ip + 3]);\n\n              if (peg$consts[bc[ip + 1]].test(input.charAt(peg$currPos))) {\n                end = ip + 4 + bc[ip + 2];\n                ip += 4;\n              } else {\n                end = ip + 4 + bc[ip + 2] + bc[ip + 3];\n                ip += 4 + bc[ip + 2];\n              }\n\n              break;\n\n            case 21:\n              stack.push(input.substr(peg$currPos, bc[ip + 1]));\n              peg$currPos += bc[ip + 1];\n              ip += 2;\n              break;\n\n            case 22:\n              stack.push(peg$consts[bc[ip + 1]]);\n              peg$currPos += peg$consts[bc[ip + 1]].length;\n              ip += 2;\n              break;\n\n            case 23:\n              stack.push(peg$FAILED);\n              if (peg$silentFails === 0) {\n                peg$fail(peg$consts[bc[ip + 1]]);\n              }\n              ip += 2;\n              break;\n\n            case 24:\n              peg$savedPos = stack[stack.length - 1 - bc[ip + 1]];\n              ip += 2;\n              break;\n\n            case 25:\n              peg$savedPos = peg$currPos;\n              ip++;\n              break;\n\n            case 26:\n              params = bc.slice(ip + 4, ip + 4 + bc[ip + 3]);\n              for (i = 0; i < bc[ip + 3]; i++) {\n                params[i] = stack[stack.length - 1 - params[i]];\n              }\n\n              stack.splice(\n                stack.length - bc[ip + 2],\n                bc[ip + 2],\n                peg$consts[bc[ip + 1]].apply(null, params)\n              );\n\n              ip += 4 + bc[ip + 3];\n              break;\n\n            case 27:\n              stack.push(peg$parseRule(bc[ip + 1]));\n              ip += 2;\n              break;\n\n            case 28:\n              peg$silentFails++;\n              ip++;\n              break;\n\n            case 29:\n              peg$silentFails--;\n              ip++;\n              break;\n\n            default:\n              throw new Error(\"Invalid opcode: \" + bc[ip] + \".\");\n          }\n        }\n\n        if (ends.length > 0) {\n          end = ends.pop();\n          ip = ips.pop();\n        } else {\n          break;\n        }\n      }\n\n      return stack[0];\n    }\n\n\n        const init = require(\"./init.js\");\n        const setAttrs = init.setAttrs;\n        const setLocations = init.setLocations;\n        const locationToken = init.locationToken;\n        const exception = init.exception;\n\n        let desc = {\n          defaults: {},\n          data: {}\n        }\n\n        let loc = {\n          defaults: {},\n          data: {}\n        };\n\n\n\n    peg$result = peg$parseRule(peg$startRuleIndex);\n\n    if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n      return peg$result;\n    } else {\n      if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n        peg$fail({ type: \"end\", description: \"end of input\" });\n      }\n\n      throw peg$buildException(\n        null,\n        peg$maxFailExpected,\n        peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null,\n        peg$maxFailPos < input.length\n          ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)\n          : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)\n      );\n    }\n  }\n\n  return {\n    SyntaxError: peg$SyntaxError,\n    parse:       peg$parse\n  };\n})()","import grammar from \"./grammar\";\nimport {exception} from \"../utils/check\";\n\nexception.syntax = exception.register(\n    \"SyntaxException\", \n    function (expected, found, location) {\n      this.expected = expected;\n      this.found = found;\n      this.location = location;\n    }\n);\n\nfunction parse(aml) {\n  let l;\n  try {\n    l = grammar.parse(aml);\n  } catch (err) {\n    if(err instanceof grammar.SyntaxError) {\n      return exception.create(exception.syntax, err.expected, err.found, err.location); \n    } else {\n      return err;\n    }\n  }\n  return l;\n}\n\nexport default { parse };\n","import {exception} from \"../utils/check\"\n\nconst locationToken = Symbol(\"location token\");\n\n\nfunction setAttrs(obj, attrs) {\n  if(attrs != null) {\n    for (var i = 0; i < attrs.data.length; i++) {\n      Object.assign(obj, attrs.data[i]);\n    }\n  }\n  return obj;\n}\n\nfunction setLocations(obj, attrs) {\n  if(attrs != null) {\n    for (var i = 0; i < attrs.location.length; i++) {\n      Object.assign(obj, attrs.location[i]);\n    }\n  }\n  return obj;\n}\n\nexception.ALDToken = exception.register(\n    \"AlreadyDefinedException\", \n    function (type, loc1, loc2) {\n      this.type = type;\n      this.loc1 = loc1;\n      this.loc2 = loc2;\n    }\n);\n\nexception.MBToken = exception.register(\n    \"MissingBlockException\",\n    function(type) {\n      this.type = type;\n    }\n);\n\n\nexport { setAttrs, setLocations, exception, locationToken};\n","import {default as check, exception} from \"./utils/check\";\nimport sketchFsm from \"./sketchFsm\";\nimport parser from \"./parser\";\n\nconst steps = { };\n\nexport default function pipeline(aml) {\n  const l = parser.parse(aml);\n  log.warn(l);\n  if(exception(l)) { return l; }\n  const desc = makePipeline()\n  .deepCompose(steps.config)\n  .deepCompose(steps.redundancy)\n  .deepCompose(steps.inference)\n  .compose(steps.gather)\n  .deepCompose(steps.indexes)\n  .resolve(l.desc);\n  if(exception(desc)) {\n    log.error(desc);\n    log.error(desc.message);\n    return putLoc(desc, l.loc);\n  }\n  const fsm = sketchFsm(desc);\n  if(exception(fsm)) {\n    return putLoc(fsm, l.loc.data);\n  }\n  return fsm;\n}\n\nfunction putLoc(errs, loc) {\n  errs.dispatch({\n    [exception.object]: (err) => {\n      err.onEachProperty((e, prop) => {\n        putLoc(e, loc[prop]);\n      })\n    },\n    [exception.array]: (err) => {\n      err.onEach((e, i) => {\n        putLoc(e, loc[i]);\n      })\n    },\n    // TODO fetch error location for redundancies\n    default: (err) => {\n      err.loc = loc;\n    }\n  });\n  return errs;\n}\n\nfunction makePipeline() {\n  const p = check().object();\n  p.resolve = resolve;\n  return p;\n}\n\nexception.existingId = exception.register(\n  \"ExistingId\",\n  function(value, type) {\n    this.type = type;\n    this.value = value;\n    this.message = `ExistingId: Id ${value} of ${type} already in use`;\n  }\n);\nexception.unknownId = exception.register(\"UnknownId\");\nexception.fsmType = exception.register(\n  \"WrongFsmType\",\n  function(type) {\n    this.type = type;\n    this.message = `WrongFsmType: \\\n      ${type} is not a valid finite state machine type`;\n  }\n);\n\nconst symbolsIds = new Map();\nconst statesIds = new Map();\nconst symbolsIndexes = new Map();\nconst statesIndexes = new Map();\nlet symbolIndex = 0;\nlet stateIndex = 0;\n\nfunction cleanup() {\n  symbolsIds.clear();\n  statesIds.clear();\n  symbolsIndexes.clear();\n  statesIndexes.clear();\n  symbolIndex = 0;\n  stateIndex = 0;\n};\n\nfunction resolve(...args) {\n  const result = this.constructor.prototype.resolve.apply(this, args);\n  cleanup();\n  return result;\n};\n\nconst color = check().ofType(\"string\"); // TODO\ncolor.opt = check().optional().compose(color);\nconst bool = check().ofType(\"boolean\");\nbool.opt = check().optional().compose(bool);\nconst integer = check().ofType(\"number\"); // TODO\ninteger.opt = check().optional().compose(integer);\n\nconst fsmType = check().defaults(\"finite-state-machine\");\n\nconst tagsSymbol = check().object({\n  color: color.opt,\n  bold: bool.opt,\n  italic: bool.opt\n});\n\nconst tagsState = check().object({\n  color: color.opt,\n  \"border-color\": color.opt,\n  \"text-color\": color.opt,\n  \"background-color\": color.opt,\n  bold: bool.opt,\n  italic: bool.opt,\n  width: integer.opt, \n  height: integer.opt\n});\n\nconst tagsTransition = check().object({\n  \"text-color\": color.opt,\n  bold: bool.opt,\n  italic: bool.opt\n});\n\nsteps.gather = check().object({\n  data: check().object({\n    symbols: check().add(() => symbolsIds.values()),\n    states: check().add(() => statesIds.values())\n  })\n}, true, [\"symbols\", \"states\", \"transitions\"]);\n\nsteps.indexes = check().object({\n  data: check().object({\n    symbols: check().iterable(check().add((a) => {\n      symbolsIndexes.set(a.id, symbolIndex++);\n      return a;\n    })),\n    states: check().iterable(check().add((s) => {\n      statesIndexes.set(s.id, stateIndex++);\n      return s;\n    })),\n    transitions: check().iterable(check().add((t) => {\n      t.from = statesIndexes.get(t.from);\n      t.to = statesIndexes.get(t.to);\n      t.by = symbolsIndexes.get(t.by);\n      return t;\n    }))\n  }) \n});\n\nsteps.config = check().object({\n  type: fsmType,\n  color: color.opt,\n  bold: bool.opt,\n  italic: bool.opt,\n  defaults: check().object({\n    symbols: check().object({}, true).deepCompose(tagsSymbol),\n    states: check().object({}, true).deepCompose(tagsState),\n    transitions: check().object({}, true).deepCompose(tagsTransition)\n  }, true),\n  data: check().object({}, true, [\"symbols\", \"states\", \"transitions\"])\n}, true);\n\nsteps.redundancy = check().object({\n  data: check().object({\n    symbols: check().iterable(check().object({\n      id: check().add((id, a) => {\n        if(symbolsIds.has(id)) {\n          return exception.create(exception.existingId, id, \"symbol\");\n        }\n        symbolsIds.set(id, a);\n        return id;\n      })\n    })),\n    states: check().iterable(check().object({\n      id: check().add((id, s) => {\n        if(statesIds.has(id)) {\n          return exception.create(exception.existingId, id, \"state\");\n        }\n        statesIds.set(id, s);\n        return id;\n      })\n    }))\n  })\n});\n\nsteps.inference = check().object({\n  data: check().object({\n    transitions: check().iterable(check().object({\n      from: check().add((from) => {\n        if(!statesIds.has(from)) {\n          statesIds.set(from, {id: from});\n        }\n        return from;\n      }),\n      to: check().add((to) => {\n        if(!statesIds.has(to)) {\n          statesIds.set(to, {id: to});\n        }\n        return to;\n      }),\n      by: check().add((by) => {\n        if(!symbolsIds.has(by)) {\n          symbolsIds.set(by, {id: by});\n        }\n        return by;\n      })\n    }))\n  })\n});\n\nsteps.strictness = check().object({\n  data: check().object({\n    transitions: check().iterable(check().object({\n      from: check().add((from) => {\n        if(!statesIds.has(from)) {\n          return exception.create(exception.unknownId, from, \"state\");\n        }\n        return from;\n      }),\n      to: check().add((to) => {\n        if(!statesIds.has(to)) {\n          return exception.create(exception.unknownId, to, \"state\");\n        }\n        return to;\n      }),\n      by: check().add((by) => {\n        if(!symbolsIds.has(by)) {\n          return exception.create(exception.unknownId, by, \"symbols\");\n        }\n        return by;\n      })\n    }))\n  })\n});\n\nexport const checks = {\n  color,\n  bool,\n  integer\n};\n","import {default as check, exception} from \"./utils/check\";\nimport fsm from \"./fsm\";\nimport { checks } from \"./pipeline\";\nimport dagre from \"dagre\";\nimport precedence, {lazy as lazyPrecedence} from \"./utils/precedence\";\n\nexport default function sketchFsm(cfg) {\n  return new Fsm(cfg);\n}\n\nfunction Fsm(cfg) {\n\n  const data = {\n    color: cfg.color,\n    bold: cfg.color,\n    italic: cfg.color\n  };\n\n  data.symbols = new WeakMap();\n  data.states = new WeakMap();\n  data.transitions = new WeakMap();\n  data.edges = new Map();\n\n  data.symbols.ids = new Map();\n  data.states.ids = new Map();\n\n  checks.label = check().optional().ofType(\"string\");\n\n  checks.symbolId = check().mandatory().ofType(\"string\").add((id) => {\n    return data.symbols.ids.has(id) ? exception.create(exception.existingId) : id;\n  });\n\n  const symbolsMixin = (FsmSymbol) => {\n    class Symbol extends FsmSymbol {\n      get id() { return data.symbols.get(this).id; }\n      get label() {\n        const symData = data.symbols.get(this);\n        return symData.label != null ? symData.label : symData.id;\n      }\n      get description() {\n        const a = data.symbols.get(this);\n        const d = {};\n        for(let prop of [ \"id\", \"label\", \"color\", \"bold\", \"italic\" ]) {\n          d[prop] = a[prop];\n        }\n        return d;\n      }\n      static add(descriptor) {\n        descriptor = check().object({\n          id: checks.symbolId,\n          label: checks.label,\n          color: checks.color.opt,\n          bold: checks.bool.opt,\n          italic: checks.bool.opt\n        }).resolve(descriptor);\n        if(exception(descriptor)) { return descriptor; }\n        const symbol = super.add();\n        if(exception(symbol)) { return symbol; }\n        data.symbols.set(symbol, descriptor);\n        data.symbols.ids.set(descriptor.id, symbol);\n        return symbol;\n      }\n    }\n    addAccessors(Symbol.prototype, \"symbols\", data, {\n      color: { check: checks.color },\n      bold: { check: checks.bool, default: false },\n      italic: { check: checks.bool, default: false }\n    });\n    return Symbol;\n  };\n\n  checks.stateId = check().mandatory().ofType(\"string\").add((id) => {\n    return data.states.ids.has(id) ? exception.create(exception.existingId) : id;\n  });\n\n  const statesMixin = (FsmState) => {\n    class State extends FsmState {\n      get id() { return data.states.get(this).id; }\n      get label() {\n        const stateData = data.states.get(this);\n        return stateData.label != null ? stateData.label : stateData.id;\n      }\n      get description() {\n        const s = data.states.get(this);\n        const d = {};\n        const properties = [\n          \"label\", \"x\", \"y\", \"width\", \"height\", \"color\", \"border-color\",\n          \"text-color\", \"background-color\", \"bold\", \"italic\"\n        ];\n        for(let prop of properties) {\n          d[prop] = s[prop];\n        }\n        d.initial = super.initial;\n        d.terminal = super.terminal;\n        return d;\n      }\n      static add(descriptor) {\n        // TODO check\n        descriptor = Object.assign({}, descriptor);\n        const state = FsmState.add({\n          initial: descriptor.initial,\n          terminal: descriptor.terminal\n        });\n        if(exception(state)) { return state; }\n        data.states.set(state, descriptor);\n        data.states.ids.set(descriptor.id, state);\n        return state;\n      }\n    }\n    addAccessors(State.prototype, \"states\", data, {\n      x: { check: checks.integer, precedence: [\n        function() { return data.states.get(this).x; },\n        function() { return data.states.get(this).computedX; },\n        () => 0\n      ], default: 0 },\n      y: { check: checks.integer, precedence: [\n        function() { return data.states.get(this).y; },\n        function() { return data.states.get(this).computedY; },\n        () => 0\n      ], default: 0 },\n      border_color: { check: checks.color, precedence: [\n        function() { return data.states.get(this).color; },\n        () => data.defaults.states[\"border-color\"],\n        () => data.defaults.states.color,\n        () => data.color\n      ]},\n      text_color: { check: checks.color, precedence: [\n        function() { return data.states.get(this).color; },\n        () => data.defaults.states[\"text-color\"],\n        () => data.defaults.states.color,\n        () => data.color\n      ]},\n      background_color: { check: checks.color },\n      bold: { check: checks.bool, default: false },\n      italic: { check: checks.bool, default: false },\n      height: { check: checks.integer, precedence: [ /*TODO*/ () => 60 ]},\n      width: { check: checks.integer, precedence: [ /*TODO*/ () => 60 ]}\n    });\n    return State;\n  };\n\n  const transitionsMixin = (FsmTransition) => {\n    class Transition extends FsmTransition {\n      get description() {\n        const t = data.transitions.get(this);\n        const d = {};\n        for(let prop of [ \"text-color\", \"bold\", \"italic\" ]) {\n          d[prop] = t[prop];\n        }\n        d.from = super.from;\n        d.to = super.to;\n        d.by = super.by;\n        return d;\n      }\n      static add(descriptor) {\n        // TODO check\n        descriptor = Object.assign({}, descriptor);\n        const transition = super.add({\n          from: descriptor.from,\n          to: descriptor.to,\n          by: descriptor.by\n        });\n        if(exception(transition)) { return transition; }\n        data.transitions.set(transition, descriptor);\n        // TODO cleanup - add edge\n        let fromDesc, sameFrom, edge;\n        fromDesc = data.states.get(transition.from);\n        sameFrom = fromDesc.edges;\n        if(sameFrom === undefined) {\n          sameFrom = new Map();\n          fromDesc.edges = sameFrom;\n        } \n        edge = sameFrom.get(transition.to);\n        if(edge === undefined) {\n          edge = new Edge();\n          sameFrom.set(transition.to, edge);\n          data.edges.set(edge, {\n            from: transition.from,\n            to: transition.to,\n            transitions: new Set([transition])\n          });\n        } else {\n          data.edges.get(edge).transitions.add(transition);\n        }\n        return transition;\n      }\n    }\n    addAccessors(Transition.prototype, \"transitions\", data, {\n      text_color: { check: checks.color, precedence: [\n        function() { return data.symbols.get(this.by).color; },\n        () => data.defaults.transitions.color,\n        () => data.defaults.symbols.color,\n        () => data.color\n      ], default: false },\n      bold: { check: checks.bool, precedence: [\n        function() { return data.symbols.get(this.by).bold; },\n        () => data.defaults.transitions.bold,\n        () => data.defaults.symbols.bold,\n        () => data.bold\n      ], default: false },\n      italic: { check: checks.bool, precedence: [\n        function() { return data.symbols.get(this.by).italic; },\n        () => data.defaults.transitions.italic,\n        () => data.defaults.symbols.italic,\n        () => data.italic\n      ], default:false }\n    });\n    return Transition;\n  };\n\n  // TODO sort symbols\n  class Edge {\n    get symbols() {\n      return Array.from(\n        data.edges.get(this).transitions,\n        (t) => t.by);\n    }\n    get from() {\n      return data.edges.get(this).from;\n    }\n    get to() {\n      return data.edges.get(this).to;\n    }\n    get points() {\n      const edgeData = data.edges.get(this);\n      const points = copyPoints(precedence(\n        edgeData.controls,\n        edgeData.computedControls,\n        []));\n      points.splice(0, 0, {x: edgeData.from.x(), y: edgeData.from.y()});\n      points.splice(points.length, 0, {x: edgeData.to.x(), y: edgeData.to.y()});\n      return points;\n    }\n    static all() {\n      return data.edges.keys();\n    }\n  }\n  addAccessors(Edge.prototype, \"edges\", data, {\n    controls: { check: check().iterable() /*TODO*/, precedence: [\n      function() { return copyPoints(data.edges.get(this).computedControls); }\n    ]},\n    height: { check: checks.integer, precedence: [], default: 0},\n    width: { check: checks.integer, precedence: [], default: 0},\n    x: { check: checks.integer, precedence: [\n      function() { return data.edges.get(this).computedX; }\n    ], default: 0 },\n    y: { check: checks.integer, precedence: [\n      function() { return data.edges.get(this).computedY; }\n    ], default: 0 },\n    label: { check: check().iterable(), precedence: [\n      function() { return data.edges.get(this).label; },\n      function() {\n        return Array.from(\n          data.edges.get(this).transitions,\n          (t) => t.by.label)\n          .join(\", \");\n      }\n    ]}\n  });\n\n  function computeLayout() {\n    let graph = new dagre.graphlib.Graph({\n      directed: true\n    }).setGraph({\n      marginx: 30,\n      marginy: 30,\n      nodesep: 30,\n      ranksep: 30,\n      edgesep: 20,\n      rankdir: \"LR\"\n    });\n\n    function addState(s) {\n      graph.setNode(s.id, {\n        width: s.width(),\n        height: s.height(),\n        label: s.label,\n        state: s\n      });\n    }\n\n    function addEdge(e) {\n      graph.setEdge(e.from.id, e.to.id, {\n        width: e.width(),\n        height: e.height(),\n        label: e.label,\n        labelpos: \"c\",\n        edge: e\n      });\n    }\n\n    for(let s of data.fsm.states.initials()) {\n      addState(s);\n    }\n    for(let s of data.fsm.states.all()) {\n      if(!s.initial) { addState(s); }\n    }\n    for(let e of Edge.all()) {\n      addEdge(e);\n    }\n    dagre.layout(graph);\n    for(let n of graph.nodes()) {\n      n = graph.node(n);\n      const stateData = data.states.get(n.state);\n      stateData.computedX = n.x;\n      stateData.computedY = n.y;\n    }\n    for(let e of graph.edges()) {\n      e = graph.edge(e.v, e.w);\n      const edgeData = data.edges.get(e.edge);\n      const points = copyPoints(e.points);\n      const labelPos = points[(points.length - 1) / 2];\n      edgeData.computedX = labelPos.x;\n      edgeData.computedY = labelPos.y;\n      points.splice(0, 1);\n      points.splice(points.length - 1, 1);\n      edgeData.computedControls = points;\n    }\n    return this;\n  };\n\n  data.fsm = fsm({\n    mixins: {\n      symbols: symbolsMixin,\n      states: statesMixin,\n      transitions: transitionsMixin\n    }\n  });\n\n  this.symbols = data.fsm.symbols;\n  this.states = data.fsm.states;\n  this.transitions = data.fsm.transitions;\n  this.edges = Edge;\n  this.layout = computeLayout;\n\n  const importError = fromTree(cfg.data, this, data);\n\n  if(exception(importError)) {\n    return importError;\n  }\n\n  log.debug(data);\n}\n\nconst randomHash = () => Math.random().toString(36).substring(2);\n\nconst randomId = (ids) => {\n  let id;\n  do {\n    id = randomHash();\n  } while(ids.has(id));\n  return id;\n};\n\nconst fromTree = (descriptor, struct, data) => {\n  const errors = {};\n  let hasErrors = false;\n\n  let symbols = check()\n  .iterable(check().add((a) => {\n    return struct.symbols.add(a);\n  })).resolve(descriptor.symbols);\n\n  let states = check()\n  .iterable(check().add((s) => {\n    return struct.states.add(s);\n  }))\n  .resolve(descriptor.states);\n\n  const dummyDescriptor = {};\n\n  if(exception(symbols)) {\n    errors.symbols = symbols;\n    symbols = symbols.output;\n    for(let i = 0, dummySymbol; i < symbols.length; i++) {\n      if(symbols[i] === undefined) {\n        dummyDescriptor.id = randomId(data.symbols.ids);\n        // TODO bypass it\n        dummySymbol = struct.symbols.add(dummyDescriptor);\n        // Assuming this doesn't fail\n        if(exception(dummySymbol)) { throw dummySymbol; }\n        symbols[i] = dummySymbol;\n      }\n    }\n    hasErrors = true;\n  }\n\n  if(exception(states)) {\n    errors.states = states;\n    states = states.output;\n    for(let i = 0, dummyState; i < states.length; i++) {\n      if(states[i] === undefined) {\n        // TODO bypass it\n        dummyDescriptor.id = randomId(data.states.ids);\n        dummyState = struct.states.add(dummyDescriptor);\n        // Assuming this doesn't fail\n        if(exception(dummyState)) { throw dummyState; }\n        states[i] = dummyState;\n      }\n    }\n    hasErrors = true;\n  }\n\n  let transitions = check().iterable(check().add((t) => {\n    const d = Object.assign({}, t);\n    d.from = states[t.from];\n    d.to = states[t.to];\n    d.by = symbols[t.by];\n    return struct.transitions.add(d);\n  })).resolve(descriptor.transitions);\n\n  if(exception(transitions)) {\n    errors.transitions = transitions;\n    transitions = transitions.output;\n    hasErrors = true;\n  }\n\n  if(hasErrors) {\n    return check().object({\n      symbols: check(),\n      states: check(),\n      transitions: check()\n    }).resolve(errors);\n  }\n\n};\n\nconst copyPoints = (points) => {\n  if(points == null) { return points; }\n  return points.map((p) => Object.assign({}, p));\n};\n\nconst addAccessors = (proto, kind, data, object) => {\n  let arg;\n  for(let method of Object.keys(object)) {\n    arg = object[method];\n    makeAccessor(\n      proto, kind,\n      method.replace(\"_\", \"-\"), method,\n      arg.check, data, arg.precedence, arg.default);\n  }\n};\n\nconst makeAccessor = (proto, kind, prop, method, check, data, callbacks, defaults) => {\n  if(callbacks === undefined) {\n    callbacks = [\n      () => data.defaults[kind][prop],\n      () => data[prop]\n    ];\n  }\n  if(defaults !== undefined) {\n    callbacks.push(() => defaults);\n  }\n  callbacks.unshift(function() {\n    return data[kind].get(this)[prop];\n  });\n  proto[method] = function(arg) {\n    if(arg === undefined) {\n      return lazyPrecedence(this, callbacks);\n    }\n    arg = check.resolve(arg);\n    if(exception(arg)) return arg;\n    data[kind].get(this)[prop] = arg;\n    return this;\n  };\n};\n\n","export default function fsmStyle(fsm) {\n\n  const states = new WeakMap();\n  const transitions = new WeakMap();\n  const symbols = new WeakMap();\n\n  const stateStyle = (s) => states.get(s);\n  const transitionStyle = (t) => transitions.get(t);\n  const symbolStyle = (a) => symbols.get(a);\n\n  const defaultStateStyle = {\n  };\n  const defaultTransitionStyle = {\n  };\n  const defaultSymbolStyle = {\n  };\n  \n  Object.defineProperties(fsm.statePrototype, {\n  });\n\n  Object.defineProperties(fsm.transitionPrototype, {\n  });\n\n  Object.defineProperties(fsm.symbolPrototype, {\n  });\n  \n  const stateBuilder = fsm.state;\n  fsm.state = (content) => {\n    const builder = stateBuilder(content);\n    const style = Object.assign({}, defaultStateStyle);\n\n    return builder;\n  };\n\n  const transitionBuilder = fsm.transition;\n  fsm.transition = (content) => {\n    const builder = transitionBuilder(content);\n    const style = Object.assign({}, defaultTransitionStyle);\n\n    return builder;\n  };\n\n  const symbolBuilder = fsm.symbol;\n  fsm.symbol = (content) => {\n    const builder = symbolBuilder(content);\n    const style = Object.assign({}, defaultSymbolStyle);\n\n    return builder;\n  };\n\n  return fsm;\n};\n","import sketchFsm from \"./sketchFsm\";\n\nexport const fsmFromTree = function(input) {\n  const struct = sketchFsm();\n\n  input.states.forEach((s) => {\n    if(s.initial == null) s.initial = false;\n    if(s.terminal == null) s.terminal = false;\n    struct.states.add(s);\n  });\n\n  input.symbols.forEach((a) => {\n    struct.symbols.add(a);\n  });\n\n  const states = Array.from(struct.states.all());\n  const symbols = Array.from(struct.symbols.all());\n  input.transitions.forEach((t) => {\n    t.from = states[t.from];\n    t.to = states[t.to];\n    t.by = symbols[t.by];\n    struct.transitions.add(t);\n  });\n\n  return struct;\n};\n\nexport const fsmToTree = function(struct) {\n\n  const output = {\n    type: \"finite-state-machine\",\n    symbols: [],\n    states: [],\n    transitions: []\n  };\n  const indexes = {\n    symbols: new Map(),\n    states: new Map()\n  };\n  \n  let i = 0;\n  for(let a of struct.symbols.all()) {\n    output.symbols.push(a.description);\n    indexes.symbols.set(a, i++);\n  }\n  i = 0;\n  for(let s of struct.states.all()) {\n    output.states.push(s.description);\n    indexes.states.set(s, i++);\n  };\n\n  for(let t of struct.transitions.all()) {\n    const td = t.description;\n    td.from = indexes.states.get(t.from);\n    td.to = indexes.states.get(t.to);\n    td.by = indexes.states.get(t.by);\n    output.transitions.push(td);\n  };\n\n  return output;\n};\n","/**\n * @module lib/utils/descriptor\n * @requires lib/utils/exception\n */\n\nimport exception from \"./exception\";\n\n/**\n * Creates a new check builder\n */\nfunction check() {\n  return new Check();\n}\n\nexport { check as default, exception };\n\nconst queueAccessor = Symbol(\"queue property name\");\n\nconst identityBypass = (x) => x;\nidentityBypass.bypass = true;\n\nconst emptyArrayDescriptor = () => {\n  emptyArrayDescriptor.d.value = [];\n  return emptyArrayDescriptor.d;\n};\n\nemptyArrayDescriptor.d = {\n  enumerable: false,\n  writable: false,\n  configurable: false\n};\n\nclass Check {\n  constructor() {\n    Object.defineProperty(this, queueAccessor, emptyArrayDescriptor());\n  }\n\n  optional() {\n    this[queueAccessor].push(identityBypass);\n    return this;\n  };\n\n  defaults(defaultValue) {\n    const checkDefaults = () => {\n      return defaultValue;\n    };\n    checkDefaults.bypass = true;\n    this[queueAccessor].push(checkDefaults);\n    return this;\n  };\n  /**\n   * @return {Any|CheckError<notMember>}\n   */\n  inMap(map) {\n    const checkInMap = (value) => {\n      if(map.has(value)) {\n        return value;\n      }\n      return exception.create(exception.notMember, value, map);\n    };\n    this[queueAccessor].push(checkInMap);\n    return this;\n  };\n\n  /**\n   * @return {Any|CheckError<notMember>}\n   */\n  inSet(map) {\n    const checkInSet = (value) => {\n      if(map.has(value)) {\n        return value;\n      }\n      return exception.create(exception.notMember, value, map);\n    };\n    this[queueAccessor].push(checkInSet);\n    return this;\n  };\n  /**\n   * @return {Any|CheckError<notMember>}\n   */\n  inArray(array) {\n    const checkInArray = (value) => {\n      if(array.includes(value)) {\n        return value;\n      }\n      return exception.create(exception.notMember, value, array);\n    };\n    this[queueAccessor].push(checkInArray);\n    return this;\n  };\n\n  /**\n   * @return {Any|CheckError<wrongType>}\n   */\n  ofType(type) {\n    const checkOfType = (value) => {\n      if(typeof value === type) {\n        return value;\n      }\n      return exception.create(exception.wrongType, value, type);\n    };\n    this[queueAccessor].push(checkOfType);\n    return this;\n  };\n\n  /**\n   * @return {Any|CheckError<wrongClass>}\n   */\n  instanceOf(constructor) {\n    const checkInstanceOf = (value) => {\n      if(value instanceof constructor) {\n        return value;\n      }\n      return exception.create(exception.wrongClass, value, constructor);\n    };\n    this[queueAccessor].push(checkInstanceOf);\n    return this;\n  };\n\n  /**\n   * @return {Any|CheckError<array>|CheckError<notIterable>}\n   */\n  iterable(check) {\n    const checkIterable = (value, ...parents) => {\n      value = value || [];\n      const exceptions = [];\n      const output = [];\n      if(value[Symbol.iterator] == null) {\n        return exception.create(exception.wrongType, value, \"iterable\");\n      }\n      if(checkIterable.check === undefined) {\n        return value;\n      }\n      let i = 0;\n      for(let v of value) {\n        const c = checkIterable.check.resolve(v,  output, ...parents);\n        if(exception(c)) {\n          exceptions[i] = c;\n        } else {\n          output[i] = c;\n        }\n        i++;\n      }\n      if(exceptions.length > 0) {\n        exceptions.length = i;\n        output.length = i;\n        return exception.create(exception.array, value, checkIterable.check, exceptions, output);\n      }\n      return output;\n    };\n    checkIterable.iterable = true;\n    checkIterable.check = check;\n    this[queueAccessor].push(checkIterable);\n    return this;\n  };\n  /**\n   * @return {Any|CheckError<object>}\n   */\n  object(definition, fireUnknown=false, order) {\n    definition = definition || {};\n    order = order || [];\n    const checkObject = (value, ...parents) => {\n      value = value || {};\n      const output = {};\n      const exceptions = {};\n      let c;\n      order = order.concat(\n        Object.keys(checkObject.definition).filter(\n          (prop) => !order.includes(prop)));\n      for(let prop of order) {\n        if(checkObject.definition[prop] === undefined) {\n          continue;\n        }\n        c = checkObject.definition[prop].resolve(value[prop], output, ...parents);\n        if(exception(c)) {\n          exceptions[prop] = c;\n        } else {\n          output[prop] = c;\n        }\n      }\n      for(let prop of Object.keys(value)) {\n        if(checkObject.definition[prop] === undefined) {\n          if(checkObject.fireUnknown) {\n            exceptions[prop] = exception.create(exception.unknownProp, value, checkObject.definition, prop);\n          } else {\n            output[prop] = value[prop];\n          }\n        }\n      }\n      if(Object.keys(exceptions).length > 0) {\n        return exception.create(exception.object, value, checkObject.definition, exceptions, output);\n      }\n      return output;\n    };\n    checkObject.object = true;\n    checkObject.definition = definition;\n    checkObject.order = order;\n    checkObject.fireUnkown = fireUnknown;\n    this[queueAccessor].push(checkObject);\n    return this;\n  };\n\n  /**\n   * @return {Any|CheckError<missingValue>}\n   */\n  mandatory() {\n    const checkMandatory = (value) => {\n      if(value == null) {\n        return exception.create(exception.missingValue, value);\n      }\n      return value;\n    };\n    this[queueAccessor].push(checkMandatory);\n    return this;\n  };\n\n  compose(check) {\n    const queue = this[queueAccessor];\n    for(let f of check[queueAccessor]) {\n      if(f.object === true) {\n        this.object(Object.assign(f.definition), f.fireUnknown, f.order);\n      } else if (f.iterable === true) {\n        this.iterable((new Check()).compose(f.check));\n      } else {\n        queue.push(f);\n      }\n    }\n    return this;\n  };\n  \n  // TODO merge orders\n  deepCompose(append) {\n    const queue = this[queueAccessor];\n    const appendQueue = append[queueAccessor];\n    if(appendQueue.length <= 0) {\n      return this;\n    }\n    if(queue.length <= 0) {\n      this.compose(append);\n      return this;\n    }\n    const tip = queue[queue.length - 1];\n    const toCompose = appendQueue[0];\n    if(tip.object === true && toCompose.object === true) {\n      const newDef = Object.assign({}, tip.definition);\n      for(let prop of Object.keys(toCompose.definition)) {\n        if(newDef[prop] === undefined) {\n          newDef[prop] = check().compose(toCompose.definition[prop]);\n        } else {\n          newDef[prop] = check().compose(newDef[prop]).deepCompose(toCompose.definition[prop]);\n        }\n      }\n      tip.definition = newDef;\n      return this;\n    }\n    if(tip.iterable === true && toCompose.iterable === true) {\n      tip.check = check().compose(tip.check).deepCompose(toCompose.check);\n      return this;\n    }\n    return this.compose(append);\n  }\n\n  add(f) {\n    this[queueAccessor].push(f);\n    return this;\n  };\n\n  resolve(value, ...parents) {\n    for(let f of this[queueAccessor]) {\n      if(exception(value)) {\n        return value;\n      }\n      if(f.bypass && value == null) {\n        return f.call(undefined, value, ...parents);\n      }\n      value = f.call(undefined, value, ...parents);\n    }\n    return value;\n  };\n\n  hold() {\n    return this.resolve.bind(this);\n  };\n}\n","/**\n * Check if the argument is of a registered exception type.\n * @param {mdn:Object} object - the object to check\n * @return {mdn:Boolean} whether the object is a registered exception\n */\nexport default function exception(object) {\n  return object == null ? false : registry.has(object[tokenAccessor]);\n}\n\n/**\n * The registry of every registered type of exception.\n * The keys are tokens that uniquely identifies a type of exception\n * and the values are the constructors used to instanciate them\n */\nconst registry = new Map();\n\n/**\n * A symbol to access the token property of the created exceptions.\n */\nconst tokenAccessor = Symbol(\"token property name\");\n\n\n/**\n * A helper function to efficiently use property descriptors in\n * {@link mdn:Object.defineProperty}.\n */\nfunction propertyDescriptor(value) {\n  propertyDescriptor.d.value = value;\n  return propertyDescriptor.d;\n}\n\npropertyDescriptor.d = {\n  enumerable: false,\n  configurable: false,\n  writable: false\n};\n\n/**\n * A default constructor for an exception\n */\nfunction Exception(value) {\n  this.name = this.constructor.name;\n  this.value = value;\n}\n\nconst depthAccessor = Symbol(\"depth property name\");\nconst incDepthAccessor = Symbol(\"increment depth property name\");\n\nconst properties = {\n  token: {\n    get: function() {\n      return this[tokenAccessor];\n    },\n    configurable: false,\n    enumerable: false\n  },\n  onIt: {\n    value: function(handler) {\n      return handler.call(undefined, this);\n    },\n    writable: false,\n    configurable: false,\n    enumerable: false\n  },\n  dispatch: {\n    value: function(handlers) {\n      if(!registry.has(this[tokenAccessor])) {\n        throw new Error(\"Not a recognized exception\");\n      }\n      let handler = handlers[this[tokenAccessor]];\n      if(handler == null) {\n        handler = handlers.default;\n        if(handler == null) {\n          throw this;\n        }\n      }\n      return this.onIt(handler);\n    },\n    writable: false,\n    configurable: false,\n    enumerable: false\n  }\n};\n\nconst messageProperty = {\n  get: function() {\n    return `${this.name} raised`;\n  },\n  configurable: true,\n  enumerable: true\n};\n\nconst incDepthProperty = {\n  value: function() {\n    this[depthAccessor]++;\n  },\n  configurable: false,\n  enumerable: true,\n  writable: false\n};\n\nObject.defineProperties(Exception.prototype, properties);\nObject.defineProperty(Exception.prototype, \"message\", messageProperty);\nObject.defineProperty(Exception.prototype, incDepthAccessor, incDepthProperty);\n\n/**\n * Registers a new type of exception.\n * @param {mdn:String} name - The name of the new type\n * @param {Class} superClass - An optional constructor that will be extended\n * @return {Symbol} The token of the newly created type of exception\n */\nexception.register = (name, superClass=Exception) => {\n  const newExceptionClass = class extends superClass {\n    constructor(...args) {\n      super(...args);\n      this.name = name;\n      this[depthAccessor] = 0;\n    }\n  };\n  const token = Symbol(name);\n  if(superClass !== Exception) {\n    Object.defineProperties(newExceptionClass.prototype, properties);\n    // if(!(\"message\" in newExceptionClass.prototype)) {\n    //   Object.defineProperty(newExceptionClass.prototype, \"message\", messageProperty);\n    // }\n    if(!(incDepthAccessor in newExceptionClass.prototype)) {\n      Object.defineProperty(newExceptionClass.prototype, incDepthAccessor, incDepthProperty);\n    }\n  }\n  Object.defineProperty(newExceptionClass.prototype, tokenAccessor, propertyDescriptor(token));\n  registry.set(token, newExceptionClass);\n  return token;  \n};\n\n\n/**\n * Creates an exception of a given type\n * @param {Symbol} The token\n * @param ...args The arguments to pass to the exception constructor\n * @return {Exception} The newly created exception\n * @throws Error When the supplied token does not match a registered type of \n * exception\n */\nexception.create = (token, ...args) => {\n  const exceptionClass = registry.get(token);\n  if(exceptionClass === undefined) {\n    throw new Error(\"Not a recognized exception\");\n  }\n  return new exceptionClass(...args);\n};\n\n/**\n * A collection of exceptions\n */\nclass ObjectExceptions {\n  constructor(descriptor, definition, exceptions, output) {\n    this.value = descriptor;\n    this.definition = definition;\n    this.exceptions = exceptions;\n    this.output = output;\n    this[incDepthAccessor]();\n    this[depthAccessor] = 0;\n  }\n  get message() {\n    let m = `${this.name}: exceptions on the following properties: `;\n    for(let prop of Object.keys(this.exceptions)) {\n      m += \"\\n\";\n      m += \"  \".repeat(this.exceptions[prop][depthAccessor]);\n      m += `${prop}: ${this.exceptions[prop].message}`;\n    }\n    return m;\n  }\n  onProperties(objectCallbacks) {\n    const results = {};\n    let callback, e;\n    for(let prop of Object.keys(this.exceptions)) {\n      callback = objectCallbacks[prop];\n      e = this.exceptions[prop];\n      if(callback == null) {\n        throw e;\n      }\n      results[prop] = callback.call(undefined, e);\n    }\n    return results;\n  }\n  onEachProperty(callback) {\n    const results = {};\n    let e;\n    for(let prop of Object.keys(this.exceptions)) {\n      e = this.exceptions[prop];\n      results[prop] = callback.call(undefined, e, prop);\n    }\n    return results;\n  }\n}\n\nObject.defineProperty(ObjectExceptions.prototype, incDepthAccessor, propertyDescriptor(function() {\n  this[depthAccessor]++;\n  for(let prop of Object.keys(this.exceptions)) {\n    this.exceptions[prop][incDepthAccessor]();\n  }\n}));\n\n/**\n * A collection of exceptions\n */\nclass ArrayExceptions {\n  constructor(value, definition, exceptions, output) {\n    this.value = value;\n    this.definition = definition;\n    this.output = output;\n    this.exceptions = exceptions;\n    this[incDepthAccessor]();\n    this[depthAccessor]--;\n  }\n  get message() {\n    let m = `${this.name}: exceptions on the following indexes: `;\n    this.exceptions.forEach((err, i) => {\n      if(err != null) {\n        m +=\"\\n\";\n        m += \"  \".repeat(err[depthAccessor]);\n        m += `index ${i}: ${err.message}`;\n      }\n    });\n    return m;\n  }\n  onEach(callback) {\n    const results = [];\n    for(let err, i = 0; i < this.exceptions.length; i++) {\n      err = this.exceptions[i];\n      if(err !== undefined) {\n        results[i] = callback.call(undefined, err, i);\n      }\n    }\n    return results;\n  }\n}\n\nObject.defineProperty(ArrayExceptions.prototype, incDepthAccessor, propertyDescriptor(function() {\n  this[depthAccessor]++;\n  for(let e of this.exceptions) {\n    if(e !== undefined) {\n      e[incDepthAccessor]();\n    }\n  }\n}));\n\nclass NotMember {\n  constructor(value, collection) {\n    this.value = value;\n    this.collection = collection;\n  }\n  get message() {\n    return `${this.name}: not a member of the supplied collection`;\n  }\n}\n\nclass WrongType {\n  constructor(value, type) {\n    this.value = value;\n    this.type = type;\n  }\n  get message() {\n    return `${this.name}: should be of type ${this.type}`;\n  }\n}\n\nclass WrongClass {\n  constructor(value, classConstructor) {\n    this.value = value;\n    this.classConstructor = classConstructor;\n  }\n  get message() {\n    return `${this.name}: not an instance of the given class/constructor`;\n  }\n}\n\nclass MissingValue {\n  constructor(value, allowNull=false) {\n    this.value = value;\n    this.allowNull = allowNull;\n  }\n  get message() {\n    return `${this.name}: undefined ${this.allowNull ? \"\" : \"or null\"},\\\n      but variable is ${this.value}`;\n  }\n}\n\nclass UnknownPropertyName {\n  constructor(value, definition, propertyName) {\n    this.value = value;\n    this.definition = definition;\n    this.propertyName = propertyName;\n  }\n  get message() {\n    return `${this.name}: the property ${this.propertyName} has not been defined`;\n  }\n}\n\nexception.array = exception.register(\"ArrayExceptions\", ArrayExceptions);\nexception.object = exception.register(\"ObjectExceptions\", ObjectExceptions);\nexception.missingValue = exception.register(\"MissingValue\", MissingValue);\nexception.notMember = exception.register(\"NotMember\", NotMember);\nexception.wrongClass = exception.register(\"WrongClass\", WrongClass);\nexception.wrongType = exception.register(\"WrongType\", WrongType);\nexception.unknownProp = exception.register(\"UnknownPropertyName\", UnknownPropertyName);\n","/**\n * @module lib/utils/iterator\n */\n\n/**\n * Transforms an iterable of iterables into a flat iterable\n */\nexport function flatten(iterable, accessIterable) {\n  const iterator = iterable[Symbol.iterator]();\n  let oldNext = iterator.next.bind(iterator);\n  let c;\n  let subIterator;\n  let subc = {done: true};\n  iterator.next = () => {\n    while(subc.done) {\n      c = oldNext();\n      if(c.done) {\n        return c;\n      }\n      subIterator = accessIterable(c.value)[Symbol.iterator];\n      subc = subIterator.next();\n    }\n    return subc;\n  };\n  iterator[Symbol.iterator] = () => iterator;\n  return iterator; \n};\n\n/**\n * Creates an empty iterator\n */\nexport function empty() {\n  const iterator = {\n    next: () => ({done: true})\n  };\n  iterator[Symbol.iterator] = () => iterator;\n  return iterator;\n};\n\n/**\n * Wraps a variable in an iterator\n */\nexport function wrap(value) {\n  let seen = false;\n  const iterator = {\n    next: () => {\n      if(seen) {\n        return {done: true};\n      } \n      seen = true;\n      return {value};\n    }\n  };\n  iterator[Symbol.iterator] = () => iterator;\n  return iterator;\n};\n\n/**\n * Apply a function on a value when accessing it\n */\nexport function hijack(iterable, callback) {\n  const iterator = iterable[Symbol.iterator]();\n  const oldNext = iterator.next.bind(iterator);\n  iterator.next = () => {\n    const c = oldNext();\n    if(!c.done) {\n      c.value = callback(c.value);\n    }\n    return n;\n  };\n  iterator[Symbol.iterator] = () => iterator;\n  return newIterator;\n};\n","export default function precedence(...args) {\n  let arg = undefined;\n  for(let i = 0; i < args.length, arg == null; i++) {\n    arg = args[i];\n  }\n  return arg;\n}\n\nexport function lazy(self, callbacks) {\n  let r = undefined;\n  for(let i = 0; i < callbacks.length && r == null; i++) {\n    r = callbacks[i].apply(self);\n  }\n  return r;\n}\n"]}