{"version":3,"sources":["controller.js","demo.js","draw.js","errors.js","examples.js","index.js","layout.js","render.js","error.js","fsm.js","lib/parser/grammar.peg","init.js","pipeline.js","sketchFsm.js","style.js","tree.js","check.js","exception.js","iterator.js","precedence.js"],"names":[],"mappings":"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AAE,EAAF,CAAhB,CAAsB,IAAtB,CAA2B,GAA3B,CAA+B,EAAE,EAAF,CAA/B,CAAqC,MAArC,CAA4C,CAA5C,EAFY;AAGZ,SAAK,OAAL,CAAa,GAAb,CAAiB,EAAE,EAAF,CAAjB,CAAuB,WAAvB,CAAmC,MAAnC,CAA0C,CAA1C,EAHY;AAIZ,SAAK,WAAL,CAAiB,MAAjB,CAAwB,CAAxB,EAJY;GAAd;CAFuB;;;ACxjBzB;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA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","file":"build/app/app.js","sourcesContent":["/** \n * @module app/controller\n */\n\n// import sketchFsm from \"../lib/sketchFsm\";\nimport pipeline from \"../lib/pipeline\";\nimport exception from \"../lib/utils/exception\";\nimport draw from \"./draw\";\nimport stringifyError from \"../lib/error\";\n\n/**\n * Controller\n * @return {Object} Not really, just testing\n */\nexport default function controller() {\n\n  document.getElementById(\"bGeneration\")\n  .addEventListener(\"click\", () => {\n    let container = document.getElementById(\"autoimg\");\n    cleanup(container);\n    let error_container = document.getElementById(\"autospec\")\n    .getElementsByTagName(\"textarea\")[1];\n    error_container.value = \"\";\n    var aml = document\n    .getElementById(\"autospec\")\n    .getElementsByTagName(\"textarea\")[0]\n    .value;\n    let fsm = pipeline(aml);\n    if(exception(fsm)) { error_container.value = stringifyError(fsm); }\n    else {\n      log.warn(\"dagre graph\");\n      fsm.layout();\n      draw(fsm, \"#autoimg\");\n    }\n  });\n}\n\nfunction cleanup(container) {\n  let child;\n  while((child = container.firstChild)) {\n    container.removeChild(child); \n  }\n}\n\n","import {exception} from \"../lib/utils/check\";\nimport pipeline from \"../lib/pipeline\";\nimport {default as stringifyError, firstError} from \"../lib/error\";\nimport draw from \"./draw\";\n\nconst demos = [\n  \"basic\",\n  \"inference\",\n  \"labels\",\n  \"placement\",\n  \"ALDToken\",\n  \"existingId\",\n  \"wrongType\",\n  \"syntax\",\n  \"MBToken\"\n];\n\nconst titles = [\n  \"Exemple simple\",\n  \"Infrence\",\n  \"Modification du label\",\n  \"Positionement manuel\",\n  \"Erreur 1\",\n  \"Erreur 2\",\n  \"Erreur 3\",\n  \"Erreur 4\",\n  \"Erreur 5\"\n];\n\nexport default function main() {\n  const container = document.getElementsByClassName(\"container\")[0];\n  for(let i = 0; i < demos.length; i++) {\n    const d = demos[i];\n    const row = document.createElement(\"div\");\n    row.id = `demo-${d}`;\n    row.classList.add(\"row\", \"bottom\");\n    container.appendChild(row);\n    const autospec = document.createElement(\"div\");\n    autospec.classList.add(\"autospec\", \"one-half\", \"column\");\n    const textarea = document.createElement(\"textarea\");\n    const path = `demo/${d}.aml`;\n    autospec.appendChild(textarea);\n    const title = document.createElement(\"h3\");\n    title.innerHTML = titles[i];\n    row.appendChild(title);\n    row.appendChild(autospec);\n    const autoimg = document.createElement(\"div\");\n    autoimg.classList.add(\"autoimg\", \"one-half\", \"column\");\n    row.appendChild(autoimg);\n    populate(textarea, autoimg, path);\n  }\n}\n\nfunction populate(textarea, autoimg, path) {\n  const xhttp = new XMLHttpRequest();\n  xhttp.onreadystatechange = () => {\n    if (xhttp.readyState == 4 && xhttp.status == 200) {\n      textarea.value = xhttp.responseText;\n      const fsm = pipeline(textarea.value);\n      if(exception(fsm)) {\n        const err = stringifyError(firstError(fsm))\n        const errorTA = document.createElement(\"textarea\");\n        errorTA.value = stringifyError(firstError(fsm));\n        autoimg.appendChild(errorTA);\n        return;\n      }\n      draw(fsm, autoimg);\n    }\n  };\n  xhttp.open(\"GET\", path, true);\n  xhttp.send();\n}\n","import d3 from \"d3\";\nexport default draw;\n\nconst stateDimensions = (statesG, minRadius=0) => {\n  const text = statesG\n  .append(\"text\")\n  .html((d) => d.label);\n\n  const data = text.data();\n  const nodes = text[0];\n\n  for(let i = 0, bbox; i < data.length; i++) {\n    bbox = nodes[i].getBBox();\n    data[i]\n    .width(Math.max(minRadius*2, bbox.width))\n    .height(Math.max(minRadius*2, bbox.height));\n    nodes[i].remove();\n  } \n};\n\nconst gatherLines = (lines, x, dy=0) => {\n  if(lines.length === 1) {\n    return lines[0].join(\", \");\n  }\n  return lines.map((l, i) => {\n    const end = i < lines.length - 1 ? \",\" : \"\";\n    if(i == 0) {\n      return `<tspan x=${x} dy=${dy}>${l.join(\", \")}${end}</tspan>`;\n    }\n    return `<tspan x=${x} dy=\"8pt\">${l.join(\", \")}${end}</tspan>`;\n  }).join(\"\");\n};\n\nconst edgeDimensions = (edgesG, maxWidth, minRadius=0, padRadius=0) => {\n  const text = edgesG\n  .append(\"text\");\n\n  const data = text.data();\n  const nodes = text[0];\n\n  for(let i = 0, node, labels, lines; i < data.length; i++) {\n    node = nodes[i];\n    labels = data[i].symbols.map((a) => a.label);\n    lines = [];\n    for(let j = 0; j < labels.length; j++) {\n      node.innerHTML = labels[j];\n      let k = 1;\n      while(node.getBBox().width < maxWidth && j + k < labels.length) {\n        node.innerHTML = node.innerHTML + \", \" + labels[j + k];\n        k++;\n      }\n      lines.push(labels.slice(j, j + k));\n      j = j + k - 1;\n    }\n    data[i].lines = lines;\n    node.innerHTML = gatherLines(data[i].lines, 0);\n    const {width, height} = node.getBBox();\n    data[i]\n    .width(Math.max(minRadius*2, width + padRadius*2))\n    .height(Math.max(minRadius*2, height + padRadius*2));\n    node.remove();\n  }\n};\n\nconst edgePathGenerator = d3.svg.line()\n.x((d) => d.x)\n.y((d) => d.y)\n.interpolate(\"bundle\")\n.tension(0.8);\n\nconst sq = (x) => x*x;\n\nconst sign = (bool) => (bool|0)*2 - 1;\n\nconst intersection = (x, y, tx, ty, a, b) => {\n  return {\n    x: x + sign(tx > 0)*Math.sqrt(1 / ( sq(1/a) + sq(ty/(b*tx)) )),\n    y: y + sign(ty > 0)*Math.sqrt(1 / ( sq(1/b) + sq(tx/(a*ty)) )),\n  };\n};\n\nconst translate = (x, y, tx, ty, d) => {\n  const r = d === undefined ? 1 : d/Math.sqrt(sq(tx) + sq(ty));\n  return {\n    x: x + tx*r,\n    y: y + ty*r\n  };\n};\n\nconst drawInitArrow = (statesG, initArrowLength, arrowWidth, terminalSpacing) => {\n  statesG.filter((d) => d.initial)\n  .append(\"line\")\n  .each((d) => {\n    const {a, b} = ellipseRadiusFromState(d, terminalSpacing);\n    d.arrowPos = {};\n    const intersect = intersection(d.x(), d.y(), -1, 0, a, b);\n    d.arrowPos.base = {\n      x: intersect.x - arrowWidth - d.x(),\n      y: intersect.y - d.y()\n    };\n    d.arrowPos.start = {\n      x: d.arrowPos.base.x - initArrowLength,\n      y: d.arrowPos.base.y\n    };\n  })\n  .attr(\"stroke\", \"black\")\n  .attr(\"marker-end\", \"url(#arrow)\")\n  .attr({\n    x1: (d) => d.x() + d.arrowPos.start.x,\n    y1: (d) => d.y() + d.arrowPos.start.y,\n    x2: (d) => d.x() + d.arrowPos.base.x,\n    y2: (d) => d.y() + d.arrowPos.base.y\n  });\n};\n\nconst fixIntersection = (center, controlPoint, semimajor, semiminor) => {\n  return intersection(\n    center.x, center.y,\n    controlPoint.x - center.x, controlPoint.y - center.y,\n    semimajor, semiminor\n  );\n};\n\nconst ellipseRadiusFromState = (s, terminalSpacing) => {\n  const pad = s.terminal ? terminalSpacing : 0;\n  return {\n    a: s.width()/Math.sqrt(2) + pad,\n    b: s.height()/Math.sqrt(2) + pad\n  };\n};\n\nconst norm = (x, y) => Math.sqrt(sq(x) + sq(y));\n\nconst drawEdgePaths = (edgesG) => {\n  edgesG\n  .append(\"path\")\n  .each(function(d) {\n    d.path = this;\n  })\n  .attr(\"marker-end\", \"url(#arrow)\");\n};\n\nconst updateEdgePaths = (paths, arrowWidth, terminalSpacing) => {\n  paths.attr(\"d\", (d) => {\n    const points = d.points;\n    let a, b;\n    ({a, b} = ellipseRadiusFromState(d.from, terminalSpacing));\n    points[0] = fixIntersection(points[0], points[1], a, b);\n    ({a, b} = ellipseRadiusFromState(d.to, terminalSpacing));\n    let controlPoint = points[points.length - 2];\n    let tip = fixIntersection(points[points.length - 1], controlPoint, a, b);\n    if(norm(controlPoint.x - tip.x, controlPoint.y - tip.y) < arrowWidth) {\n      // FIXME: That's an ugly hack for when the base of arrowhead is farther\n      // that the control point\n      // A solution is to keep the full path and use stroke dash-array to only\n      // draw the part we need\n      controlPoint = translate(\n        controlPoint.x, controlPoint.y,\n        (points[points.length - 3].x - controlPoint.x)/1.7,\n        (points[points.length - 3].y - controlPoint.y)/1.7\n      );\n      tip = fixIntersection(points[points.length - 1], controlPoint, a, b);\n      points[points.length - 2] = controlPoint;\n    }\n    const base = translate(\n      tip.x, tip.y,\n      controlPoint.x - tip.x, controlPoint.y - tip.y,\n      arrowWidth\n    );\n    points[points.length - 1] = base;\n    return edgePathGenerator(points);\n  });\n};\n\nconst defineArrowHead = (defs, width, height) => {\n  defs.append(\"marker\")\n  .attr({\n    \"id\":\"arrow\",\n    \"refX\":0,\n    \"refY\":height/2,\n    \"markerWidth\": width,\n    \"markerHeight\":height,\n    \"markerUnits\": \"userSpaceOnUse\",\n    \"orient\":\"auto\"\n  }).append(\"path\")\n  .attr(\"d\", `M0,0 L0,${height} L${width},${height/2} z`)\n  .attr(\"class\",\"arrowHead\");\n};\n\nfunction draw(fsm, container) {\n\n  // Init\n  cleanup(container);\n  const svg = d3\n  .select(container)\n  .append(\"svg\");\n\n  // Defs\n  const defs = svg.append(\"defs\");\n  const arrowWidth = 7;\n  const terminalSpacing = 3;\n  const initArrowLength = arrowWidth;\n  defineArrowHead(defs, arrowWidth, 5);\n\n  // Container\n  const g = svg.append(\"g\");\n  svg.call(d3.behavior.zoom().on(\"zoom\", zoom(g)));\n\n  // Groups\n  const statesG = g.selectAll(\".state\")\n  .data(Array.from(fsm.states.all())).enter()\n  .append(\"g\")\n  .attr(\"class\", \"state\")\n  .attr(\"id\", (d) => `state_${d.id}`)\n  .each((d) => {\n    d.edges = new Set();\n  });\n\n  const edgesG = g.selectAll(\".edge\")\n  .data(Array.from(fsm.edges.all())).enter()\n  .append(\"g\")\n  .attr(\"class\", \"edge\")\n  .attr(\"id\", (d) => `edge_${d.from.id}_${d.to.id}`)\n  .each(function(d) {\n    d.from.edges.add(this);\n    d.to.edges.add(this);\n  });\n\n  // Measure\n  stateDimensions(statesG, 12);\n  edgeDimensions(edgesG, 20, 4, 2);\n\n  // Compute layout\n  fsm.layout();\n\n  // Account for ellipses and arrowheads\n  // fixIntersections(edgesG, arrowWidth);\n\n  // If needed\n  // drawDebug(statesG, edgesG, g);\n\n  // Render\n  drawEllipses(statesG, terminalSpacing);\n  drawInitArrow(statesG, initArrowLength, arrowWidth, terminalSpacing);\n  drawStateLabels(statesG);\n  drawEdgePaths(edgesG);\n  updateEdgePaths(edgesG.selectAll(\"path\"), arrowWidth, terminalSpacing);\n  drawEdgeLabels(edgesG, arrowWidth);\n  \n  // Drag'n'Drop\n  const drag = d3.behavior.drag()\n  .on(\"dragstart\", function() { d3.event.sourceEvent.stopPropagation(); })\n  .on(\"drag\", function(d) {\n    d.x(d3.event.x).y(d3.event.y);\n    updateState(d3.select(this), arrowWidth, terminalSpacing);\n  });\n\n  statesG.call(drag);\n}\n\nconst updateState = (sG, arrowWidth, terminalSpacing) => {\n  sG.selectAll(\"ellipse\")\n  .attr(\"cx\", (d) => d.x())\n  .attr(\"cy\", (d) => d.y());\n\n  sG.selectAll(\"text\")\n  .attr(\"x\", (d) => d.x())\n  .attr(\"y\", (d) => d.y());\n\n  sG.selectAll(\"line\")\n  .attr({\n    x1: (d) => d.x() + d.arrowPos.start.x,\n    y1: (d) => d.y() + d.arrowPos.start.y,\n    x2: (d) => d.x() + d.arrowPos.base.x,\n    y2: (d) => d.y() + d.arrowPos.base.y\n  });\n\n  updateEdgePaths(\n    d3.selectAll(Array.from(sG.datum().edges)).selectAll(\"path\"),\n    arrowWidth, terminalSpacing\n  );\n};\n\nconst drawEllipses = (statesG, terminalSpacing) => {\n  statesG.append(\"ellipse\")\n  .attr(\"class\", \"contour\")\n  .attr(\"rx\", (d) => d.width()/Math.sqrt(2))\n  .attr(\"ry\", (d) => d.height()/Math.sqrt(2))\n  .attr(\"cx\", (d) => d.x())\n  .attr(\"cy\", (d) => d.y());\n\n  statesG.filter((d) => d.terminal)\n  .append(\"ellipse\")\n  .attr(\"class\", \"doubling\")\n  .attr(\"rx\", (d) => d.width()/Math.sqrt(2) + terminalSpacing)\n  .attr(\"ry\", (d) => d.height()/Math.sqrt(2) + terminalSpacing)\n  .attr(\"cx\", (d) => d.x())\n  .attr(\"cy\", (d) => d.y());\n};\n\nconst drawStateLabels = (statesG) => {\n  statesG.append(\"text\")\n  .attr(\"x\", (d) => d.x())\n  .attr(\"y\", (d) => d.y())\n  .attr(\"text-anchor\", \"middle\")\n  .attr(\"dominant-baseline\", \"central\")\n  .html((d) => d.label);\n};\n\nconst drawEdgeLabels = (edgesG, arrowWidth) => {\n  edgesG.append(\"text\")\n  .each((d) => {\n    const l = d.path.getTotalLength() + arrowWidth;\n    let middle = d.path.getPointAtLength(l/2);\n    const points = d.points;\n    const midIndex = (points.length - 1)/2;\n    const epsilon = 3;\n    let outwardx = 0;\n    let outwardy = 0;\n    let i = 1;\n    while(Math.abs(outwardx) < epsilon && Math.abs(outwardy) < epsilon && i <= midIndex) {\n      outwardx = 2*points[midIndex].x - points[midIndex - i].x - points[midIndex + i].x; \n      outwardy = 2*points[midIndex].y - points[midIndex - i].y - points[midIndex + i].y; \n      i++;\n    }\n    if(Math.abs(outwardx) < epsilon && Math.abs(outwardy) < epsilon) {\n      outwardx = points[midIndex - 1].y - points[midIndex + 1].y;\n      outwardy = points[midIndex + 1].x - points[midIndex - 1].x;\n    }\n    const n = norm(outwardx, outwardy);\n    outwardx = outwardx/n;\n    outwardy = outwardy/n;\n    d.x(middle.x + outwardx*d.width()/2.2).y(middle.y + outwardy*d.height()/2.2);\n  })\n  .attr(\"x\", (d) => d.x())\n  .attr(\"y\", (d) => d.y())\n  .attr(\"text-anchor\", \"middle\")\n  .attr(\n    \"dominant-baseline\",\n    (d) => d.lines.length > 1 ? \"text-before-edge\" : \"central\"\n  ).html((d) => gatherLines(d.lines, d.x(), -d.height()/2));\n};\n\nconst zoom = (g) => () => {\n  g.attr(\"transform\", \"translate(\" + d3.event.translate + \")scale(\" + d3.event.scale + \")\");\n};\n\nconst drawDebug = (statesG, edgesG, svg) => {\n  statesG\n  .append(\"rect\")\n  .attr(\"class\", \"debug-rect\")\n  .attr(\"x\", (d) => d.x() - d.width()/2)\n  .attr(\"y\", (d) => d.y() - d.height()/2)\n  .attr(\"width\", (d) => d.width())\n  .attr(\"height\", (d) => d.height())\n  .style(\"fill\", \"#55CCFF\");\n\n  edgesG\n  .append(\"rect\")\n  .attr(\"class\", \"debug-rect\")\n  .attr(\"x\", (d) => d.x() - d.width()/2)\n  .attr(\"y\", (d) => d.y() - d.height()/2)\n  .attr(\"width\", (d) => d.width())\n  .attr(\"height\", (d) => d.height())\n  .style(\"fill\", \"#AAFFAA\");\n\n  edgesG\n  .selectAll(\".debug-circle\")\n  .data((d) => d.points)\n  .enter()\n  .append(\"circle\")\n  .attr(\"class\", \"debug-circle\")\n  .attr(\"r\", 1.5)\n  .attr(\"cx\", (d) => d.x)\n  .attr(\"cy\", (d) => d.y)\n  .style(\"fill\", \"#FF7777\");\n};\n\nconst cleanup = (container) => {\n  if(container === undefined) { return; }\n  container = d3.select(container);\n  let child;\n  while((child = container.firstChild)) {\n    container.removeChild(child);\n  }\n};\n","import {exception} from \"../lib/utils/check\";\nimport pipeline from \"../lib/pipeline\";\nimport {default as stringifyError, firstError} from \"../lib/error\";\n\nconst errors = [\n  \"ALDToken\",\n  \"existingId\",\n  \"wrongType\",\n  \"unknownProp\",\n  \"syntax\",\n  \"unknownId\",\n  \"fsmType\",\n  \"MBToken\"\n];\n\nexport default function main() {\n  const container = document.getElementsByClassName(\"container\")[0];\n  for(let e of errors) {\n    const row = document.createElement(\"div\");\n    row.id = `error-${e}`;\n    row.classList.add(\"row\", \"bottom\");\n    container.appendChild(row);\n    const autospec = document.createElement(\"div\");\n    autospec.classList.add(\"autospec\", \"one-half\", \"column\");\n    const textarea = document.createElement(\"textarea\");\n    const path = `errors/${e}.aml`;\n    textarea.readonly = true;\n    autospec.appendChild(textarea);\n    row.appendChild(autospec);\n    const errorLog = document.createElement(\"div\");\n    errorLog.classList.add(\"errorlog\", \"one-half\", \"column\");\n    row.appendChild(errorLog);\n    populate(textarea, errorLog, path);\n  }\n}\n\nfunction populate(textarea, errorLog, path) {\n  const xhttp = new XMLHttpRequest();\n  xhttp.onreadystatechange = () => {\n    if (xhttp.readyState == 4 && xhttp.status == 200) {\n      textarea.value = xhttp.responseText;\n      const fsm = pipeline(textarea.value);\n      if(!exception(fsm)) {\n        log.error(\"Waiting for an error from \" + path);\n        log.error(fsm);\n        return;\n      }\n      const errorTA = document.createElement(\"textarea\");\n      errorTA.value = stringifyError(firstError(fsm));\n      errorLog.appendChild(errorTA);\n    }\n  };\n  xhttp.open(\"GET\", path, true);\n  xhttp.send();\n}\n","import {exception} from \"../lib/utils/check\";\nimport pipeline from \"../lib/pipeline\";\nimport draw from \"./draw\";\n\nconst figures = [\n  \"1-1\",\n  \"1-2\",\n  \"2-1-a\",\n  \"2-1-b\",\n  \"2-1-c\",\n  \"2-2-a\",\n  \"2-2-b\",\n  \"2-2-c\",\n  \"2-4\",\n  \"2-6\",\n  \"2-6-alt\",\n  \"2-9\",\n  \"2-14\"\n];\n\n\nexport default function main() {\n  const container = document.getElementsByClassName(\"container\")[0];\n  for(let f of figures) {\n    const row = document.createElement(\"div\");\n    row.id = `figure${f}`;\n    row.classList.add(\"row\", \"bottom\");\n    container.appendChild(row);\n    const autospec = document.createElement(\"div\");\n    autospec.classList.add(\"autospec\", \"one-half\", \"column\");\n    const textarea = document.createElement(\"textarea\");\n    const path = `figures/figure${f}.aml`;\n    textarea.readonly = true;\n    autospec.appendChild(textarea);\n    row.appendChild(autospec);\n    const autoimg = document.createElement(\"div\");\n    autoimg.classList.add(\"autoimg\", \"one-half\", \"column\");\n    row.appendChild(autoimg);\n    populate(textarea, autoimg, path);\n  }\n}\n\nfunction populate(textarea, autoimg, path) {\n  const xhttp = new XMLHttpRequest();\n  xhttp.onreadystatechange = () => {\n    if (xhttp.readyState == 4 && xhttp.status == 200) {\n      textarea.value = xhttp.responseText;\n      const fsm = pipeline(textarea.value);\n      if(exception(fsm)) {\n        log.debug(fsm.message);\n        return;\n      }\n      draw(fsm, autoimg);\n    }\n  };\n  xhttp.open(\"GET\", path, true);\n  xhttp.send();\n}\n","import grammar from \"./grammar\";\nimport {exception} from \"../utils/check\";\n\nexception.syntax = exception.register(\n    \"SyntaxException\", \n    function (expected, found, location) {\n      this.expected = expected;\n      this.found = found;\n      this.location = location;\n    }\n);\n\nfunction parse(aml) {\n  let l;\n  try {\n    l = grammar.parse(aml);\n  } catch (err) {\n    if(err instanceof grammar.SyntaxError) {\n      return exception.create(exception.syntax, err.expected, err.found, err.location); \n    } else {\n      return err;\n    }\n  }\n  return l;\n}\n\nexport default { parse };\n","export default function layout() {\n\n  let automata = {\n    type: \"finite\",\n    alphabet: [ ],\n    states: [ ],\n    transitions: [ ]\n  };\n\n  let accessor = {};\n\n  accessor.automata = function(x) {\n    if(!arguments.length) return automata;\n    automata = x;\n    x.transitions.forEach((t) => {\n      if (typeof t.source == \"number\") t.source = x.states[t.source];\n      if (typeof t.target == \"number\") t.target = x.states[t.target];\n      if (typeof t.symbol == \"number\") t.symbol = x.alphabet[t.symbol];\n    });\n    return accessor;\n  };\n\n  accessor.lay = function() {\n    automata.states.forEach((s, i) => {\n      s.x = 50 + (i % 3)*120;\n      s.y = 50 + ((i / 3) | 0)*120;\n    });\n    return accessor;\n  };\n\n  return accessor;\n}\n","import draw from \"./draw\";\nimport pipeline from \"../lib/pipeline\";\nimport exception from \"../lib/utils/exception\";\nimport stringifyError from \"../lib/error\";\nimport d3 from \"d3\";\n\nexport default function render(cal, container) {\n  let fsm = pipeline(cal);\n  if(exception(fsm)) {\n    d3.select(container)[0][0].innerHTML = \"<pre>\" + stringifyError(fsm) + \"</pre>\";\n  }\n  else {\n    fsm.layout();\n    draw(fsm, container);\n  }\n}\n","import { exception } from \"./utils/check\";\n\nexport default function stringifyError (e) {\n  let error = firstError(e);\n  // for(let prop of Object.keys(exception)) {\n  //   log.debug(prop);\n  //   log.debug(exception[prop]);\n  // }\n  const treat = {\n    [exception.ALDToken]: (e) => {\n      const {name, undefinedArticle} = translate(e.type);\n      return `Le bloc ${undefinedArticle + name} redfini en ${printLoc(e.loc2)} est dj dfini en ${printLoc(e.loc1)}`;\n    },\n    [exception.existingId]: (e) => {\n      const {name, undefinedArticle} = translate(e.type);\n      return `L'identifiant ${undefinedArticle + name} ${e.value} est redfini en ${printLoc(e.loc)}`;\n      // FIXME\n      // return `L'identifiant ${undefinedArticle + name} ${e.value} redfini en ${printLoc(e.loc2)} est dj dfini en ${printLoc(e.loc1)}`;\n    },\n    [exception.wrongType]: (e) => {\n      // log.error(e);\n return \"La valeur dclare en \" + printLoc(e.loc) + \" doit tre de type \" + e.type;\n    },\n    [exception.unknownProp]: (e) => \"L'attribut \" + e.propertyName + \" dfini en \" + printLoc(e.loc) + \" n'est pas support\",\n    [exception.syntax]: treatSyntaxException,\n    [exception.unknownId]: (e) => `Identifiant ${e.value} utilis en ${printLoc(e.loc)} inconnu.`,\n    [exception.fsmType]: (e) => `${e.type} (${printLoc(e.loc)}) n'est pas un type d'automate valide.`,\n    [exception.MBToken]: (e) => {\n      const {name, undefinedArticle} = translate(e.type);\n      return `Le bloc ${undefinedArticle + name} est manquant.`;\n    },\n    default: (e) => log.debug(`UNHANDLED ERROR ${e.name}\\n ${e.message}`)\n  };\n  return error.name +  \" : \" + error.dispatch(treat);\n}\n\nexport function firstError(e) {\n  return e.dispatch({\n    [exception.array]: (e1) => firstError(e1.exceptions.filter((e2) => e2 != null)[0]),\n    [exception.object]: (e1) => firstError(e1.exceptions[Object.keys(e1.exceptions)[0]]),\n    default: (e1) => e1\n  });\n}\n\n// TODO\n// Use a real localisation framework\nfunction translate(type) {\n  switch(type) {\n    case \"states\":\n      return {\n      name: \"tats\",\n      undefinedArticle: \"des \"\n    };\n    case \"symbols\":\n      return {\n      name: \"symboles\",\n      undefinedArticle: \"des \"\n    };\n    case \"transitions\":\n      return {\n      name: \"transitions\",\n      undefinedArticle: \"des \"\n    };\n    case \"state\":\n      return {\n      name: \"tat\",\n      undefinedArticle: \"d'\"\n    };\n    case \"symbol\":\n      return {\n      name: \"symbole\",\n      undefinedArticle: \"de \"\n    };\n    case \"transition\":\n      return {\n      name: \"transition\",\n      undefinedArticle: \"de \"\n    };\n    default:\n      throw new Error(\"Cannot translate \" + type + \".\");\n  };\n}\n\nfunction printLoc(loc) {\n  return loc.start.line + \":\" + loc.start.column;\n}\n\nfunction treatSyntaxException(e) {\n  const expected = e.expected.map((ex) => {\n    if(ex.value === \"[ \\\\t\\\\n\\\\r]\") {\n      return \"espace, tabuluation, saut de ligne, retour chariot\";\n    }\n    return ex.value;\n  }).join(\"\\n\");\n  return `Erreur de syntaxe en ${printLoc(e.location)}. ${e.found} trouv.\\n\\\n    Tokens autoriss : ${expected}`;\n}\n\n","/**\n * @module lib/fsm\n * @requires lib/utils/iterator\n * @requires lib/utils/descriptor\n */\n\nimport * as utilsIterator from \"./utils/iterator\";\nimport {default as check, exception} from \"./utils/check\";\n\n/**\n * @param {?module:lib/fsm~Cfg} cfg\n */\nexport default function fsm(cfg) {\n  return new Fsm(cfg);\n}\n\nconst checks = {};\n\n/**\n * A function that augments a class.\n *\n * It should not mutate its argument and return a new constructor that\n * implements a compatible interface.\n * @callback Mixin\n * @param {Class} inputClass\n * @return {Class} outputClass\n * @global\n */\n\n// const identity = (x) => x;\n\n// FIXME\n// checks.Mixin = check().defaults(identity).instanceOf(Function);\nchecks.Mixin = check().instanceOf(Function);\n\n/**\n * An object literal that holds data meant to be digested by a constructor.\n * @typedef Descriptor\n * @type mdn:Object\n * @global\n */\n\n/**\n * Mixins to be applied on the inner classes of a finite state machine.\n *\n * Each inner class is replaced by the output of the corresponding mixin.\n * This is used to augment the functionalities before instanciation.\n * Make sure to keep every method defined.\n * @typedef Mixins\n * @property {Mixin} symbols\n * The mixin that will be applied on {@link module:fsm~Fsm~Symbol}.\n * @property {Mixin} states\n * The mixin that will be applied on {@link module:fsm~Fsm~State}.\n * @property {Mixin} transitions\n * The mixin that will be applied on {@link module:fsm~Fsm~Transition}.\n */\nchecks.FsmMixins = check().object({\n  symbols: checks.Mixin,\n  states: checks.Mixin,\n  transitions: checks.Mixin,\n});\n\n/**\n * Descriptors defining the default values for each inner class\n *\n * When passing a descriptor through the `add` method,\n * it checks for every property defined in the respective default\n * descriptor. If the value of such property is missing, it is replaced\n * by the one in the default descriptor.\n * @typedef Defaults\n * @type Descriptor\n * @property {Descriptor} symbols\n * Default descriptor for the symbols.\n * @property {Descriptor} states\n * Default descriptor for the states.\n * @property {Descriptor} transitions\n * Default descriptor for the transitions.\n */\n// checks.FsmDefaults = check().object({\n//   symbols: checks.descriptor,\n//   states: checks.descriptor,\n//   transitions: checks.descriptor\n// });\n\n/**\n * Descriptor for the data of a finite state machine\n *\n * Each property should hold an array of descriptors that will be passed\n * to the respective `add` method at instanciation.\n * The `from`, `to` and `by` fields of the transitions' descriptors should\n * hold the indexes of the corresponding state or symbol in the other arrays.\n * @typedef FsmDescriptor\n * @type Descriptor\n * @property {Array.<Descriptor>} symbols\n * An array of descriptors used to create the symbols.\n * @property {Array.<Descriptor>} states\n * An array of descriptors used to create the states.\n * @property {Array.<Descriptor>} transitions\n * An array of descriptors used to create the transitions. Beware of the\n * `from`, `to` and `by` properties.\n */\n// checks.FsmDescriptor = check().object({\n// });\n// cfg = check().definition({\n//   mixins: check().definition({\n//     symbols: checks.mixin,\n//     states: checks.mixin,\n//     transitions: checks.mixin\n//   }),\n//   descriptor: check().definition({\n//     symbols: check().array((a) => Symbol.add(a)),\n//     states: check().array((s) => State.add(s)),\n//     transitions: check().array(checks.transitionNum),\n//   })\n// });\n\n\n/**\n * A configuration object for a finite state machine\n * @typedef Cfg\n * @type Object\n * @property {Mixins} mixins\n * Used to extend the functionalities of the finite state machine.\n * @property {FsmDescriptor} descriptor - The initial data.\n */\nchecks.Cfg = check().object({\n  mixins: checks.FsmMixins\n});\n\n/**\n * @constructor\n * @param {module:lib/fsm~Cfg} cfg={}\n * @protected\n */\nfunction Fsm(cfg) {\n\n  // Data\n\n  // symbols: Map of:\n  //   - keys: symbols ; let `a` be the key\n  //   - values: objects with:\n  //     - transitions: Set of transitions, where `by = a`\n  // states: Map of:\n  //  - keys: states ; let `k` be the key\n  //  - values: objects with:\n  //    - initial: boolean\n  //    - final: boolean\n  //    - pred : Map of: \n  //      - keys: symbols ; let `a` be the key\n  //      - values: Set of transitions, where `to = k` and `by = a`\n  //    - succ: Map of:\n  //      - keys: states ; let `s` be the key\n  //      - values: Map of:\n  //        - keys: symbols ; let `a` be the key\n  //        - values: transition, where `to = s`, `from = k` and `by = a`\n  // transitions: Map of:\n  //   - keys: transitions\n  //   - values: objects with:\n  //     - from: state\n  //     - to: state\n  //     - by: symbol\n  \n  cfg = checks.Cfg.resolve(cfg);\n\n  const data = {\n    symbols: new Map(),\n    states: new Map(),\n    transitions: new Map()\n  };\n\n  data.states.initials = new Set();\n  data.states.terminals = new Set();\n\n  const struct = this;\n\n  // API\n\n  /**\n   * @class\n   * @memberof module:lib/fsm~Fsm\n   * @inner\n   * @protected\n   */\n  class Symbol {\n    /**\n     * The accessor of the finite state machine owning the symbol.\n     * @type {module:lib/fsm} \n     * @readonly\n     */\n    get struct() { return struct; }\n    /**\n     * Iterates on the symbols owned by the finite state machine.\n     * @return {Iterator.<module:lib/fsm~Fsm~Symbol>} an iterator of every symbol\n     */\n    static all() { return getSymbols(data); }\n    /**\n     * Creates a symbol, adds it to the finite state machine and returns it.\n     *\n     * The symbol has the prototype of the calling class.\n     * @return {module:lib/fsm~Fsm~Symbol} the newly created symbol\n     */\n    static add() {\n      return addSymbol({}, new AugmentedSymbol(arguments), data);\n    }\n    /**\n     * Removes a symbol and its associated transitions. Chainable.\n     *\n     * If there is no such symbol, the function silently fails and still\n     * returns the accessor.\n     * @param {module:lib/fsm~Fsm~Symbol} symbol - symbol to remove\n     * @return {module:lib/fsm} the accessor of the finite state machine\n     */\n    static remove(symbol) {\n      symbol = checks.Symbol.remove.resolve(symbol);\n      if(exception(symbol)) return symbol;\n      removeSymbol(symbol, data);\n      return struct;\n    }\n  };\n  \n  /**\n   * @class\n   * @memberof module:lib/fsm~Fsm\n   * @inner\n   * @protected\n   */\n  class State {\n    /**\n     * The accessor of the finite state machine owning the symbol\n     * @type {module:lib/fsm} \n     * @readonly\n     */\n    get struct() { return struct; }\n    /**\n     * Whether the state is initial\n     * @type {boolean} \n     * @readonly\n     */\n    get initial() { return !!data.states.get(this).initial; }\n    /**\n     * Whether the state is terminal\n     * @type {boolean} \n     * @readonly\n     */\n    get terminal() { return !!data.states.get(this).terminal; }\n    /**\n     * @return {Iterator.<module:lib/fsm~Fsm~State>} every state\n     */\n    static all() { return getStates(data); }\n    /**\n     * @return {Iterator.<module:lib/fsm~Fsm~State>} every initial state\n     */\n    static initials() { return getInitialStates(data); }\n    /**\n     * @return {Iterator.<module:lib/fsm~Fsm~State>} every initial state\n     */\n    static terminals() { return getTerminalStates(data); }\n    /**\n     * Removes a state and the associated transitions\n     * @param {module:lib/fsm~Fsm~State} state - state to remove\n     * @return {module:lib/fsm} the finite state machine\n     */\n    static remove(state) {\n      // state = checks.State.remove.resolve(state); TODO\n      if(exception(state)) return state;\n      removeState(state, data);\n      return struct;\n    }\n    /**\n     * Creates and adds a state\n     * @param {?Object} descriptor state descriptor\n     * @param {?boolean} descriptor.initial false if omitted\n     * @param {?boolean} descriptor.terminal false if omitted\n     * @return {module:lib/fsm~Fsm~Transition} the newly created state\n     */\n    static add(descriptor, ...args) {\n      // descriptor = checks.State.add.resolve(descriptor); TODO\n      descriptor = Object.assign({}, descriptor);\n      if(exception(descriptor)) return descriptor;\n      return addState(descriptor, new AugmentedState(arguments), data);\n    }\n  };\n\n  /**\n   * @class\n   * @memberof module:lib/fsm~Fsm\n   * @inner\n   * @protected\n   */\n  class Transition {\n    /**\n     * The accessor of the finite state machine that owns the transition\n     * @type {module:lib/fsm} \n     * @readonly\n     */\n    get struct() { return struct; }\n    /**\n     * The source of the transition\n     * @type {module:lib/fsm~Fsm~State} \n     * @readonly\n     */\n    get from() { return data.transitions.get(this).from; }\n    /**\n     * The target of the transition\n     * @type {module:lib/fsm~Fsm~State} \n     * @readonly\n     */\n    get to() { return data.transitions.get(this).to; }\n    /**\n     * The symbol of the transition\n     * @type {module:lib/fsm~Fsm~State} \n     * @readonly\n     */\n    get by() { return data.transitions.get(this).by; }\n    /**\n     * @return {Iterator.<module:lib/fsm~Fsm~Transition>} every transition\n     */\n    static all() { return getTransitions(data); }\n    /**\n     * Get a transition\n     * @function\n     * @param {Object} descriptor\n     * @param {!module:lib/fsm~Fsm~State} descriptor.from source\n     * @param {!module:lib/fsm~Fsm~State} descriptor.to target\n     * @param {!module:lib/fsm~Fsm~Symbol} descriptor.by symbol\n     * @return {module:lib/fsm~Fsm~Transition}\n     * @throws {TypeError} Will throw if the descriptor is invalid\n     */\n    static get(descriptor) {\n      // descriptor = checks.Transition.get.resolve(descriptor); TODO\n      descriptor = Object.assign({}, descriptor);\n      if(exception(descriptor)) return descriptor;\n      return getTransition(descriptor.from, descriptor.to, descriptor.by, data);\n    }\n    /**\n     * Creates and adds a transition\n     *\n     * If an equivalent transition already exists, the function returns it\n     * (thus failing silently)\n     * @param {Object} descriptor\n     * @param {!module:lib/fsm~Fsm~State} descriptor.from source\n     * @param {!module:lib/fsm~Fsm~State} descriptor.to target\n     * @param {!module:lib/fsm~Fsm~Symbol} descriptor.by symbol\n     * @return {module:lib/fsm~Fsm~Transition} the newly created transition\n     */\n    static add(descriptor) {\n      // descriptor = checks.Transition.add.resolve(descriptor); TODO\n      descriptor = Object.assign({}, descriptor);\n      if(exception(descriptor)) return descriptor;\n      return addTransition(descriptor, new AugmentedTransition(arguments), data);\n    }\n    /**\n     * Removes a transition\n     * @param {module:lib/fsm~Fsm~Transition} transition - transition to remove\n     * @return {module:lib/fsm} the finite state machine\n     */\n    static remove(transition) {\n      // transition = checks.Transition.remove.resolve(transition); TODO\n      if(exception(transition)) return transition;\n      removeTransition(transition);\n      return struct;\n    }\n    /**\n     * Creates an iterator of transitions that match the selector attributes\n     * @param {Object} selector\n     * @param {?module:lib/fsm~Fsm~State} selector.from source\n     * @param {?module:lib/fsm~Fsm~State} selector.to target\n     * @param {?module:lib/fsm~Fsm~Symbol} selector.by symbol\n     * @return {Iterator.<module:lib/fsm~Fsm~Transition>} the selected transitions\n     */\n    static select(selector) {\n      // selector = checks.Transition.select.resolve(selector); TODO\n      selector = Object.assign({}, selector);\n      if(exception(selector)) return selector;\n      let args = [];\n      let getter = getTransitions;\n      if(selector.from != null) {\n        getter = getter.from;\n        args.push(selector.from);\n      }\n      if(selector.to != null) {\n        getter = getter.to;\n        args.push(selector.to);\n      }\n      if(selector.by != null) {\n        getter = getter.by;\n        args.push(selector.by);\n      }\n      args.push(data);\n      return getter.apply(null, args);\n    }\n\n    /**\n     * Creates nested iterators\n     * The transitions are first split by their source state, then their target\n     * states\n     * @return {Iterator.<Iterator.<Iterator.<module:lib/fsm~Fsm~Transition>>>} the collection\n     */\n    static groups() { return getTransitions.groups(data); }\n  };\n  \n  const AugmentedSymbol = cfg.mixins.symbols(Symbol);\n  const AugmentedState = cfg.mixins.states(State);\n  const AugmentedTransition = cfg.mixins.transitions(Transition);\n\n  /**\n   * @type {Class}\n   */\n  this.symbols = AugmentedSymbol;\n  /**\n   * @type {Class}\n   */\n  this.states = AugmentedState;\n  /**\n   * @type {Class}\n   */\n  this.transitions = AugmentedTransition;\n};\n\n// Logic\n\n// Conventions:\n//   - `a` is a symbol ; `as` is a collection of symbols\n//   - `s` is a state ; `ss` is a collection of states\n//   - `t` is a transition ; `ts` is a collection of transitions\n//   - `sf` is a source state (state from)\n//   - `st` is a target state (state to)\n\nconst addSymbol = (o, symbol, data) => {\n  o.tran = new Set();\n  data.symbols.set(symbol, o);\n  return symbol;\n};\n\nconst addState = (o, state, data) => {\n  o.succ = new Map();\n  o.pred = new Map();\n  data.states.set(state, o);\n  if(o.initial) {\n    data.states.initials.add(state);\n  }\n  if(o.terminal) {\n    data.states.terminals.add(state);\n  }\n  return state;\n};\n\nconst addTransition = (o, transition, data) => {\n  const succ = data.states.get(o.from).succ;\n  let as = succ.get(o.to);\n  if(as == null) {\n    as = new Map();\n    succ.set(o.to, as);\n  }\n  let t = as.get(o.by);\n  // TODO transition already exists\n  if(t == null) {\n    t = transition;\n    as.set(o.by, t);\n    const pred = data.states.get(o.to).pred;\n    let ts = pred.get(o.by);\n    if(ts == null) {\n      ts = new Set();\n      pred.set(o.by, ts);\n    }\n    ts.add(t);\n    data.symbols.get(o.by).tran.add(t);\n    data.transitions.set(t, o);\n  };\n  return t;\n};\n\nconst getTransition = (sf, st, a, data) => {\n  let as = data.states.get(sf).succ.get(st);\n  if(as == null) return null;\n  return as.get(a);\n};\n\nconst getSymbols = (data) => data.symbols.keys();\n\nconst getStates = (data) => data.states.keys();\n\nconst getInitialStates = (data) => data.states.initials.values();\n\nconst getTerminalStates = (data) => data.states.terminals.values();\n\nconst getTransitions = (data) => data.transitions.keys();\n\ngetTransitions.groups = () => utilsIterator.apply(\n  data.states.entries(),\n  ([sf, map1]) => {\n    const iter = utilsIterator.apply(\n      map1.entries(),\n      ([st, map2]) => {\n        const subiter = map2.values();\n        subiter.to = st;\n        return subiter;\n      }\n    );\n    iter.from = sf;\n    return iter;\n  }\n);\n\ngetTransitions.from = (sf) => utilsIterator.flatten(\n  data.states.get(sf).succ.values(),\n  (map) => map.values()\n);\n\ngetTransitions.to = (st) => states.get(st).pred.values();\n\ngetTransitions.by = (a) => symbols.get(a).transitions.values();\n\ngetTransitions.from.to = (sf, st) => states.get(sf).succ.get(st).values();\n\ngetTransitions.to.by = (st, a) => states.get(st).pred.get(a).values();\n\ngetTransitions.from.by = (sf, a) => utilsIterator.flatten(\n  states.get(sf).succ.values(),\n  (map) => {\n    let t = map.get(a);\n    if(t == null) {\n      return utilsIterator.empty();\n    }\n    return utilsIterator.wrap(t);\n  }\n);\n\ngetTransitions.from.to.by = (sf, st, a, data) => {\n  const t = getTransition(sf, st, a, data);\n  if(t == null) {\n    return utilsIterator.empty();\n  }\n  return utilsIterator.wrap(t);\n};\n\nconst removeSymbol = (a, data) => {\n  for(let t of getTransitions.by(a)) {\n    const o = data.transitions.get(t);\n    data.states.get(o.from).succ.get(o.from).delete(a);\n    data.states.get(o.to).pred.delete(a);\n    data.transitions.delete(t);\n  }\n  data.symbols.delete(a);\n};\n\nconst removeState = (s, data) => {\n  for(let t of getTransitions.to(s)) {\n    const o = data.transitions.get(t);\n    data.states.get(o.to).succ.delete(s);\n    data.symbols.get(o.by).transitions.delete(t);\n    data.transitions.delete(t);\n  }\n  for(let t of getTransitions.from(s)) {\n    const o = data.transitions.get(t);\n    data.states.get(o.from).pred.get(o.by).delete(t);\n    data.symbols.get(o.by).transitions.delete(t);\n    data.transitions.delete(t);\n  }\n  if(s.initial) {\n    data.states.initials.delete(s);\n  }\n  if(s.terminal) {\n    data.states.terminals.delete(s);\n  }\n  data.states.delete(s);\n};\n\nconst removeTransition = (t, data) => {\n  const o = data.transitions.get(t);\n  if(o != null) {\n    data.states.get(o.from).succ.get(o.to).delete(o.by);\n    data.states.get(o.to).pred.get(o.by).delete(t);\n    data.symbols.get(o.by).transitions.delete(t);\n    data.transitions.delete(t);\n  }\n};\n","\"use strict\";\n      Object.defineProperty(exports, \"__esModule\", {\n        value: true\n      });\n      exports.default = (function() {\n  \"use strict\";\n\n  /*\n   * Generated by PEG.js 0.9.0.\n   *\n   * http://pegjs.org/\n   */\n\n  function peg$subclass(child, parent) {\n    function ctor() { this.constructor = child; }\n    ctor.prototype = parent.prototype;\n    child.prototype = new ctor();\n  }\n\n  function peg$SyntaxError(message, expected, found, location) {\n    this.message  = message;\n    this.expected = expected;\n    this.found    = found;\n    this.location = location;\n    this.name     = \"SyntaxError\";\n\n    if (typeof Error.captureStackTrace === \"function\") {\n      Error.captureStackTrace(this, peg$SyntaxError);\n    }\n  }\n\n  peg$subclass(peg$SyntaxError, Error);\n\n  function peg$parse(input) {\n    var options = arguments.length > 1 ? arguments[1] : {},\n        parser  = this,\n\n        peg$FAILED = {},\n\n        peg$startRuleIndices = { start: 0 },\n        peg$startRuleIndex   = 0,\n\n        peg$consts = [\n          function(t, attrs, a) { \n              setAttrs(desc, attrs);\n              setLocations(loc, attrs);\n              if(desc.data.transitions == null) {\n                  throw exception.create(exception.MBToken, \"transitions\");\n              }\n              return {desc, loc};\n            },\n          function(t) {\n                  desc.type = t;\n                  loc.type = location();\n              },\n          \"states\",\n          { type: \"literal\", value: \"states\", description: \"\\\"states\\\"\" },\n          function(t, attrs, s) { \n              if(desc.data.states == null) {\n                desc.data.states = s.data ;\n                loc.data.states = s.location;\n                desc.defaults.states = {};\n                loc.defaults.states = {};\n                setAttrs(desc.defaults.states, attrs);\n                setLocations(loc.defaults.states, attrs);\n                loc.defaults.states[locationToken] = location();\n              } else {\n                  throw new exception.create(exception.ALDToken, \"states\", loc.defaults.states[locationToken], location());\n              }\n            },\n          \"symbols\",\n          { type: \"literal\", value: \"symbols\", description: \"\\\"symbols\\\"\" },\n          function(t, attrs, s) {\n              if(desc.data.symbols == null) {\n                desc.data.symbols = s.data;\n                loc.data.symbols = s.location;\n                desc.defaults.symbols = {};\n                loc.defaults.symbols = {};\n                setAttrs(desc.defaults.symbols, attrs);\n                setLocations(loc.defaults.symbols, attrs);\n                loc.defaults.symbols[locationToken] = location();\n              } else {\n                  throw new exception.create(exception.ALDToken, \"symbols\", loc.defaults.symbols[locationToken], location());\n              }\n            },\n          \"transitions\",\n          { type: \"literal\", value: \"transitions\", description: \"\\\"transitions\\\"\" },\n          function(attrs, t) {\n              if(desc.data.transitions == null) {\n                desc.data.transitions = t.data;\n                loc.data.transitions = t.location;\n                desc.defaults.transitions = {};\n                loc.defaults.transitions = {};\n                setAttrs(desc.defaults.transitions, attrs);\n                setLocations(loc.defaults.transitions, attrs);\n                loc.defaults.transitions[locationToken] = location();\n              } else {\n                  throw new exception.create(exception.ALDToken, \"transitions\", loc.defaults.transitions[locationToken], location());\n              }\n            },\n          function(states) {\n                return {\n                  data: states.map((s) => s.data),\n                  location: states.map((s) => s.location)\n                }\n            },\n          function(symbols) {\n              return {\n                  data: symbols.map((s) => s.data),\n                  location: symbols.map((s) => s.location)\n              }\n            },\n          function(transitions) {\n              let data = new Array();\n              let location = new Array();\n              for(var i = 0; i < transitions.length; i++) {\n                  for(var j = 0; j < transitions[i].data.to.length; j++) {\n                      data.push(setAttrs({\n                          from: transitions[i].data.from,\n                          by: transitions[i].data.by,\n                          to: transitions[i].data.to[j].data\n                      }, transitions[i].data.attrs));\n                      location.push(setLocations({\n                          from: transitions[i].location.from,\n                          by: transitions[i].location.by,\n                          to: transitions[i].data.to[j].location\n                      }, transitions[i].data.attrs));\n                  }\n              }\n              return {data, location}\n            },\n          function(id, attrs) {\n              return {\n                  data: setAttrs({id: id.data}, attrs),\n                  location: setLocations({\n                      id: location(),\n                  }, attrs)\n              };\n            },\n          function(id, attrs) {\n              return {\n                  data: setAttrs({id: id.data}, attrs),\n                  location: setLocations({\n                      id: location(),\n                  }, attrs),\n              }\n            },\n          \"->\",\n          { type: \"literal\", value: \"->\", description: \"\\\"->\\\"\" },\n          function(from, by, to, attrs) {\n              return {\n                  data: {from: from.data, by: by.data, to: to.data, attrs},\n                  location: {from: from.location, by:  by.location, to:  to.location, attrs}\n              };\n            },\n          \",\",\n          { type: \"literal\", value: \",\", description: \"\\\",\\\"\" },\n          function(i, l) {\n                  return {\n                      data: new Array(i).concat(l.data),\n                      location : new Array(location()).concat(l.location)\n                  }\n              },\n          function(i) { \n                  return {\n                      data: new Array(i),\n                      location: location()\n                  };\n              },\n          \"[\",\n          { type: \"literal\", value: \"[\", description: \"\\\"[\\\"\" },\n          \"]\",\n          { type: \"literal\", value: \"]\", description: \"\\\"]\\\"\" },\n          function(attrs) { return {\n                data: attrs.map((a) => a.data),\n                location: attrs.map((a) => a.location)\n              }; },\n          \"=\",\n          { type: \"literal\", value: \"=\", description: \"\\\"=\\\"\" },\n          function(name, value) { \n                let obj = {}, loc = {};\n                obj[name.data] = value;\n                loc[name.data] = name.location;\n                return {\n                  data: obj,\n                  location: loc\n                };\n              },\n          function(name) { \n                  let obj = {}, loc = {}; \n                  obj[name.data] = true; \n                  loc[name.data] = name.location;\n                  return {\n                      data: obj,\n                      location: loc\n                  };\n              },\n          /^[a-zA-Z_0-9\\-]/,\n          { type: \"class\", value: \"[a-zA-Z_0-9\\\\-]\", description: \"[a-zA-Z_0-9\\\\-]\" },\n          function(id) {\n                  return {\n                      data: id,\n                      location: location()\n                  }\n              },\n          function(b) { return b === \"true\"; },\n          function(n) { return parseFloat(n); },\n          /^[^\"]/,\n          { type: \"class\", value: \"[^\\\\\\\"]\", description: \"[^\\\\\\\"]\" },\n          \"\\\"\",\n          { type: \"literal\", value: \"\\\"\", description: \"\\\"\\\\\\\"\\\"\" },\n          function(str) { return str; },\n          \"#\",\n          { type: \"literal\", value: \"#\", description: \"\\\"#\\\"\" },\n          function(color) { return color },\n          \".\",\n          { type: \"literal\", value: \".\", description: \"\\\".\\\"\" },\n          /^[0-9]/,\n          { type: \"class\", value: \"[0-9]\", description: \"[0-9]\" },\n          /^[a-fA-F0-9]/,\n          { type: \"class\", value: \"[a-fA-F0-9]\", description: \"[a-fA-F0-9]\" },\n          \"true\",\n          { type: \"literal\", value: \"true\", description: \"\\\"true\\\"\" },\n          \"false\",\n          { type: \"literal\", value: \"false\", description: \"\\\"false\\\"\" },\n          \"{\",\n          { type: \"literal\", value: \"{\", description: \"\\\"{\\\"\" },\n          \"}\",\n          { type: \"literal\", value: \"}\", description: \"\\\"}\\\"\" },\n          /^[ \\t\\n\\r]/,\n          { type: \"class\", value: \"[ \\\\t\\\\n\\\\r]\", description: \"[ \\\\t\\\\n\\\\r]\" }\n        ],\n\n        peg$bytecode = [\n          peg$decode(\"%;!/J#;</A$;/.\\\" &\\\"/3$;\\\"/*$8$: $##! )($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;1/' 8!:!!! )\"),\n          peg$decode(\"%;:/5#;#/,$;;/#$+#)(#'#(\\\"'#&'#\"),\n          peg$decode(\"$;$0#*;$&\"),\n          peg$decode(\";%.) &;&.# &;'\"),\n          peg$decode(\"%2\\\"\\\"\\\"6\\\"7#/\\\\#;</S$;/.\\\" &\\\"/E$;:/<$;(/3$;;/*$8&:$&#%#!)(&'#(%'#($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%2%\\\"\\\"6%7&/\\\\#;</S$;/.\\\" &\\\"/E$;:/<$;)/3$;;/*$8&:'&#%#!)(&'#(%'#($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%2(\\\"\\\"6(7)/[#;</R$;/.\\\" &\\\"/D$;:/;$;*/2$;;/)$8&:*&\\\"#!)(&'#(%'#($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%$;+0#*;+&/' 8!:+!! )\"),\n          peg$decode(\"%$;,0#*;,&/' 8!:,!! )\"),\n          peg$decode(\"%$;-0#*;-&/' 8!:-!! )\"),\n          peg$decode(\"%;1/@#;</7$;/.\\\" &\\\"/)$8#:.#\\\"\\\" )(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;1/@#;</7$;/.\\\" &\\\"/)$8#:/#\\\"\\\" )(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;1/\\x87#;</~$;1/u$;</l$20\\\"\\\"6071/]$;</T$;./K$;</B$;/.\\\" &\\\"/4$;</+$8*:2*$)'#!)(*'#()'#(('#(''#(&'#(%'#($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;1/A#23\\\"\\\"6374/2$;./)$8#:5#\\\"\\\" )(#'#(\\\"'#&'#./ &%;1/' 8!:6!! )\"),\n          peg$decode(\"%27\\\"\\\"6778/Y#;</P$$;00#*;0&/@$29\\\"\\\"697:/1$;</($8%:;%!\\\")(%'#($'#(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;1/\\\\#;</S$2<\\\"\\\"6<7=/D$;</;$;2/2$;</)$8&:>&\\\"%!)(&'#(%'#($'#(#'#(\\\"'#&'#.; &%;1/1#;</($8\\\":?\\\"!!)(\\\"'#&'#\"),\n          peg$decode(\"%%$4@\\\"\\\"5!7A/,#0)*4@\\\"\\\"5!7A&&&#/\\\"!&,)/' 8!:B!! )\"),\n          peg$decode(\"%;9/' 8!:C!! ).; &;4.5 &;5./ &%;6/' 8!:D!! )\"),\n          peg$decode(\"$4E\\\"\\\"5!7F0)*4E\\\"\\\"5!7F&\"),\n          peg$decode(\"%2G\\\"\\\"6G7H/G#%;3/\\\"!&,)/7$2G\\\"\\\"6G7H/($8#:I#!!)(#'#(\\\"'#&'#\"),\n          peg$decode(\"%%%2J\\\"\\\"6J7K/\\x8C#%%;8/P#;8/G$;8/>$;8/5$;8/,$;8/#$+&)(&'#(%'#($'#(#'#(\\\"'#&'#.? &%;8/5#;8/,$;8/#$+#)(#'#(\\\"'#&'#/\\\"!&,)/#$+\\\")(\\\"'#&'#/\\\"!&,)/' 8!:L!! )\"),\n          peg$decode(\"%%$;7/&#0#*;7&&&#/W#%2M\\\"\\\"6M7N/9#$;7/&#0#*;7&&&#/#$+\\\")(\\\"'#&'#.\\\" &\\\"/#$+\\\")(\\\"'#&'#/\\\"!&,)\"),\n          peg$decode(\"4O\\\"\\\"5!7P\"),\n          peg$decode(\"4Q\\\"\\\"5!7R\"),\n          peg$decode(\"2S\\\"\\\"6S7T.) &2U\\\"\\\"6U7V\"),\n          peg$decode(\"%;</;#2W\\\"\\\"6W7X/,$;</#$+#)(#'#(\\\"'#&'#\"),\n          peg$decode(\"%;</;#2Y\\\"\\\"6Y7Z/,$;</#$+#)(#'#(\\\"'#&'#\"),\n          peg$decode(\"$4[\\\"\\\"5!7\\\\0)*4[\\\"\\\"5!7\\\\&\")\n        ],\n\n        peg$currPos          = 0,\n        peg$savedPos         = 0,\n        peg$posDetailsCache  = [{ line: 1, column: 1, seenCR: false }],\n        peg$maxFailPos       = 0,\n        peg$maxFailExpected  = [],\n        peg$silentFails      = 0,\n\n        peg$result;\n\n    if (\"startRule\" in options) {\n      if (!(options.startRule in peg$startRuleIndices)) {\n        throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n      }\n\n      peg$startRuleIndex = peg$startRuleIndices[options.startRule];\n    }\n\n    function text() {\n      return input.substring(peg$savedPos, peg$currPos);\n    }\n\n    function location() {\n      return peg$computeLocation(peg$savedPos, peg$currPos);\n    }\n\n    function expected(description) {\n      throw peg$buildException(\n        null,\n        [{ type: \"other\", description: description }],\n        input.substring(peg$savedPos, peg$currPos),\n        peg$computeLocation(peg$savedPos, peg$currPos)\n      );\n    }\n\n    function error(message) {\n      throw peg$buildException(\n        message,\n        null,\n        input.substring(peg$savedPos, peg$currPos),\n        peg$computeLocation(peg$savedPos, peg$currPos)\n      );\n    }\n\n    function peg$computePosDetails(pos) {\n      var details = peg$posDetailsCache[pos],\n          p, ch;\n\n      if (details) {\n        return details;\n      } else {\n        p = pos - 1;\n        while (!peg$posDetailsCache[p]) {\n          p--;\n        }\n\n        details = peg$posDetailsCache[p];\n        details = {\n          line:   details.line,\n          column: details.column,\n          seenCR: details.seenCR\n        };\n\n        while (p < pos) {\n          ch = input.charAt(p);\n          if (ch === \"\\n\") {\n            if (!details.seenCR) { details.line++; }\n            details.column = 1;\n            details.seenCR = false;\n          } else if (ch === \"\\r\" || ch === \"\\u2028\" || ch === \"\\u2029\") {\n            details.line++;\n            details.column = 1;\n            details.seenCR = true;\n          } else {\n            details.column++;\n            details.seenCR = false;\n          }\n\n          p++;\n        }\n\n        peg$posDetailsCache[pos] = details;\n        return details;\n      }\n    }\n\n    function peg$computeLocation(startPos, endPos) {\n      var startPosDetails = peg$computePosDetails(startPos),\n          endPosDetails   = peg$computePosDetails(endPos);\n\n      return {\n        start: {\n          offset: startPos,\n          line:   startPosDetails.line,\n          column: startPosDetails.column\n        },\n        end: {\n          offset: endPos,\n          line:   endPosDetails.line,\n          column: endPosDetails.column\n        }\n      };\n    }\n\n    function peg$fail(expected) {\n      if (peg$currPos < peg$maxFailPos) { return; }\n\n      if (peg$currPos > peg$maxFailPos) {\n        peg$maxFailPos = peg$currPos;\n        peg$maxFailExpected = [];\n      }\n\n      peg$maxFailExpected.push(expected);\n    }\n\n    function peg$buildException(message, expected, found, location) {\n      function cleanupExpected(expected) {\n        var i = 1;\n\n        expected.sort(function(a, b) {\n          if (a.description < b.description) {\n            return -1;\n          } else if (a.description > b.description) {\n            return 1;\n          } else {\n            return 0;\n          }\n        });\n\n        while (i < expected.length) {\n          if (expected[i - 1] === expected[i]) {\n            expected.splice(i, 1);\n          } else {\n            i++;\n          }\n        }\n      }\n\n      function buildMessage(expected, found) {\n        function stringEscape(s) {\n          function hex(ch) { return ch.charCodeAt(0).toString(16).toUpperCase(); }\n\n          return s\n            .replace(/\\\\/g,   '\\\\\\\\')\n            .replace(/\"/g,    '\\\\\"')\n            .replace(/\\x08/g, '\\\\b')\n            .replace(/\\t/g,   '\\\\t')\n            .replace(/\\n/g,   '\\\\n')\n            .replace(/\\f/g,   '\\\\f')\n            .replace(/\\r/g,   '\\\\r')\n            .replace(/[\\x00-\\x07\\x0B\\x0E\\x0F]/g, function(ch) { return '\\\\x0' + hex(ch); })\n            .replace(/[\\x10-\\x1F\\x80-\\xFF]/g,    function(ch) { return '\\\\x'  + hex(ch); })\n            .replace(/[\\u0100-\\u0FFF]/g,         function(ch) { return '\\\\u0' + hex(ch); })\n            .replace(/[\\u1000-\\uFFFF]/g,         function(ch) { return '\\\\u'  + hex(ch); });\n        }\n\n        var expectedDescs = new Array(expected.length),\n            expectedDesc, foundDesc, i;\n\n        for (i = 0; i < expected.length; i++) {\n          expectedDescs[i] = expected[i].description;\n        }\n\n        expectedDesc = expected.length > 1\n          ? expectedDescs.slice(0, -1).join(\", \")\n              + \" or \"\n              + expectedDescs[expected.length - 1]\n          : expectedDescs[0];\n\n        foundDesc = found ? \"\\\"\" + stringEscape(found) + \"\\\"\" : \"end of input\";\n\n        return \"Expected \" + expectedDesc + \" but \" + foundDesc + \" found.\";\n      }\n\n      if (expected !== null) {\n        cleanupExpected(expected);\n      }\n\n      return new peg$SyntaxError(\n        message !== null ? message : buildMessage(expected, found),\n        expected,\n        found,\n        location\n      );\n    }\n\n    function peg$decode(s) {\n      var bc = new Array(s.length), i;\n\n      for (i = 0; i < s.length; i++) {\n        bc[i] = s.charCodeAt(i) - 32;\n      }\n\n      return bc;\n    }\n\n    function peg$parseRule(index) {\n      var bc    = peg$bytecode[index],\n          ip    = 0,\n          ips   = [],\n          end   = bc.length,\n          ends  = [],\n          stack = [],\n          params, i;\n\n      while (true) {\n        while (ip < end) {\n          switch (bc[ip]) {\n            case 0:\n              stack.push(peg$consts[bc[ip + 1]]);\n              ip += 2;\n              break;\n\n            case 1:\n              stack.push(void 0);\n              ip++;\n              break;\n\n            case 2:\n              stack.push(null);\n              ip++;\n              break;\n\n            case 3:\n              stack.push(peg$FAILED);\n              ip++;\n              break;\n\n            case 4:\n              stack.push([]);\n              ip++;\n              break;\n\n            case 5:\n              stack.push(peg$currPos);\n              ip++;\n              break;\n\n            case 6:\n              stack.pop();\n              ip++;\n              break;\n\n            case 7:\n              peg$currPos = stack.pop();\n              ip++;\n              break;\n\n            case 8:\n              stack.length -= bc[ip + 1];\n              ip += 2;\n              break;\n\n            case 9:\n              stack.splice(-2, 1);\n              ip++;\n              break;\n\n            case 10:\n              stack[stack.length - 2].push(stack.pop());\n              ip++;\n              break;\n\n            case 11:\n              stack.push(stack.splice(stack.length - bc[ip + 1], bc[ip + 1]));\n              ip += 2;\n              break;\n\n            case 12:\n              stack.push(input.substring(stack.pop(), peg$currPos));\n              ip++;\n              break;\n\n            case 13:\n              ends.push(end);\n              ips.push(ip + 3 + bc[ip + 1] + bc[ip + 2]);\n\n              if (stack[stack.length - 1]) {\n                end = ip + 3 + bc[ip + 1];\n                ip += 3;\n              } else {\n                end = ip + 3 + bc[ip + 1] + bc[ip + 2];\n                ip += 3 + bc[ip + 1];\n              }\n\n              break;\n\n            case 14:\n              ends.push(end);\n              ips.push(ip + 3 + bc[ip + 1] + bc[ip + 2]);\n\n              if (stack[stack.length - 1] === peg$FAILED) {\n                end = ip + 3 + bc[ip + 1];\n                ip += 3;\n              } else {\n                end = ip + 3 + bc[ip + 1] + bc[ip + 2];\n                ip += 3 + bc[ip + 1];\n              }\n\n              break;\n\n            case 15:\n              ends.push(end);\n              ips.push(ip + 3 + bc[ip + 1] + bc[ip + 2]);\n\n              if (stack[stack.length - 1] !== peg$FAILED) {\n                end = ip + 3 + bc[ip + 1];\n                ip += 3;\n              } else {\n                end = ip + 3 + bc[ip + 1] + bc[ip + 2];\n                ip += 3 + bc[ip + 1];\n              }\n\n              break;\n\n            case 16:\n              if (stack[stack.length - 1] !== peg$FAILED) {\n                ends.push(end);\n                ips.push(ip);\n\n                end = ip + 2 + bc[ip + 1];\n                ip += 2;\n              } else {\n                ip += 2 + bc[ip + 1];\n              }\n\n              break;\n\n            case 17:\n              ends.push(end);\n              ips.push(ip + 3 + bc[ip + 1] + bc[ip + 2]);\n\n              if (input.length > peg$currPos) {\n                end = ip + 3 + bc[ip + 1];\n                ip += 3;\n              } else {\n                end = ip + 3 + bc[ip + 1] + bc[ip + 2];\n                ip += 3 + bc[ip + 1];\n              }\n\n              break;\n\n            case 18:\n              ends.push(end);\n              ips.push(ip + 4 + bc[ip + 2] + bc[ip + 3]);\n\n              if (input.substr(peg$currPos, peg$consts[bc[ip + 1]].length) === peg$consts[bc[ip + 1]]) {\n                end = ip + 4 + bc[ip + 2];\n                ip += 4;\n              } else {\n                end = ip + 4 + bc[ip + 2] + bc[ip + 3];\n                ip += 4 + bc[ip + 2];\n              }\n\n              break;\n\n            case 19:\n              ends.push(end);\n              ips.push(ip + 4 + bc[ip + 2] + bc[ip + 3]);\n\n              if (input.substr(peg$currPos, peg$consts[bc[ip + 1]].length).toLowerCase() === peg$consts[bc[ip + 1]]) {\n                end = ip + 4 + bc[ip + 2];\n                ip += 4;\n              } else {\n                end = ip + 4 + bc[ip + 2] + bc[ip + 3];\n                ip += 4 + bc[ip + 2];\n              }\n\n              break;\n\n            case 20:\n              ends.push(end);\n              ips.push(ip + 4 + bc[ip + 2] + bc[ip + 3]);\n\n              if (peg$consts[bc[ip + 1]].test(input.charAt(peg$currPos))) {\n                end = ip + 4 + bc[ip + 2];\n                ip += 4;\n              } else {\n                end = ip + 4 + bc[ip + 2] + bc[ip + 3];\n                ip += 4 + bc[ip + 2];\n              }\n\n              break;\n\n            case 21:\n              stack.push(input.substr(peg$currPos, bc[ip + 1]));\n              peg$currPos += bc[ip + 1];\n              ip += 2;\n              break;\n\n            case 22:\n              stack.push(peg$consts[bc[ip + 1]]);\n              peg$currPos += peg$consts[bc[ip + 1]].length;\n              ip += 2;\n              break;\n\n            case 23:\n              stack.push(peg$FAILED);\n              if (peg$silentFails === 0) {\n                peg$fail(peg$consts[bc[ip + 1]]);\n              }\n              ip += 2;\n              break;\n\n            case 24:\n              peg$savedPos = stack[stack.length - 1 - bc[ip + 1]];\n              ip += 2;\n              break;\n\n            case 25:\n              peg$savedPos = peg$currPos;\n              ip++;\n              break;\n\n            case 26:\n              params = bc.slice(ip + 4, ip + 4 + bc[ip + 3]);\n              for (i = 0; i < bc[ip + 3]; i++) {\n                params[i] = stack[stack.length - 1 - params[i]];\n              }\n\n              stack.splice(\n                stack.length - bc[ip + 2],\n                bc[ip + 2],\n                peg$consts[bc[ip + 1]].apply(null, params)\n              );\n\n              ip += 4 + bc[ip + 3];\n              break;\n\n            case 27:\n              stack.push(peg$parseRule(bc[ip + 1]));\n              ip += 2;\n              break;\n\n            case 28:\n              peg$silentFails++;\n              ip++;\n              break;\n\n            case 29:\n              peg$silentFails--;\n              ip++;\n              break;\n\n            default:\n              throw new Error(\"Invalid opcode: \" + bc[ip] + \".\");\n          }\n        }\n\n        if (ends.length > 0) {\n          end = ends.pop();\n          ip = ips.pop();\n        } else {\n          break;\n        }\n      }\n\n      return stack[0];\n    }\n\n\n        const init = require(\"./init.js\");\n        const setAttrs = init.setAttrs;\n        const setLocations = init.setLocations;\n        const locationToken = init.locationToken;\n        const exception = init.exception;\n\n        let desc = {\n          defaults: {},\n          data: {}\n        }\n\n        let loc = {\n          defaults: {},\n          data: {}\n        };\n\n\n\n    peg$result = peg$parseRule(peg$startRuleIndex);\n\n    if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n      return peg$result;\n    } else {\n      if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n        peg$fail({ type: \"end\", description: \"end of input\" });\n      }\n\n      throw peg$buildException(\n        null,\n        peg$maxFailExpected,\n        peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null,\n        peg$maxFailPos < input.length\n          ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)\n          : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)\n      );\n    }\n  }\n\n  return {\n    SyntaxError: peg$SyntaxError,\n    parse:       peg$parse\n  };\n})()","import {exception} from \"../utils/check\"\n\nconst locationToken = Symbol(\"location token\");\n\n\nfunction setAttrs(obj, attrs) {\n  if(attrs != null) {\n    for (var i = 0; i < attrs.data.length; i++) {\n      Object.assign(obj, attrs.data[i]);\n    }\n  }\n  return obj;\n}\n\nfunction setLocations(obj, attrs) {\n  if(attrs != null) {\n    for (var i = 0; i < attrs.location.length; i++) {\n      Object.assign(obj, attrs.location[i]);\n    }\n  }\n  return obj;\n}\n\nexception.ALDToken = exception.register(\n    \"AlreadyDefinedException\", \n    function (type, loc1, loc2) {\n      this.type = type;\n      this.loc1 = loc1;\n      this.loc2 = loc2;\n    }\n);\n\nexception.MBToken = exception.register(\n    \"MissingBlockException\",\n    function(type) {\n      this.type = type;\n    }\n);\n\n\nexport { setAttrs, setLocations, exception, locationToken};\n","import {default as check, exception} from \"./utils/check\";\nimport sketchFsm from \"./sketchFsm\";\nimport parser from \"./parser\";\n\nconst steps = { };\n\nexport default function pipeline(aml) {\n  const l = parser.parse(aml);\n  log.warn(l);\n  if(exception(l)) { return l; }\n  const desc = makePipeline()\n  .deepCompose(steps.config)\n  .deepCompose(steps.redundancy)\n  .deepCompose(steps.inference)\n  .compose(steps.gather)\n  .deepCompose(steps.indexes)\n  .resolve(l.desc);\n  if(exception(desc)) {\n    log.error(desc);\n    log.error(desc.message);\n    return putLoc(desc, l.loc);\n  }\n  const fsm = sketchFsm(desc);\n  if(exception(fsm)) {\n    return putLoc(fsm, l.loc.data);\n  }\n  return fsm;\n}\n\nfunction putLoc(errs, loc) {\n  errs.dispatch({\n    [exception.object]: (err) => {\n      err.onEachProperty((e, prop) => {\n        putLoc(e, loc[prop]);\n      })\n    },\n    [exception.array]: (err) => {\n      err.onEach((e, i) => {\n        putLoc(e, loc[i]);\n      })\n    },\n    // TODO fetch error location for redundancies\n    default: (err) => {\n      err.loc = loc;\n    }\n  });\n  return errs;\n}\n\nfunction makePipeline() {\n  const p = check().object();\n  p.resolve = resolve;\n  return p;\n}\n\nexception.existingId = exception.register(\n  \"ExistingId\",\n  function(value, type) {\n    this.type = type;\n    this.value = value;\n    this.message = `ExistingId: Id ${value} of ${type} already in use`;\n  }\n);\nexception.unknownId = exception.register(\"UnknownId\");\nexception.fsmType = exception.register(\n  \"WrongFsmType\",\n  function(type) {\n    this.type = type;\n    this.message = `WrongFsmType: \\\n      ${type} is not a valid finite state machine type`;\n  }\n);\n\nconst symbolsIds = new Map();\nconst statesIds = new Map();\nconst symbolsIndexes = new Map();\nconst statesIndexes = new Map();\nlet symbolIndex = 0;\nlet stateIndex = 0;\n\nfunction cleanup() {\n  symbolsIds.clear();\n  statesIds.clear();\n  symbolsIndexes.clear();\n  statesIndexes.clear();\n  symbolIndex = 0;\n  stateIndex = 0;\n};\n\nfunction resolve(...args) {\n  const result = this.constructor.prototype.resolve.apply(this, args);\n  cleanup();\n  return result;\n};\n\nconst color = check().ofType(\"string\"); // TODO\ncolor.opt = check().optional().compose(color);\nconst bool = check().ofType(\"boolean\");\nbool.opt = check().optional().compose(bool);\nconst integer = check().ofType(\"number\"); // TODO\ninteger.opt = check().optional().compose(integer);\n\nconst fsmType = check().defaults(\"finite-state-machine\");\n\nconst tagsSymbol = check().object({\n  color: color.opt,\n  bold: bool.opt,\n  italic: bool.opt\n});\n\nconst tagsState = check().object({\n  color: color.opt,\n  \"border-color\": color.opt,\n  \"text-color\": color.opt,\n  \"background-color\": color.opt,\n  bold: bool.opt,\n  italic: bool.opt,\n  width: integer.opt, \n  height: integer.opt\n});\n\nconst tagsTransition = check().object({\n  \"text-color\": color.opt,\n  bold: bool.opt,\n  italic: bool.opt\n});\n\nsteps.gather = check().object({\n  data: check().object({\n    symbols: check().add(() => symbolsIds.values()),\n    states: check().add(() => statesIds.values())\n  })\n}, true, [\"symbols\", \"states\", \"transitions\"]);\n\nsteps.indexes = check().object({\n  data: check().object({\n    symbols: check().iterable(check().add((a) => {\n      symbolsIndexes.set(a.id, symbolIndex++);\n      return a;\n    })),\n    states: check().iterable(check().add((s) => {\n      statesIndexes.set(s.id, stateIndex++);\n      return s;\n    })),\n    transitions: check().iterable(check().add((t) => {\n      t.from = statesIndexes.get(t.from);\n      t.to = statesIndexes.get(t.to);\n      t.by = symbolsIndexes.get(t.by);\n      return t;\n    }))\n  }) \n});\n\nsteps.config = check().object({\n  type: fsmType,\n  color: color.opt,\n  bold: bool.opt,\n  italic: bool.opt,\n  defaults: check().object({\n    symbols: check().object({}, true).deepCompose(tagsSymbol),\n    states: check().object({}, true).deepCompose(tagsState),\n    transitions: check().object({}, true).deepCompose(tagsTransition)\n  }, true),\n  data: check().object({}, true, [\"symbols\", \"states\", \"transitions\"])\n}, true);\n\nsteps.redundancy = check().object({\n  data: check().object({\n    symbols: check().iterable(check().object({\n      id: check().add((id, a) => {\n        if(symbolsIds.has(id)) {\n          return exception.create(exception.existingId, id, \"symbol\");\n        }\n        symbolsIds.set(id, a);\n        return id;\n      })\n    })),\n    states: check().iterable(check().object({\n      id: check().add((id, s) => {\n        if(statesIds.has(id)) {\n          return exception.create(exception.existingId, id, \"state\");\n        }\n        statesIds.set(id, s);\n        return id;\n      })\n    }))\n  })\n});\n\nsteps.inference = check().object({\n  data: check().object({\n    transitions: check().iterable(check().object({\n      from: check().add((from) => {\n        if(!statesIds.has(from)) {\n          statesIds.set(from, {id: from});\n        }\n        return from;\n      }),\n      to: check().add((to) => {\n        if(!statesIds.has(to)) {\n          statesIds.set(to, {id: to});\n        }\n        return to;\n      }),\n      by: check().add((by) => {\n        if(!symbolsIds.has(by)) {\n          symbolsIds.set(by, {id: by});\n        }\n        return by;\n      })\n    }))\n  })\n});\n\nsteps.strictness = check().object({\n  data: check().object({\n    transitions: check().iterable(check().object({\n      from: check().add((from) => {\n        if(!statesIds.has(from)) {\n          return exception.create(exception.unknownId, from, \"state\");\n        }\n        return from;\n      }),\n      to: check().add((to) => {\n        if(!statesIds.has(to)) {\n          return exception.create(exception.unknownId, to, \"state\");\n        }\n        return to;\n      }),\n      by: check().add((by) => {\n        if(!symbolsIds.has(by)) {\n          return exception.create(exception.unknownId, by, \"symbols\");\n        }\n        return by;\n      })\n    }))\n  })\n});\n\nexport const checks = {\n  color,\n  bool,\n  integer\n};\n","import {default as check, exception} from \"./utils/check\";\nimport fsm from \"./fsm\";\nimport { checks } from \"./pipeline\";\nimport dagre from \"dagre\";\nimport precedence, {lazy as lazyPrecedence} from \"./utils/precedence\";\n\nexport default function sketchFsm(cfg) {\n  return new Fsm(cfg);\n}\n\nfunction Fsm(cfg) {\n\n  const data = {\n    color: cfg.color,\n    bold: cfg.color,\n    italic: cfg.color\n  };\n\n  data.symbols = new WeakMap();\n  data.states = new WeakMap();\n  data.transitions = new WeakMap();\n  data.edges = new Map();\n\n  data.symbols.ids = new Map();\n  data.states.ids = new Map();\n\n  checks.label = check().optional().ofType(\"string\");\n\n  checks.symbolId = check().mandatory().ofType(\"string\").add((id) => {\n    return data.symbols.ids.has(id) ? exception.create(exception.existingId) : id;\n  });\n\n  const symbolsMixin = (FsmSymbol) => {\n    class Symbol extends FsmSymbol {\n      get id() { return data.symbols.get(this).id; }\n      get label() {\n        const symData = data.symbols.get(this);\n        return symData.label != null ? symData.label : symData.id;\n      }\n      get description() {\n        const a = data.symbols.get(this);\n        const d = {};\n        for(let prop of [ \"id\", \"label\", \"color\", \"bold\", \"italic\" ]) {\n          d[prop] = a[prop];\n        }\n        return d;\n      }\n      static add(descriptor) {\n        descriptor = check().object({\n          id: checks.symbolId,\n          label: checks.label,\n          color: checks.color.opt,\n          bold: checks.bool.opt,\n          italic: checks.bool.opt\n        }).resolve(descriptor);\n        if(exception(descriptor)) { return descriptor; }\n        const symbol = super.add();\n        if(exception(symbol)) { return symbol; }\n        data.symbols.set(symbol, descriptor);\n        data.symbols.ids.set(descriptor.id, symbol);\n        return symbol;\n      }\n    }\n    addAccessors(Symbol.prototype, \"symbols\", data, {\n      color: { check: checks.color },\n      bold: { check: checks.bool, default: false },\n      italic: { check: checks.bool, default: false }\n    });\n    return Symbol;\n  };\n\n  checks.stateId = check().mandatory().ofType(\"string\").add((id) => {\n    return data.states.ids.has(id) ? exception.create(exception.existingId) : id;\n  });\n\n  const statesMixin = (FsmState) => {\n    class State extends FsmState {\n      get id() { return data.states.get(this).id; }\n      get label() {\n        const stateData = data.states.get(this);\n        return stateData.label != null ? stateData.label : stateData.id;\n      }\n      get description() {\n        const s = data.states.get(this);\n        const d = {};\n        const properties = [\n          \"label\", \"x\", \"y\", \"width\", \"height\", \"color\", \"border-color\",\n          \"text-color\", \"background-color\", \"bold\", \"italic\"\n        ];\n        for(let prop of properties) {\n          d[prop] = s[prop];\n        }\n        d.initial = super.initial;\n        d.terminal = super.terminal;\n        return d;\n      }\n      static add(descriptor) {\n        // TODO check\n        descriptor = Object.assign({}, descriptor);\n        const state = FsmState.add({\n          initial: descriptor.initial,\n          terminal: descriptor.terminal\n        });\n        if(exception(state)) { return state; }\n        data.states.set(state, descriptor);\n        data.states.ids.set(descriptor.id, state);\n        return state;\n      }\n    }\n    addAccessors(State.prototype, \"states\", data, {\n      x: { check: checks.integer, precedence: [\n        function() { return data.states.get(this).x; },\n        function() { return data.states.get(this).computedX; },\n        () => 0\n      ], default: 0 },\n      y: { check: checks.integer, precedence: [\n        function() { return data.states.get(this).y; },\n        function() { return data.states.get(this).computedY; },\n        () => 0\n      ], default: 0 },\n      border_color: { check: checks.color, precedence: [\n        function() { return data.states.get(this).color; },\n        () => data.defaults.states[\"border-color\"],\n        () => data.defaults.states.color,\n        () => data.color\n      ]},\n      text_color: { check: checks.color, precedence: [\n        function() { return data.states.get(this).color; },\n        () => data.defaults.states[\"text-color\"],\n        () => data.defaults.states.color,\n        () => data.color\n      ]},\n      background_color: { check: checks.color },\n      bold: { check: checks.bool, default: false },\n      italic: { check: checks.bool, default: false },\n      height: { check: checks.integer, precedence: [ /*TODO*/ () => 60 ]},\n      width: { check: checks.integer, precedence: [ /*TODO*/ () => 60 ]}\n    });\n    return State;\n  };\n\n  const transitionsMixin = (FsmTransition) => {\n    class Transition extends FsmTransition {\n      get description() {\n        const t = data.transitions.get(this);\n        const d = {};\n        for(let prop of [ \"text-color\", \"bold\", \"italic\" ]) {\n          d[prop] = t[prop];\n        }\n        d.from = super.from;\n        d.to = super.to;\n        d.by = super.by;\n        return d;\n      }\n      static add(descriptor) {\n        // TODO check\n        descriptor = Object.assign({}, descriptor);\n        const transition = super.add({\n          from: descriptor.from,\n          to: descriptor.to,\n          by: descriptor.by\n        });\n        if(exception(transition)) { return transition; }\n        data.transitions.set(transition, descriptor);\n        // TODO cleanup - add edge\n        let fromDesc, sameFrom, edge;\n        fromDesc = data.states.get(transition.from);\n        sameFrom = fromDesc.edges;\n        if(sameFrom === undefined) {\n          sameFrom = new Map();\n          fromDesc.edges = sameFrom;\n        } \n        edge = sameFrom.get(transition.to);\n        if(edge === undefined) {\n          edge = new Edge();\n          sameFrom.set(transition.to, edge);\n          data.edges.set(edge, {\n            from: transition.from,\n            to: transition.to,\n            transitions: new Set([transition])\n          });\n        } else {\n          data.edges.get(edge).transitions.add(transition);\n        }\n        return transition;\n      }\n    }\n    addAccessors(Transition.prototype, \"transitions\", data, {\n      text_color: { check: checks.color, precedence: [\n        function() { return data.symbols.get(this.by).color; },\n        () => data.defaults.transitions.color,\n        () => data.defaults.symbols.color,\n        () => data.color\n      ], default: false },\n      bold: { check: checks.bool, precedence: [\n        function() { return data.symbols.get(this.by).bold; },\n        () => data.defaults.transitions.bold,\n        () => data.defaults.symbols.bold,\n        () => data.bold\n      ], default: false },\n      italic: { check: checks.bool, precedence: [\n        function() { return data.symbols.get(this.by).italic; },\n        () => data.defaults.transitions.italic,\n        () => data.defaults.symbols.italic,\n        () => data.italic\n      ], default:false }\n    });\n    return Transition;\n  };\n\n  // TODO sort symbols\n  class Edge {\n    get symbols() {\n      return Array.from(\n        data.edges.get(this).transitions,\n        (t) => t.by);\n    }\n    get from() {\n      return data.edges.get(this).from;\n    }\n    get to() {\n      return data.edges.get(this).to;\n    }\n    get points() {\n      const edgeData = data.edges.get(this);\n      const points = copyPoints(precedence(\n        edgeData.controls,\n        edgeData.computedControls,\n        []));\n      points.splice(0, 0, {x: edgeData.from.x(), y: edgeData.from.y()});\n      points.splice(points.length, 0, {x: edgeData.to.x(), y: edgeData.to.y()});\n      return points;\n    }\n    static all() {\n      return data.edges.keys();\n    }\n  }\n  addAccessors(Edge.prototype, \"edges\", data, {\n    controls: { check: check().iterable() /*TODO*/, precedence: [\n      function() { return copyPoints(data.edges.get(this).computedControls); }\n    ]},\n    height: { check: checks.integer, precedence: [], default: 0},\n    width: { check: checks.integer, precedence: [], default: 0},\n    x: { check: checks.integer, precedence: [\n      function() { return data.edges.get(this).computedX; }\n    ], default: 0 },\n    y: { check: checks.integer, precedence: [\n      function() { return data.edges.get(this).computedY; }\n    ], default: 0 },\n    label: { check: check().iterable(), precedence: [\n      function() { return data.edges.get(this).label; },\n      function() {\n        return Array.from(\n          data.edges.get(this).transitions,\n          (t) => t.by.label)\n          .join(\", \");\n      }\n    ]}\n  });\n\n  function computeLayout() {\n    let graph = new dagre.graphlib.Graph({\n      directed: true\n    }).setGraph({\n      marginx: 30,\n      marginy: 30,\n      nodesep: 30,\n      ranksep: 30,\n      edgesep: 20,\n      rankdir: \"LR\"\n    });\n\n    function addState(s) {\n      graph.setNode(s.id, {\n        width: s.width(),\n        height: s.height(),\n        label: s.label,\n        state: s\n      });\n    }\n\n    function addEdge(e) {\n      graph.setEdge(e.from.id, e.to.id, {\n        width: e.width(),\n        height: e.height(),\n        label: e.label,\n        labelpos: \"c\",\n        edge: e\n      });\n    }\n\n    for(let s of data.fsm.states.initials()) {\n      addState(s);\n    }\n    for(let s of data.fsm.states.all()) {\n      if(!s.initial) { addState(s); }\n    }\n    for(let e of Edge.all()) {\n      addEdge(e);\n    }\n    dagre.layout(graph);\n    for(let n of graph.nodes()) {\n      n = graph.node(n);\n      const stateData = data.states.get(n.state);\n      stateData.computedX = n.x;\n      stateData.computedY = n.y;\n    }\n    for(let e of graph.edges()) {\n      e = graph.edge(e.v, e.w);\n      const edgeData = data.edges.get(e.edge);\n      const points = copyPoints(e.points);\n      const labelPos = points[(points.length - 1) / 2];\n      edgeData.computedX = labelPos.x;\n      edgeData.computedY = labelPos.y;\n      points.splice(0, 1);\n      points.splice(points.length - 1, 1);\n      edgeData.computedControls = points;\n    }\n    return this;\n  };\n\n  data.fsm = fsm({\n    mixins: {\n      symbols: symbolsMixin,\n      states: statesMixin,\n      transitions: transitionsMixin\n    }\n  });\n\n  this.symbols = data.fsm.symbols;\n  this.states = data.fsm.states;\n  this.transitions = data.fsm.transitions;\n  this.edges = Edge;\n  this.layout = computeLayout;\n\n  const importError = fromTree(cfg.data, this, data);\n\n  if(exception(importError)) {\n    return importError;\n  }\n\n  log.debug(data);\n}\n\nconst randomHash = () => Math.random().toString(36).substring(2);\n\nconst randomId = (ids) => {\n  let id;\n  do {\n    id = randomHash();\n  } while(ids.has(id));\n  return id;\n};\n\nconst fromTree = (descriptor, struct, data) => {\n  const errors = {};\n  let hasErrors = false;\n\n  let symbols = check()\n  .iterable(check().add((a) => {\n    return struct.symbols.add(a);\n  })).resolve(descriptor.symbols);\n\n  let states = check()\n  .iterable(check().add((s) => {\n    return struct.states.add(s);\n  }))\n  .resolve(descriptor.states);\n\n  const dummyDescriptor = {};\n\n  if(exception(symbols)) {\n    errors.symbols = symbols;\n    symbols = symbols.output;\n    for(let i = 0, dummySymbol; i < symbols.length; i++) {\n      if(symbols[i] === undefined) {\n        dummyDescriptor.id = randomId(data.symbols.ids);\n        // TODO bypass it\n        dummySymbol = struct.symbols.add(dummyDescriptor);\n        // Assuming this doesn't fail\n        if(exception(dummySymbol)) { throw dummySymbol; }\n        symbols[i] = dummySymbol;\n      }\n    }\n    hasErrors = true;\n  }\n\n  if(exception(states)) {\n    errors.states = states;\n    states = states.output;\n    for(let i = 0, dummyState; i < states.length; i++) {\n      if(states[i] === undefined) {\n        // TODO bypass it\n        dummyDescriptor.id = randomId(data.states.ids);\n        dummyState = struct.states.add(dummyDescriptor);\n        // Assuming this doesn't fail\n        if(exception(dummyState)) { throw dummyState; }\n        states[i] = dummyState;\n      }\n    }\n    hasErrors = true;\n  }\n\n  let transitions = check().iterable(check().add((t) => {\n    const d = Object.assign({}, t);\n    d.from = states[t.from];\n    d.to = states[t.to];\n    d.by = symbols[t.by];\n    return struct.transitions.add(d);\n  })).resolve(descriptor.transitions);\n\n  if(exception(transitions)) {\n    errors.transitions = transitions;\n    transitions = transitions.output;\n    hasErrors = true;\n  }\n\n  if(hasErrors) {\n    return check().object({\n      symbols: check(),\n      states: check(),\n      transitions: check()\n    }).resolve(errors);\n  }\n\n};\n\nconst copyPoints = (points) => {\n  if(points == null) { return points; }\n  return points.map((p) => Object.assign({}, p));\n};\n\nconst addAccessors = (proto, kind, data, object) => {\n  let arg;\n  for(let method of Object.keys(object)) {\n    arg = object[method];\n    makeAccessor(\n      proto, kind,\n      method.replace(\"_\", \"-\"), method,\n      arg.check, data, arg.precedence, arg.default);\n  }\n};\n\nconst makeAccessor = (proto, kind, prop, method, check, data, callbacks, defaults) => {\n  if(callbacks === undefined) {\n    callbacks = [\n      () => data.defaults[kind][prop],\n      () => data[prop]\n    ];\n  }\n  if(defaults !== undefined) {\n    callbacks.push(() => defaults);\n  }\n  callbacks.unshift(function() {\n    return data[kind].get(this)[prop];\n  });\n  proto[method] = function(arg) {\n    if(arg === undefined) {\n      return lazyPrecedence(this, callbacks);\n    }\n    arg = check.resolve(arg);\n    if(exception(arg)) return arg;\n    data[kind].get(this)[prop] = arg;\n    return this;\n  };\n};\n\n","export default function fsmStyle(fsm) {\n\n  const states = new WeakMap();\n  const transitions = new WeakMap();\n  const symbols = new WeakMap();\n\n  const stateStyle = (s) => states.get(s);\n  const transitionStyle = (t) => transitions.get(t);\n  const symbolStyle = (a) => symbols.get(a);\n\n  const defaultStateStyle = {\n  };\n  const defaultTransitionStyle = {\n  };\n  const defaultSymbolStyle = {\n  };\n  \n  Object.defineProperties(fsm.statePrototype, {\n  });\n\n  Object.defineProperties(fsm.transitionPrototype, {\n  });\n\n  Object.defineProperties(fsm.symbolPrototype, {\n  });\n  \n  const stateBuilder = fsm.state;\n  fsm.state = (content) => {\n    const builder = stateBuilder(content);\n    const style = Object.assign({}, defaultStateStyle);\n\n    return builder;\n  };\n\n  const transitionBuilder = fsm.transition;\n  fsm.transition = (content) => {\n    const builder = transitionBuilder(content);\n    const style = Object.assign({}, defaultTransitionStyle);\n\n    return builder;\n  };\n\n  const symbolBuilder = fsm.symbol;\n  fsm.symbol = (content) => {\n    const builder = symbolBuilder(content);\n    const style = Object.assign({}, defaultSymbolStyle);\n\n    return builder;\n  };\n\n  return fsm;\n};\n","import sketchFsm from \"./sketchFsm\";\n\nexport const fsmFromTree = function(input) {\n  const struct = sketchFsm();\n\n  input.states.forEach((s) => {\n    if(s.initial == null) s.initial = false;\n    if(s.terminal == null) s.terminal = false;\n    struct.states.add(s);\n  });\n\n  input.symbols.forEach((a) => {\n    struct.symbols.add(a);\n  });\n\n  const states = Array.from(struct.states.all());\n  const symbols = Array.from(struct.symbols.all());\n  input.transitions.forEach((t) => {\n    t.from = states[t.from];\n    t.to = states[t.to];\n    t.by = symbols[t.by];\n    struct.transitions.add(t);\n  });\n\n  return struct;\n};\n\nexport const fsmToTree = function(struct) {\n\n  const output = {\n    type: \"finite-state-machine\",\n    symbols: [],\n    states: [],\n    transitions: []\n  };\n  const indexes = {\n    symbols: new Map(),\n    states: new Map()\n  };\n  \n  let i = 0;\n  for(let a of struct.symbols.all()) {\n    output.symbols.push(a.description);\n    indexes.symbols.set(a, i++);\n  }\n  i = 0;\n  for(let s of struct.states.all()) {\n    output.states.push(s.description);\n    indexes.states.set(s, i++);\n  };\n\n  for(let t of struct.transitions.all()) {\n    const td = t.description;\n    td.from = indexes.states.get(t.from);\n    td.to = indexes.states.get(t.to);\n    td.by = indexes.states.get(t.by);\n    output.transitions.push(td);\n  };\n\n  return output;\n};\n","/**\n * @module lib/utils/descriptor\n * @requires lib/utils/exception\n */\n\nimport exception from \"./exception\";\n\n/**\n * Creates a new check builder\n */\nfunction check() {\n  return new Check();\n}\n\nexport { check as default, exception };\n\nconst queueAccessor = Symbol(\"queue property name\");\n\nconst identityBypass = (x) => x;\nidentityBypass.bypass = true;\n\nconst emptyArrayDescriptor = () => {\n  emptyArrayDescriptor.d.value = [];\n  return emptyArrayDescriptor.d;\n};\n\nemptyArrayDescriptor.d = {\n  enumerable: false,\n  writable: false,\n  configurable: false\n};\n\nclass Check {\n  constructor() {\n    Object.defineProperty(this, queueAccessor, emptyArrayDescriptor());\n  }\n\n  optional() {\n    this[queueAccessor].push(identityBypass);\n    return this;\n  };\n\n  defaults(defaultValue) {\n    const checkDefaults = () => {\n      return defaultValue;\n    };\n    checkDefaults.bypass = true;\n    this[queueAccessor].push(checkDefaults);\n    return this;\n  };\n  /**\n   * @return {Any|CheckError<notMember>}\n   */\n  inMap(map) {\n    const checkInMap = (value) => {\n      if(map.has(value)) {\n        return value;\n      }\n      return exception.create(exception.notMember, value, map);\n    };\n    this[queueAccessor].push(checkInMap);\n    return this;\n  };\n\n  /**\n   * @return {Any|CheckError<notMember>}\n   */\n  inSet(map) {\n    const checkInSet = (value) => {\n      if(map.has(value)) {\n        return value;\n      }\n      return exception.create(exception.notMember, value, map);\n    };\n    this[queueAccessor].push(checkInSet);\n    return this;\n  };\n  /**\n   * @return {Any|CheckError<notMember>}\n   */\n  inArray(array) {\n    const checkInArray = (value) => {\n      if(array.includes(value)) {\n        return value;\n      }\n      return exception.create(exception.notMember, value, array);\n    };\n    this[queueAccessor].push(checkInArray);\n    return this;\n  };\n\n  /**\n   * @return {Any|CheckError<wrongType>}\n   */\n  ofType(type) {\n    const checkOfType = (value) => {\n      if(typeof value === type) {\n        return value;\n      }\n      return exception.create(exception.wrongType, value, type);\n    };\n    this[queueAccessor].push(checkOfType);\n    return this;\n  };\n\n  /**\n   * @return {Any|CheckError<wrongClass>}\n   */\n  instanceOf(constructor) {\n    const checkInstanceOf = (value) => {\n      if(value instanceof constructor) {\n        return value;\n      }\n      return exception.create(exception.wrongClass, value, constructor);\n    };\n    this[queueAccessor].push(checkInstanceOf);\n    return this;\n  };\n\n  /**\n   * @return {Any|CheckError<array>|CheckError<notIterable>}\n   */\n  iterable(check) {\n    const checkIterable = (value, ...parents) => {\n      value = value || [];\n      const exceptions = [];\n      const output = [];\n      if(value[Symbol.iterator] == null) {\n        return exception.create(exception.wrongType, value, \"iterable\");\n      }\n      if(checkIterable.check === undefined) {\n        return value;\n      }\n      let i = 0;\n      for(let v of value) {\n        const c = checkIterable.check.resolve(v,  output, ...parents);\n        if(exception(c)) {\n          exceptions[i] = c;\n        } else {\n          output[i] = c;\n        }\n        i++;\n      }\n      if(exceptions.length > 0) {\n        exceptions.length = i;\n        output.length = i;\n        return exception.create(exception.array, value, checkIterable.check, exceptions, output);\n      }\n      return output;\n    };\n    checkIterable.iterable = true;\n    checkIterable.check = check;\n    this[queueAccessor].push(checkIterable);\n    return this;\n  };\n  /**\n   * @return {Any|CheckError<object>}\n   */\n  object(definition, fireUnknown=false, order) {\n    definition = definition || {};\n    order = order || [];\n    const checkObject = (value, ...parents) => {\n      value = value || {};\n      const output = {};\n      const exceptions = {};\n      let c;\n      order = order.concat(\n        Object.keys(checkObject.definition).filter(\n          (prop) => !order.includes(prop)));\n      for(let prop of order) {\n        if(checkObject.definition[prop] === undefined) {\n          continue;\n        }\n        c = checkObject.definition[prop].resolve(value[prop], output, ...parents);\n        if(exception(c)) {\n          exceptions[prop] = c;\n        } else {\n          output[prop] = c;\n        }\n      }\n      for(let prop of Object.keys(value)) {\n        if(checkObject.definition[prop] === undefined) {\n          if(checkObject.fireUnknown) {\n            exceptions[prop] = exception.create(exception.unknownProp, value, checkObject.definition, prop);\n          } else {\n            output[prop] = value[prop];\n          }\n        }\n      }\n      if(Object.keys(exceptions).length > 0) {\n        return exception.create(exception.object, value, checkObject.definition, exceptions, output);\n      }\n      return output;\n    };\n    checkObject.object = true;\n    checkObject.definition = definition;\n    checkObject.order = order;\n    checkObject.fireUnkown = fireUnknown;\n    this[queueAccessor].push(checkObject);\n    return this;\n  };\n\n  /**\n   * @return {Any|CheckError<missingValue>}\n   */\n  mandatory() {\n    const checkMandatory = (value) => {\n      if(value == null) {\n        return exception.create(exception.missingValue, value);\n      }\n      return value;\n    };\n    this[queueAccessor].push(checkMandatory);\n    return this;\n  };\n\n  compose(check) {\n    const queue = this[queueAccessor];\n    for(let f of check[queueAccessor]) {\n      if(f.object === true) {\n        this.object(Object.assign(f.definition), f.fireUnknown, f.order);\n      } else if (f.iterable === true) {\n        this.iterable((new Check()).compose(f.check));\n      } else {\n        queue.push(f);\n      }\n    }\n    return this;\n  };\n  \n  // TODO merge orders\n  deepCompose(append) {\n    const queue = this[queueAccessor];\n    const appendQueue = append[queueAccessor];\n    if(appendQueue.length <= 0) {\n      return this;\n    }\n    if(queue.length <= 0) {\n      this.compose(append);\n      return this;\n    }\n    const tip = queue[queue.length - 1];\n    const toCompose = appendQueue[0];\n    if(tip.object === true && toCompose.object === true) {\n      const newDef = Object.assign({}, tip.definition);\n      for(let prop of Object.keys(toCompose.definition)) {\n        if(newDef[prop] === undefined) {\n          newDef[prop] = check().compose(toCompose.definition[prop]);\n        } else {\n          newDef[prop] = check().compose(newDef[prop]).deepCompose(toCompose.definition[prop]);\n        }\n      }\n      tip.definition = newDef;\n      return this;\n    }\n    if(tip.iterable === true && toCompose.iterable === true) {\n      tip.check = check().compose(tip.check).deepCompose(toCompose.check);\n      return this;\n    }\n    return this.compose(append);\n  }\n\n  add(f) {\n    this[queueAccessor].push(f);\n    return this;\n  };\n\n  resolve(value, ...parents) {\n    for(let f of this[queueAccessor]) {\n      if(exception(value)) {\n        return value;\n      }\n      if(f.bypass && value == null) {\n        return f.call(undefined, value, ...parents);\n      }\n      value = f.call(undefined, value, ...parents);\n    }\n    return value;\n  };\n\n  hold() {\n    return this.resolve.bind(this);\n  };\n}\n","/**\n * Check if the argument is of a registered exception type.\n * @param {mdn:Object} object - the object to check\n * @return {mdn:Boolean} whether the object is a registered exception\n */\nexport default function exception(object) {\n  return object == null ? false : registry.has(object[tokenAccessor]);\n}\n\n/**\n * The registry of every registered type of exception.\n * The keys are tokens that uniquely identifies a type of exception\n * and the values are the constructors used to instanciate them\n */\nconst registry = new Map();\n\n/**\n * A symbol to access the token property of the created exceptions.\n */\nconst tokenAccessor = Symbol(\"token property name\");\n\n\n/**\n * A helper function to efficiently use property descriptors in\n * {@link mdn:Object.defineProperty}.\n */\nfunction propertyDescriptor(value) {\n  propertyDescriptor.d.value = value;\n  return propertyDescriptor.d;\n}\n\npropertyDescriptor.d = {\n  enumerable: false,\n  configurable: false,\n  writable: false\n};\n\n/**\n * A default constructor for an exception\n */\nfunction Exception(value) {\n  this.name = this.constructor.name;\n  this.value = value;\n}\n\nconst depthAccessor = Symbol(\"depth property name\");\nconst incDepthAccessor = Symbol(\"increment depth property name\");\n\nconst properties = {\n  token: {\n    get: function() {\n      return this[tokenAccessor];\n    },\n    configurable: false,\n    enumerable: false\n  },\n  onIt: {\n    value: function(handler) {\n      return handler.call(undefined, this);\n    },\n    writable: false,\n    configurable: false,\n    enumerable: false\n  },\n  dispatch: {\n    value: function(handlers) {\n      if(!registry.has(this[tokenAccessor])) {\n        throw new Error(\"Not a recognized exception\");\n      }\n      let handler = handlers[this[tokenAccessor]];\n      if(handler == null) {\n        handler = handlers.default;\n        if(handler == null) {\n          throw this;\n        }\n      }\n      return this.onIt(handler);\n    },\n    writable: false,\n    configurable: false,\n    enumerable: false\n  }\n};\n\nconst messageProperty = {\n  get: function() {\n    return `${this.name} raised`;\n  },\n  configurable: true,\n  enumerable: true\n};\n\nconst incDepthProperty = {\n  value: function() {\n    this[depthAccessor]++;\n  },\n  configurable: false,\n  enumerable: true,\n  writable: false\n};\n\nObject.defineProperties(Exception.prototype, properties);\nObject.defineProperty(Exception.prototype, \"message\", messageProperty);\nObject.defineProperty(Exception.prototype, incDepthAccessor, incDepthProperty);\n\n/**\n * Registers a new type of exception.\n * @param {mdn:String} name - The name of the new type\n * @param {Class} superClass - An optional constructor that will be extended\n * @return {Symbol} The token of the newly created type of exception\n */\nexception.register = (name, superClass=Exception) => {\n  const newExceptionClass = class extends superClass {\n    constructor(...args) {\n      super(...args);\n      this.name = name;\n      this[depthAccessor] = 0;\n    }\n  };\n  const token = Symbol(name);\n  if(superClass !== Exception) {\n    Object.defineProperties(newExceptionClass.prototype, properties);\n    // if(!(\"message\" in newExceptionClass.prototype)) {\n    //   Object.defineProperty(newExceptionClass.prototype, \"message\", messageProperty);\n    // }\n    if(!(incDepthAccessor in newExceptionClass.prototype)) {\n      Object.defineProperty(newExceptionClass.prototype, incDepthAccessor, incDepthProperty);\n    }\n  }\n  Object.defineProperty(newExceptionClass.prototype, tokenAccessor, propertyDescriptor(token));\n  registry.set(token, newExceptionClass);\n  return token;  \n};\n\n\n/**\n * Creates an exception of a given type\n * @param {Symbol} The token\n * @param ...args The arguments to pass to the exception constructor\n * @return {Exception} The newly created exception\n * @throws Error When the supplied token does not match a registered type of \n * exception\n */\nexception.create = (token, ...args) => {\n  const exceptionClass = registry.get(token);\n  if(exceptionClass === undefined) {\n    throw new Error(\"Not a recognized exception\");\n  }\n  return new exceptionClass(...args);\n};\n\n/**\n * A collection of exceptions\n */\nclass ObjectExceptions {\n  constructor(descriptor, definition, exceptions, output) {\n    this.value = descriptor;\n    this.definition = definition;\n    this.exceptions = exceptions;\n    this.output = output;\n    this[incDepthAccessor]();\n    this[depthAccessor] = 0;\n  }\n  get message() {\n    let m = `${this.name}: exceptions on the following properties: `;\n    for(let prop of Object.keys(this.exceptions)) {\n      m += \"\\n\";\n      m += \"  \".repeat(this.exceptions[prop][depthAccessor]);\n      m += `${prop}: ${this.exceptions[prop].message}`;\n    }\n    return m;\n  }\n  onProperties(objectCallbacks) {\n    const results = {};\n    let callback, e;\n    for(let prop of Object.keys(this.exceptions)) {\n      callback = objectCallbacks[prop];\n      e = this.exceptions[prop];\n      if(callback == null) {\n        throw e;\n      }\n      results[prop] = callback.call(undefined, e);\n    }\n    return results;\n  }\n  onEachProperty(callback) {\n    const results = {};\n    let e;\n    for(let prop of Object.keys(this.exceptions)) {\n      e = this.exceptions[prop];\n      results[prop] = callback.call(undefined, e, prop);\n    }\n    return results;\n  }\n}\n\nObject.defineProperty(ObjectExceptions.prototype, incDepthAccessor, propertyDescriptor(function() {\n  this[depthAccessor]++;\n  for(let prop of Object.keys(this.exceptions)) {\n    this.exceptions[prop][incDepthAccessor]();\n  }\n}));\n\n/**\n * A collection of exceptions\n */\nclass ArrayExceptions {\n  constructor(value, definition, exceptions, output) {\n    this.value = value;\n    this.definition = definition;\n    this.output = output;\n    this.exceptions = exceptions;\n    this[incDepthAccessor]();\n    this[depthAccessor]--;\n  }\n  get message() {\n    let m = `${this.name}: exceptions on the following indexes: `;\n    this.exceptions.forEach((err, i) => {\n      if(err != null) {\n        m +=\"\\n\";\n        m += \"  \".repeat(err[depthAccessor]);\n        m += `index ${i}: ${err.message}`;\n      }\n    });\n    return m;\n  }\n  onEach(callback) {\n    const results = [];\n    for(let err, i = 0; i < this.exceptions.length; i++) {\n      err = this.exceptions[i];\n      if(err !== undefined) {\n        results[i] = callback.call(undefined, err, i);\n      }\n    }\n    return results;\n  }\n}\n\nObject.defineProperty(ArrayExceptions.prototype, incDepthAccessor, propertyDescriptor(function() {\n  this[depthAccessor]++;\n  for(let e of this.exceptions) {\n    if(e !== undefined) {\n      e[incDepthAccessor]();\n    }\n  }\n}));\n\nclass NotMember {\n  constructor(value, collection) {\n    this.value = value;\n    this.collection = collection;\n  }\n  get message() {\n    return `${this.name}: not a member of the supplied collection`;\n  }\n}\n\nclass WrongType {\n  constructor(value, type) {\n    this.value = value;\n    this.type = type;\n  }\n  get message() {\n    return `${this.name}: should be of type ${this.type}`;\n  }\n}\n\nclass WrongClass {\n  constructor(value, classConstructor) {\n    this.value = value;\n    this.classConstructor = classConstructor;\n  }\n  get message() {\n    return `${this.name}: not an instance of the given class/constructor`;\n  }\n}\n\nclass MissingValue {\n  constructor(value, allowNull=false) {\n    this.value = value;\n    this.allowNull = allowNull;\n  }\n  get message() {\n    return `${this.name}: undefined ${this.allowNull ? \"\" : \"or null\"},\\\n      but variable is ${this.value}`;\n  }\n}\n\nclass UnknownPropertyName {\n  constructor(value, definition, propertyName) {\n    this.value = value;\n    this.definition = definition;\n    this.propertyName = propertyName;\n  }\n  get message() {\n    return `${this.name}: the property ${this.propertyName} has not been defined`;\n  }\n}\n\nexception.array = exception.register(\"ArrayExceptions\", ArrayExceptions);\nexception.object = exception.register(\"ObjectExceptions\", ObjectExceptions);\nexception.missingValue = exception.register(\"MissingValue\", MissingValue);\nexception.notMember = exception.register(\"NotMember\", NotMember);\nexception.wrongClass = exception.register(\"WrongClass\", WrongClass);\nexception.wrongType = exception.register(\"WrongType\", WrongType);\nexception.unknownProp = exception.register(\"UnknownPropertyName\", UnknownPropertyName);\n","/**\n * @module lib/utils/iterator\n */\n\n/**\n * Transforms an iterable of iterables into a flat iterable\n */\nexport function flatten(iterable, accessIterable) {\n  const iterator = iterable[Symbol.iterator]();\n  let oldNext = iterator.next.bind(iterator);\n  let c;\n  let subIterator;\n  let subc = {done: true};\n  iterator.next = () => {\n    while(subc.done) {\n      c = oldNext();\n      if(c.done) {\n        return c;\n      }\n      subIterator = accessIterable(c.value)[Symbol.iterator];\n      subc = subIterator.next();\n    }\n    return subc;\n  };\n  iterator[Symbol.iterator] = () => iterator;\n  return iterator; \n};\n\n/**\n * Creates an empty iterator\n */\nexport function empty() {\n  const iterator = {\n    next: () => ({done: true})\n  };\n  iterator[Symbol.iterator] = () => iterator;\n  return iterator;\n};\n\n/**\n * Wraps a variable in an iterator\n */\nexport function wrap(value) {\n  let seen = false;\n  const iterator = {\n    next: () => {\n      if(seen) {\n        return {done: true};\n      } \n      seen = true;\n      return {value};\n    }\n  };\n  iterator[Symbol.iterator] = () => iterator;\n  return iterator;\n};\n\n/**\n * Apply a function on a value when accessing it\n */\nexport function hijack(iterable, callback) {\n  const iterator = iterable[Symbol.iterator]();\n  const oldNext = iterator.next.bind(iterator);\n  iterator.next = () => {\n    const c = oldNext();\n    if(!c.done) {\n      c.value = callback(c.value);\n    }\n    return n;\n  };\n  iterator[Symbol.iterator] = () => iterator;\n  return newIterator;\n};\n","export default function precedence(...args) {\n  let arg = undefined;\n  for(let i = 0; i < args.length, arg == null; i++) {\n    arg = args[i];\n  }\n  return arg;\n}\n\nexport function lazy(self, callbacks) {\n  let r = undefined;\n  for(let i = 0; i < callbacks.length && r == null; i++) {\n    r = callbacks[i].apply(self);\n  }\n  return r;\n}\n"]}